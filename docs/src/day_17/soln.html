<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport"
	content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Day 17: Trick Shot :: Robert Bennett — Advent of Code 2021</title>
        <link rel="prev" href="../day_16/soln">
        <link rel="next" href="../day_18/soln">
    <meta name="generator" content="Antora 3.1.2">
<link rel="stylesheet" href="../../_/css/site.css" />
<link rel="stylesheet" href="../../_/css/code-syntax-highlight.css" />
<link rel="stylesheet" href="https://use.typekit.net/fnd4xvj.css" />
<link rel="stylesheet" href="https://iosevka-rltb.pages.dev/dist/iosevka-rltb-mono/iosevka-rltb-mono-cloudflare.css">
<meta name="theme-color" content="#0970c4" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0967b4" media="(prefers-color-scheme: dark)">
<script>var uiRootPath = '../../_';</script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
		integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
	<!-- The loading of KaTeX is deferred to speed up page rendering -->
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
		integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
		crossorigin="anonymous"></script>
	<!-- To automatically render math in text elements, include the auto-render extension: -->
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
		integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
		onload="renderMathInElement(document.body);"></script>
<link rel="icon" type="image/x-icon" href="../../favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
</head>

<body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">Robert Bennett — Advent of Code 2021</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable open-left">
          <span class="navbar-link">Links</span>
          <div class="navbar-dropdown">
            <a class="navbar-item navbar-external-link" href="https://github.com/rben01" target="_blank">
              <div class="site-logo github-logo github-repo-logo"></div><span class="site-url">/&nbsp;rben01</span>
            </a>
          </div>
        </div>
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search this site">
            </div>
          </div>
      </div>
    </div>
  </nav>
</header>
<svg xmlns="http://www.w3.org/2000/svg" id="icon-mask-container" width="0" height="0">
	<defs>
		<clipPath id="icon-github" clipPathUnits="objectBoundingBox">
			<path transform="scale(0.0102040816)" fill-rule="evenodd" clip-rule="evenodd"
				d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z">
			</path>
		</clipPath>
		<clipPath id="icon-menu-clippath" clipPathUnits="objectBoundingBox">
			<circle cx=".1" cy=".1575" r=".06"></circle>
			<path d="M.325 .1175h.65 v.08h-.65z"></path>
			<circle cx=".25" cy=".4775" r=".06"></circle>
			<path d="M.475 .4375h.5 v.08h-.5z"></path>
			<circle cx=".25" cy=".7975" r=".06"></circle>
			<path d="M.475 .7575h.5 v.08h-.5z"></path>
		</clipPath>
		<clipPath id="icon-external-link" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.0017) translate(-256 -256)"
				d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z" />
		</clipPath>
		<clipPath id="icon-star" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001736) translate(-288 -256)"
				d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
		</clipPath>
		<clipPath id="icon-admon-caution" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-224 -256)" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7
			.1c27.6 25.9 53.5 53.8 77.7 84c11-14.4 23.5-30.1 37-42.9c7.9-7.4 20.1-7.4 28 .1c34.6 33 63.9 76.6 84.5 118c20.3
			40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512C98.4 512 0 404.1 0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3
			97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3 0 47.7-7 68.8-21c42.1-29.4 53.4-88.2
			28.1-134.4c-4.5-9-16-9.6-22.5-2l-25.2 29.3c-6.6 7.6-18.5
			7.4-24.7-.5c-16.5-21-46-58.5-62.8-79.8c-6.3-8-18.3-8.1-24.7-.1c-33.8 42.5-50.8 69.3-50.8 99.4C112 375.4 162.6
			416 225.7 416z" />
		</clipPath>
		<clipPath id="icon-admon-important" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001753125) translate(-256 -256)"
				d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z" />
		</clipPath>
		<clipPath id="icon-admon-note" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001753125) translate(-256 -256)"
				d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z" />
		</clipPath>
		<clipPath id="icon-admon-tip" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-192 -256)"
				d="M256 384c9.6-31.9 29.5-59.1 49.2-86.2l0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C352 78.8 273.2 0 176 0S0 78.8 0 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4l0 0C66.5 324.9 86.4 352.1 96 384H256zM176 512c44.2 0 80-35.8 80-80V416H96v16c0 44.2 35.8 80 80 80zM96 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z" />
		</clipPath>
		<clipPath id="icon-admon-warning" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-256 -256)"
				d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z" />
		</clipPath>
	</defs>
	<symbol viewBox="0 0 100 100" id="icon-back" class="svg-icon-template">
		<path
			d="m 50.000978,9.89975 -40.1010516,40.10025 40.1010516,40.10025 5.6556,-5.65551 -30.434757,-30.44194 h 64.878253 v -8.0056 H 25.221821 l 30.434757,-30.44001 z" />
	</symbol>
	<symbol viewBox="0 0 30 30" id="icon-caret" class="svg-icon-template">
		<path d="m 10.18745,2.9998 14.0001,12.0002 -14.0001,12.0001 z" stroke-width="2" stroke-linecap="round"
			stroke-linejoin="round" />
	</symbol>
	<symbol viewBox="0 0 30 30" id="icon-chevron">
		<path
			d="M 3.6699219,6.5898438 1.4550781,8.6152344 15,23.374272 28.544922,8.6152344 26.330078,6.5898438 15,18.759498 Z" />
	</symbol>
	<symbol viewBox="0 0 16 16" id="icon-clipboard">
		<path fill-rule="evenodd"
			d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z" />
	</symbol>
	<symbol viewBox="0 0 1 1" id="icon-home-filled" class="svg-icon-template icon-home">
		<path
			d="M.5002 .10747572875253811 L.10042786437626905 .4662178643762691 l.02671524585077328 .029770717813528465 l.06725688977295768 -.060354082044552726 v.44845 h.25506 v-.25166 H.5505 v.25166 h.25506 v-.44845 l.06725688977295768 .060354082044552726 l.02671524585077328 -.029770717813528465 l-.154812135623731 -.13892322952293115 V.1 h-.12657 V.21371495268001076 z" />
	</symbol>
	<symbol viewBox="0 0 1 1" id="icon-home-outline" class="svg-icon-template icon-home">
		<path
			d="M.5002 .10747572875253811 L.10042786437626905 .4662178643762691 l.02671524585077328 .029770717813528465 l.06725688977295768 -.060354082044552726 v.44845 h.25506 v-.25166 H.5505 v.25166 h.25506 v-.44845 l.06725688977295768 .060354082044552726 l.02671524585077328 -.029770717813528465 l-.154812135623731 -.13892322952293115 V.1 h-.12657 V.21371495268001076 z v.0565685424949238 L.65815 .30578331524901864 V.14 H.70472 V.2910051322295775 L.65815 .2492147727540948 v.0565685424949238 L.76556 .40216945463621206 V.8440845001452447 h-.17166 v-.25166 H.40946 v.25166 h-.17166 V.40216945463621206 L.5002 .16404427124746193 z " />
	</symbol>
	<symbol viewBox="0 0 1 1" id="icon-menu">
		<circle cx=".1" cy=".1575" r=".06"></circle>
		<path d="M.325 .1175h.65 v.08h-.65z"></path>
		<circle cx=".25" cy=".4775" r=".06"></circle>
		<path d="M.475 .4375h.5 v.08h-.5z"></path>
		<circle cx=".25" cy=".7975" r=".06"></circle>
		<path d="M.475 .7575h.5 v.08h-.5z"></path>
	</symbol>
</svg>
  <div class="body">
	<div class="nav-container"  data-component="ROOT"
  data-version="" >
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Navigation</span>
    <span class="nav-explore-expander">
      <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" viewBox="0 0 1 1">
        <title>Discloure chevron</title>
        <use href="#icon-chevron"></use>
      </svg>
    </span>
  </div>
  <ul class="components">
      <li
        class="component is-current">
          <a class="title" href="../../">Solutions</a>
            <ul class="nav-list">
      <li class="nav-item is-active"
        data-depth="0">
        <span
          class="nav-item-expander clickable">
        </span>
          <ul class="nav-list">
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_01/soln">Day 1: Sonar Sweep</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_02/soln">Day 2: Dive!</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_03/soln">Day 3: Binary Diagnostic</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_04/soln">Day 4: Giant Squid</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_05/soln">Day 5: Hydrothermal Venture</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_06/soln">Day 6: Lanternfish</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_07/soln">Day 7: The Treachery of Whales</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_08/soln">Day 8: Seven Segment Search</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_09/soln">Day 9: Smoke Basin</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_10/soln">Day 10: Syntax Scoring</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_11/soln">Day 11: Dumbo Octopus</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_12/soln">Day 12: Passage Pathing</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_13/soln">Day 13: Transparent Origami</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_14/soln">Day 14: Extended Polymerization</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_15/soln">Day 15: Chiton</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_16/soln">Day 16: Packet Decoder</a>
        </span>
              </li>
      <li class="nav-item is-active is-current-page"
        data-depth="1">
        <span
          class="nav-item-expander final-depth">
              <span class="nav-text">Day 17: Trick Shot</span>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_18/soln">Day 18: Snailfish</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_19/soln">Day 19: Beacon Scanner</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_20/soln">Day 20: Trench Map</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_21/soln">Day 21: Dirac Dice</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_22/soln">Day 22: Reactor Reboot</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_23/soln">Day 23: Amphipod</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_24/soln">Day 24: Arithmetic Logic Unit</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_25/soln">Day 25: Sea Cucumber</a>
        </span>
              </li>
  </ul>
      </li>
  </ul>
      </li>
  </ul>
</div>
    </div>
  </aside>
</div>
	<main class="article">
  <div class="toolbar" role="navigation">
  <button class="nav-toggle">
	<svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1 1">
		<title>Show or hide menu</title>
		<use class="icon-menu" href="#icon-menu"></use>
		<use class="icon-back" href="#icon-back"></use>
	</svg>
</button>
    <a href="../../" class="home-link" title="Home">
      <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon icon-home" viewBox="0 0 1 1">
        <title>Home</title>
        <use class="icon-home icon-home-filled" href="#icon-home-filled"></use>
        <use class="icon-home icon-home-outline" href="#icon-home-outline"></use>
      </svg>
    </a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li>&#47;</li> 
          <li>
              <a href="../../">Solutions</a>

          </li>
        <li>&#47;</li>
        <li><a href="#">Day 17: Trick Shot</a></li>
    </ul>
</nav>
  </div>
  <div class="content">
      <aside class="toc sidebar" data-title="Contents"
  data-levels="2">
  <div class="toc-menu"></div>
</aside>
      <article class="doc">
	<div class="title-container">
			<h1 class="page">Day 17: Trick Shot</h1>
	</div>
	<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/17" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day #17 problem description</a> │ <a href="/_attachments/src/day_17/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Holy crap.
This problem was <em>hard</em>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>After looking at <a href="https://www.reddit.com/r/adventofcode/" target="_blank" rel="noopener">the subreddit</a> it looks like most people just brute forced it.
That&#8217;s easy, but where&#8217;s the fun in that?
Where possible, we want to solve these problems in the most computationally efficient manner possible.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>We are asked to find the initial <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>- and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-velocities that will land a projectile, fired from the origin, in a given rectangular region <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>x</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub><mo stretchy="false">]</mo><mo>×</mo><mo stretchy="false">[</mo><msub><mi>y</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">R=[x_\mathrm{min}, x_\mathrm{max}]\times[y_\mathrm{min}, y_\mathrm{max}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>.
In the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>-direction, the projectile suffers from drag, so its <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>-velocity decreases by 1 each tick until it hits 0 (at which point it can&#8217;t slow down anymore).
In the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-direction, the projectile is affected by gravity (but no drag (?)), so its <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-velocity decreases by each tick, forever.</p>
</div>
<div class="paragraph">
<p>All numbers — time, positions, and velocities — must be (not-necessarily-positive) integers.
(And, naturally, time must be positive.)
This is an important and helpful constraint on the values we can use.</p>
</div>
<div class="paragraph">
<p>The solution below does not use brute force; it does not, for instance, try all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">v_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>s between 0 and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>'s right edge, or all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>s between <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">s</mi></mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">-\mathrm{abs}(v_\mathrm{max})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathrm">abs</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">s</mi></mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathrm{abs}(v_\mathrm{max})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathrm">abs</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.
All potential times, positions, and speeds are derived mathematically.
It has no problem running on a target area of <code>x=1000000..1001000, y=-1000000..-1001000</code> (although this particular target area requires being able to take the integer square root of large numbers, which I did not implement myself).</p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_setup"><a class="anchor" href="#_setup"></a>Setup</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;
<span class="hljs-keyword">use</span> num::integer::Roots;
<span class="hljs-keyword">use</span> std::collections::BTreeSet <span class="hljs-keyword">as</span> Set;

<span class="hljs-comment">// tag::setup_main[]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Time</span> = <span class="hljs-type">i64</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-type">i64</span>;

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Pos</span>&lt;T&gt; {
	x: T,
	y: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Velo</span>&lt;T&gt; {
	vx: T,
	vy: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span>&lt;T&gt; {
	x_min: T,
	x_max: T,
	y_min: T,
	y_max: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Trajectory</span> {
	_t: Time,
	_pos: Pos&lt;Num&gt;,
	velo: Velo&lt;Num&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Rect&lt;Num&gt;&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">re</span> = {
		regex::Regex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">r&quot;target area:\s*x=([\d-]+)\.\.([\d-]+),\s*y=([\d-]+)\.\.([\d-]+)&quot;</span>)
			.<span class="hljs-title function_ invoke__">ok</span>()?
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">caps</span> = re.<span class="hljs-title function_ invoke__">captures</span>(input.<span class="hljs-title function_ invoke__">trim</span>())?;
	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = <span class="hljs-comment">// force line break :/</span>
		[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">map</span>(|i| caps.<span class="hljs-title function_ invoke__">get</span>(i).<span class="hljs-title function_ invoke__">and_then</span>(|m| m.<span class="hljs-title function_ invoke__">as_str</span>().<span class="hljs-title function_ invoke__">parse</span>().<span class="hljs-title function_ invoke__">ok</span>()));

	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = [x1?, x2?, y1?, y2?];

	<span class="hljs-keyword">let</span> [x_min, x_max] = <span class="hljs-keyword">if</span> x1 &lt; x2 { [x1, x2] } <span class="hljs-keyword">else</span> { [x2, x1] };
	<span class="hljs-keyword">let</span> [y_min, y_max] = <span class="hljs-keyword">if</span> y1 &lt; y2 { [y1, y2] } <span class="hljs-keyword">else</span> { [y2, y1] };

	<span class="hljs-title function_ invoke__">Some</span>(Rect {
		x_min,
		x_max,
		y_min,
		y_max,
	})
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sqrt</span>(n: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt</span> = Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;n);
	<span class="hljs-keyword">if</span> sqrt * sqrt == n {
		<span class="hljs-title function_ invoke__">Some</span>(sqrt)
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-literal">None</span>
	}
}

<span class="hljs-comment">// end::setup_main[]</span>

<span class="hljs-comment">// tag::velo_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_velocities</span>(t: Time, position: Pos&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">Option</span>&lt;Velo&lt;Num&gt;&gt;; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-title function_ invoke__">Some</span>(Velo { vx: <span class="hljs-number">0</span>, vy: <span class="hljs-number">0</span> }), <span class="hljs-literal">None</span>];
	}

	<span class="hljs-keyword">let</span> <span class="hljs-variable">Pos</span> { x, y } = position;

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_numer</span> = <span class="hljs-number">2</span> * y + t * (t - <span class="hljs-number">1</span>);
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_denom</span> = <span class="hljs-number">2</span> * t;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = <span class="hljs-keyword">if</span> vy_numer % vy_denom == <span class="hljs-number">0</span> {
		vy_numer / vy_denom
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>];
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx1</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = <span class="hljs-number">2</span> * x + t * (t - <span class="hljs-number">1</span>);
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span> * t;
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
		<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &gt;= t {
			<span class="hljs-title function_ invoke__">Some</span>(vx)
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-literal">None</span>
		}
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx2</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = <span class="hljs-number">1</span> + <span class="hljs-number">8</span> * x;
		<span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">and_then</span>(|sqrt_disc| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = sqrt_disc - <span class="hljs-number">1</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
			<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &lt;= t {
				<span class="hljs-title function_ invoke__">Some</span>(vx)
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-literal">None</span>
			}
		})
	};

	[vx1, vx2].<span class="hljs-title function_ invoke__">map</span>(|opt_vx| opt_vx.<span class="hljs-title function_ invoke__">map</span>(|vx| Velo { vx, vy }))
}
<span class="hljs-comment">// end::velo_finder[]</span>

<span class="hljs-comment">// tag::time_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_ts_and_vys_for_y</span>(y: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;(Time, Num)&gt; {
	<span class="hljs-built_in">assert_ne!</span>(y, <span class="hljs-number">0</span>);

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">ans</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-comment">// Need to find all integer (t, vy) that satisfy y = vy * t - t*(t-1)/2 with t &gt; 0</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// Step one: (2*vy + 1)^2 - 8*y = must be square</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// In other words there must exist integral m and n such that m^2 - n^2 = 8y (with</span>
	<span class="hljs-comment">// 2*vy + 1 = m). m^2 - n^2 = (m-n)*(m+n), and so...</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">eight_y</span> = <span class="hljs-number">8</span> * y;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">abs_eight_y</span> = eight_y.<span class="hljs-title function_ invoke__">abs</span>();
	<span class="hljs-keyword">for</span> <span class="hljs-variable">k1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;abs_eight_y) {
		<span class="hljs-keyword">if</span> abs_eight_y % k1 != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">for</span> <span class="hljs-variable">sign</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k1</span> = sign * k1;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k2</span> = eight_y / k1;
			<span class="hljs-comment">// k1 and k2 are now two signed integers that multiply to 8y</span>

			<span class="hljs-keyword">let</span> <span class="hljs-variable">two_m</span> = k1 + k2;
			<span class="hljs-keyword">if</span> two_m % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">m</span> = two_m / <span class="hljs-number">2</span>;

			<span class="hljs-comment">// Now, m was 2*vy + 1, and so...</span>
			<span class="hljs-title function_ invoke__">if</span> (m - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = (m - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = m * m - eight_y;
			<span class="hljs-keyword">if</span> discriminant &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt_disc</span> = <span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">unwrap</span>();

			<span class="hljs-keyword">for</span> <span class="hljs-variable">pm</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t_numer</span> = <span class="hljs-number">2</span> * vy + <span class="hljs-number">1</span> + pm * sqrt_disc;
				<span class="hljs-keyword">if</span> t_numer &lt;= <span class="hljs-number">0</span> || t_numer % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
					<span class="hljs-keyword">continue</span>;
				}
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t</span> = t_numer / <span class="hljs-number">2</span>;
				ans.<span class="hljs-title function_ invoke__">push</span>((t, vy));
			}
		}
	}

	ans
}
<span class="hljs-comment">// end::time_finder[]</span>

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();
	<span class="hljs-keyword">let</span> <span class="hljs-variable">trajectories</span> = <span class="hljs-title function_ invoke__">get_trajectories</span>(rect);
	(<span class="hljs-number">17</span>, (<span class="hljs-title function_ invoke__">pt1</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()), <span class="hljs-title function_ invoke__">pt2</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()))).<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::get_traj[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_x</span>(t: Time, vx: Num) <span class="hljs-punctuation">-&gt;</span> Num {
	<span class="hljs-keyword">if</span> t &lt;= vx {
		vx * t - t * (t - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	} <span class="hljs-keyword">else</span> {
		vx * (vx + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_trajectories</span>(rect: Rect&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;Trajectory&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">Rect</span> {
		x_min,
		x_max,
		y_min,
		y_max,
	} = rect;

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">trajectories</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-keyword">for</span> <span class="hljs-variable">y</span> <span class="hljs-keyword">in</span> y_min..=y_max {
		<span class="hljs-keyword">if</span> y == <span class="hljs-number">0</span> {
			<span class="hljs-comment">// If any vx works, then there will be infinitely many choices for vy because it</span>
			<span class="hljs-comment">// retraces its ascent on its descent. And if no vx works, then it&#x27;s moot</span>
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">let</span> <span class="hljs-variable">ts_and_vys</span> = <span class="hljs-title function_ invoke__">find_ts_and_vys_for_y</span>(y);

		<span class="hljs-title function_ invoke__">for</span> (t, vy) <span class="hljs-keyword">in</span> ts_and_vys {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">x</span> <span class="hljs-keyword">in</span> x_min..=x_max {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">velocities</span> = <span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y });

				<span class="hljs-keyword">for</span> <span class="hljs-variable">velo</span> <span class="hljs-keyword">in</span> velocities {
					<span class="hljs-keyword">let</span> <span class="hljs-variable">velo</span> = <span class="hljs-keyword">match</span> velo {
						<span class="hljs-title function_ invoke__">Some</span>(v) =&gt; v,
						<span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">continue</span>,
					};
					<span class="hljs-keyword">if</span> velo.vy == vy &amp;&amp; <span class="hljs-title function_ invoke__">get_x</span>(t, velo.vx) == x {
						trajectories.<span class="hljs-title function_ invoke__">push</span>(Trajectory {
							_t: t,
							_pos: Pos { x, y },
							velo,
						});
					}
				}
			}
		}
	}

	trajectories
}
<span class="hljs-comment">// end::get_traj[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">traj</span> = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = traj.velo.vy;
			<span class="hljs-keyword">if</span> vy &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
			}
			vy * (vy + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
		})
		.<span class="hljs-title function_ invoke__">max</span>()
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">Trajectory</span> { velo, .. } = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			(velo.vx, velo.vy)
		})
		.collect::&lt;Set&lt;_&gt;&gt;()
		.<span class="hljs-title function_ invoke__">len</span>()
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_velocity_finder</span>() {
		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">18</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">22</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">27</span>, -<span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">28</span>, -<span class="hljs-number">7</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">7</span>, vy: <span class="hljs-number">2</span> }
			);
		}

		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">18</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">21</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">8</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">4</span>),
			(<span class="hljs-number">9</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">9</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">6</span>, vy: <span class="hljs-number">3</span> }
			);
		}

		test_input!(<span class="hljs-string">&quot;target area: x=20..30, y=-10..-5&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">45</span>), <span class="hljs-number">112</span>));
		test_input!(<span class="hljs-string">&quot;target area: x=34..35, y=-8..-6&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">3</span>), <span class="hljs-number">9</span>));
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">The Math</div>
<p>Because <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> decreases by 1 each tick until it hits 0, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> decreases by 1 each tick forever, we have the following equations for the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>- and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-coordinates at time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> of a projectile fired with an initial velocity of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v_x, v_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.
(Derivations are left to the reader, but a helpful fact is that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>2</mn><mo>+</mo><mo>…</mo><mo>+</mo><mi>n</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">1+2+\ldots+n=\frac{1}{2}n(n+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>.)</p>
</div>
<div class="stemblock">
<div class="content">
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>x</mi><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><msub><mi>v</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>v</mi><mi>x</mi></msub><mi>t</mi><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>t</mi><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mo>≤</mo><msub><mi>v</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><msub><mi>v</mi><mi>x</mi></msub><mo stretchy="false">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mo>≥</mo><msub><mi>v</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr></mtable></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>v</mi><mi>y</mi></msub><mi>t</mi><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>t</mi><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
x(t, v_x) &amp;=
\begin{cases}
v_x t - \frac{1}{2}t(t-1)&amp;t \le v_x\\
\frac{1}{2}v_x(v_x+1)&amp;t \ge v_x
\end{cases}\\
y(t, v_y)&amp;=v_y t - \frac{1}{2}t(t-1)
\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.6075em;vertical-align:-2.5537em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0537em;"><span style="top:-5.0537em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.1823em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5537em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0537em;"><span style="top:-5.0537em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.1823em;"><span class="pstrut" style="height:3.75em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5537em;"><span></span></span></span></span></span></span></span></span></span></span></span>
</div>
</div>
<div class="paragraph">
<p>Note that even though the two definitions of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> overlap at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">t=v_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, they also coincide there, so it&#8217;s not a problem.</p>
</div>
<div class="paragraph">
<p>Now, we must find the values of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v_x,v_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> that land the projectile in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>.
To do this, we simply find the values of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v_x,v_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> that will land the projectile precisely at a point <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>, for each <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">(x,y)\in R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>.
And to do this, we find the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v_x,v_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> that will land the projectile at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> precisely at time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, for each positive <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.</p>
</div>
<div class="paragraph">
<p>To find the velocities that will land the projectile precisely at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t,x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>, we solve the above equations for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">v_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>.
Finding <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> is simple: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub><mo>=</mo><mfrac><mrow><mn>2</mn><mi>y</mi><mo>+</mo><mi>t</mi><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><mn>2</mn><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">v_y=\frac{2y+t(t-1)}{2t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>.
For <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">v_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, it&#8217;s a bit more complicated, as we have two options:</p>
</div>
<div class="stemblock">
<div class="content">
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mn>2</mn><mi>x</mi><mo>+</mo><mi>t</mi><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><mn>2</mn><mi>t</mi></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mo>≤</mo><msub><mi>v</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mo>−</mo><mn>1</mn><mo>±</mo><msqrt><mrow><mn>1</mn><mo>+</mo><mn>8</mn><mi>x</mi></mrow></msqrt></mrow><mn>2</mn></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mo>≥</mo><msub><mi>v</mi><mi>x</mi></msub></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">v_x=\begin{cases}
\frac{2x+t(t-1)}{2t}&amp;t\le v_x\\
\frac{-1\pm\sqrt{1+8x}}{2}&amp;t\ge v_x
\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.706em;"><span style="top:-3.734em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">x</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.264em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4282em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span><span class="mbin mtight">±</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8712em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight">8</span><span class="mord mathnormal mtight">x</span></span></span><span style="top:-2.8312em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1688em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.206em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.706em;"><span style="top:-3.734em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.264em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.206em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
</div>
</div>
<div class="paragraph">
<p>And as we said above, we need everything to be an integer, so we can either have no pairs of velocities that work, one pair, or two pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;
<span class="hljs-keyword">use</span> num::integer::Roots;
<span class="hljs-keyword">use</span> std::collections::BTreeSet <span class="hljs-keyword">as</span> Set;

<span class="hljs-comment">// tag::setup_main[]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Time</span> = <span class="hljs-type">i64</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-type">i64</span>;

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Pos</span>&lt;T&gt; {
	x: T,
	y: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Velo</span>&lt;T&gt; {
	vx: T,
	vy: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span>&lt;T&gt; {
	x_min: T,
	x_max: T,
	y_min: T,
	y_max: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Trajectory</span> {
	_t: Time,
	_pos: Pos&lt;Num&gt;,
	velo: Velo&lt;Num&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Rect&lt;Num&gt;&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">re</span> = {
		regex::Regex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">r&quot;target area:\s*x=([\d-]+)\.\.([\d-]+),\s*y=([\d-]+)\.\.([\d-]+)&quot;</span>)
			.<span class="hljs-title function_ invoke__">ok</span>()?
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">caps</span> = re.<span class="hljs-title function_ invoke__">captures</span>(input.<span class="hljs-title function_ invoke__">trim</span>())?;
	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = <span class="hljs-comment">// force line break :/</span>
		[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">map</span>(|i| caps.<span class="hljs-title function_ invoke__">get</span>(i).<span class="hljs-title function_ invoke__">and_then</span>(|m| m.<span class="hljs-title function_ invoke__">as_str</span>().<span class="hljs-title function_ invoke__">parse</span>().<span class="hljs-title function_ invoke__">ok</span>()));

	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = [x1?, x2?, y1?, y2?];

	<span class="hljs-keyword">let</span> [x_min, x_max] = <span class="hljs-keyword">if</span> x1 &lt; x2 { [x1, x2] } <span class="hljs-keyword">else</span> { [x2, x1] };
	<span class="hljs-keyword">let</span> [y_min, y_max] = <span class="hljs-keyword">if</span> y1 &lt; y2 { [y1, y2] } <span class="hljs-keyword">else</span> { [y2, y1] };

	<span class="hljs-title function_ invoke__">Some</span>(Rect {
		x_min,
		x_max,
		y_min,
		y_max,
	})
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sqrt</span>(n: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt</span> = Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;n);
	<span class="hljs-keyword">if</span> sqrt * sqrt == n {
		<span class="hljs-title function_ invoke__">Some</span>(sqrt)
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-literal">None</span>
	}
}

<span class="hljs-comment">// end::setup_main[]</span>

<span class="hljs-comment">// tag::velo_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_velocities</span>(t: Time, position: Pos&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">Option</span>&lt;Velo&lt;Num&gt;&gt;; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-title function_ invoke__">Some</span>(Velo { vx: <span class="hljs-number">0</span>, vy: <span class="hljs-number">0</span> }), <span class="hljs-literal">None</span>];
	}

	<span class="hljs-keyword">let</span> <span class="hljs-variable">Pos</span> { x, y } = position;

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_numer</span> = <span class="hljs-number">2</span> * y + t * (t - <span class="hljs-number">1</span>);
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_denom</span> = <span class="hljs-number">2</span> * t;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = <span class="hljs-keyword">if</span> vy_numer % vy_denom == <span class="hljs-number">0</span> {
		vy_numer / vy_denom
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>];
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx1</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = <span class="hljs-number">2</span> * x + t * (t - <span class="hljs-number">1</span>);
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span> * t;
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
		<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &gt;= t {
			<span class="hljs-title function_ invoke__">Some</span>(vx)
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-literal">None</span>
		}
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx2</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = <span class="hljs-number">1</span> + <span class="hljs-number">8</span> * x;
		<span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">and_then</span>(|sqrt_disc| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = sqrt_disc - <span class="hljs-number">1</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
			<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &lt;= t {
				<span class="hljs-title function_ invoke__">Some</span>(vx)
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-literal">None</span>
			}
		})
	};

	[vx1, vx2].<span class="hljs-title function_ invoke__">map</span>(|opt_vx| opt_vx.<span class="hljs-title function_ invoke__">map</span>(|vx| Velo { vx, vy }))
}
<span class="hljs-comment">// end::velo_finder[]</span>

<span class="hljs-comment">// tag::time_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_ts_and_vys_for_y</span>(y: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;(Time, Num)&gt; {
	<span class="hljs-built_in">assert_ne!</span>(y, <span class="hljs-number">0</span>);

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">ans</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-comment">// Need to find all integer (t, vy) that satisfy y = vy * t - t*(t-1)/2 with t &gt; 0</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// Step one: (2*vy + 1)^2 - 8*y = must be square</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// In other words there must exist integral m and n such that m^2 - n^2 = 8y (with</span>
	<span class="hljs-comment">// 2*vy + 1 = m). m^2 - n^2 = (m-n)*(m+n), and so...</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">eight_y</span> = <span class="hljs-number">8</span> * y;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">abs_eight_y</span> = eight_y.<span class="hljs-title function_ invoke__">abs</span>();
	<span class="hljs-keyword">for</span> <span class="hljs-variable">k1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;abs_eight_y) {
		<span class="hljs-keyword">if</span> abs_eight_y % k1 != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">for</span> <span class="hljs-variable">sign</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k1</span> = sign * k1;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k2</span> = eight_y / k1;
			<span class="hljs-comment">// k1 and k2 are now two signed integers that multiply to 8y</span>

			<span class="hljs-keyword">let</span> <span class="hljs-variable">two_m</span> = k1 + k2;
			<span class="hljs-keyword">if</span> two_m % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">m</span> = two_m / <span class="hljs-number">2</span>;

			<span class="hljs-comment">// Now, m was 2*vy + 1, and so...</span>
			<span class="hljs-title function_ invoke__">if</span> (m - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = (m - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = m * m - eight_y;
			<span class="hljs-keyword">if</span> discriminant &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt_disc</span> = <span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">unwrap</span>();

			<span class="hljs-keyword">for</span> <span class="hljs-variable">pm</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t_numer</span> = <span class="hljs-number">2</span> * vy + <span class="hljs-number">1</span> + pm * sqrt_disc;
				<span class="hljs-keyword">if</span> t_numer &lt;= <span class="hljs-number">0</span> || t_numer % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
					<span class="hljs-keyword">continue</span>;
				}
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t</span> = t_numer / <span class="hljs-number">2</span>;
				ans.<span class="hljs-title function_ invoke__">push</span>((t, vy));
			}
		}
	}

	ans
}
<span class="hljs-comment">// end::time_finder[]</span>

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();
	<span class="hljs-keyword">let</span> <span class="hljs-variable">trajectories</span> = <span class="hljs-title function_ invoke__">get_trajectories</span>(rect);
	(<span class="hljs-number">17</span>, (<span class="hljs-title function_ invoke__">pt1</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()), <span class="hljs-title function_ invoke__">pt2</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()))).<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::get_traj[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_x</span>(t: Time, vx: Num) <span class="hljs-punctuation">-&gt;</span> Num {
	<span class="hljs-keyword">if</span> t &lt;= vx {
		vx * t - t * (t - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	} <span class="hljs-keyword">else</span> {
		vx * (vx + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_trajectories</span>(rect: Rect&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;Trajectory&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">Rect</span> {
		x_min,
		x_max,
		y_min,
		y_max,
	} = rect;

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">trajectories</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-keyword">for</span> <span class="hljs-variable">y</span> <span class="hljs-keyword">in</span> y_min..=y_max {
		<span class="hljs-keyword">if</span> y == <span class="hljs-number">0</span> {
			<span class="hljs-comment">// If any vx works, then there will be infinitely many choices for vy because it</span>
			<span class="hljs-comment">// retraces its ascent on its descent. And if no vx works, then it&#x27;s moot</span>
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">let</span> <span class="hljs-variable">ts_and_vys</span> = <span class="hljs-title function_ invoke__">find_ts_and_vys_for_y</span>(y);

		<span class="hljs-title function_ invoke__">for</span> (t, vy) <span class="hljs-keyword">in</span> ts_and_vys {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">x</span> <span class="hljs-keyword">in</span> x_min..=x_max {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">velocities</span> = <span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y });

				<span class="hljs-keyword">for</span> <span class="hljs-variable">velo</span> <span class="hljs-keyword">in</span> velocities {
					<span class="hljs-keyword">let</span> <span class="hljs-variable">velo</span> = <span class="hljs-keyword">match</span> velo {
						<span class="hljs-title function_ invoke__">Some</span>(v) =&gt; v,
						<span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">continue</span>,
					};
					<span class="hljs-keyword">if</span> velo.vy == vy &amp;&amp; <span class="hljs-title function_ invoke__">get_x</span>(t, velo.vx) == x {
						trajectories.<span class="hljs-title function_ invoke__">push</span>(Trajectory {
							_t: t,
							_pos: Pos { x, y },
							velo,
						});
					}
				}
			}
		}
	}

	trajectories
}
<span class="hljs-comment">// end::get_traj[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">traj</span> = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = traj.velo.vy;
			<span class="hljs-keyword">if</span> vy &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
			}
			vy * (vy + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
		})
		.<span class="hljs-title function_ invoke__">max</span>()
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">Trajectory</span> { velo, .. } = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			(velo.vx, velo.vy)
		})
		.collect::&lt;Set&lt;_&gt;&gt;()
		.<span class="hljs-title function_ invoke__">len</span>()
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_velocity_finder</span>() {
		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">18</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">22</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">27</span>, -<span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">28</span>, -<span class="hljs-number">7</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">7</span>, vy: <span class="hljs-number">2</span> }
			);
		}

		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">18</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">21</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">8</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">4</span>),
			(<span class="hljs-number">9</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">9</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">6</span>, vy: <span class="hljs-number">3</span> }
			);
		}

		test_input!(<span class="hljs-string">&quot;target area: x=20..30, y=-10..-5&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">45</span>), <span class="hljs-number">112</span>));
		test_input!(<span class="hljs-string">&quot;target area: x=34..35, y=-8..-6&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">3</span>), <span class="hljs-number">9</span>));
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Awesome.
We have the 0, 1, or 2 velocities that will land the projectile at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> at time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.
But how to find the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>s for which the projectile can even land at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>?
We cannot enumerate all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>s, as there are infinitely many positive integers.
Could we perhaps keep firing it with a larger and larger <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> and hope that it would continue to land in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> at some point in its trajectory?
The answer is no: there are only finitely many values of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> for which there exists a time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> such that the projectile has a vertical position of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.
Let&#8217;s prove it, and let&#8217;s find them.</p>
</div>
<div class="paragraph">
<p>Solving the equation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msub><mi>v</mi><mi>y</mi></msub><mi>t</mi><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>t</mi><mo stretchy="false">(</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y=v_y t- \frac{1}{2}t(t-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, we find that:</p>
</div>
<div class="stemblock">
<div class="content">
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence="true">(</mo><mo stretchy="false">(</mo><mn>2</mn><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>±</mo><msqrt><mrow><mo stretchy="false">(</mo><mn>2</mn><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><mn>8</mn><mi>y</mi></mrow></msqrt><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">t=\frac{1}{2}\left((2v_y+1)\pm\sqrt{(2v_y+1)^2-8y}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">±</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2658em;"><span class="svg-align" style="top:-3.8em;"><span class="pstrut" style="height:3.8em;"></span><span class="mord" style="padding-left:1em;"><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.2258em;"><span class="pstrut" style="height:3.8em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.88em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.88em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90
l0 -0
c4,-6.7,10,-10,18,-10 H400000v40
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5742em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span>
</div>
</div>
<div class="paragraph">
<p>First and foremost, for this to be an integer, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>2</mn><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><mn>8</mn><mi>y</mi></mrow><annotation encoding="application/x-tex">(2v_y+1)^2-8y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> must be a perfect square.
Letting <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mn>2</mn></msup><mo>=</mo><mo stretchy="false">(</mo><mn>2</mn><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">m^2 =(2v_y+1) ^ 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup><mo>=</mo><msup><mi>m</mi><mn>2</mn></msup><mo>−</mo><mn>8</mn><mi>y</mi></mrow><annotation encoding="application/x-tex">n^2 = m^2 - 8y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>, we have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mn>2</mn></msup><mo>−</mo><msup><mi>n</mi><mn>2</mn></msup><mo>=</mo><mn>8</mn><mi>y</mi></mrow><annotation encoding="application/x-tex">m^2 - n^2 = 8y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>, which factors into <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>8</mn><mi>y</mi></mrow><annotation encoding="application/x-tex">(m-n)(m+n)=8y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>.
Since everything must be an integer, we can use the factor pairs of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mi>y</mi></mrow><annotation encoding="application/x-tex">8y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> to find <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>.
If <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mi>y</mi><mo>=</mo><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>k</mi><mn>1</mn></msub><msub><mi>k</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">8y=(m-n)(m+n)=k_1k_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">m=\frac{1}{2}(k_1+k_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.
Hence, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">2v_y+1=\frac{1}{2}(k_1+k_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9305em;vertical-align:-0.2861em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>2</mn><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><mn>8</mn><mi>y</mi></mrow><annotation encoding="application/x-tex">(2v_y+1)^2 - 8y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">8</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> will indeed be a perfect square.
Of course, we also need <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{1}{2}(k_1+k_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> to be an odd integer so that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> will be an integer.
Finally, we plug <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> into our equation for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> and if we get an integer, we&#8217;ve got a match: if the projectile is fired with a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-velocity of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>, then it will hit the vertical position <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> precisely at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.</p>
</div>
<div class="paragraph">
<p>The astute reader will note that there <em>every</em> projectile with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">v_y&gt;0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8252em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> hits <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> on the way down.
Therefore we exclude <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> from consideration altogether; a problem that included <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> would have infinitely many answers or be impossible to solve.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;
<span class="hljs-keyword">use</span> num::integer::Roots;
<span class="hljs-keyword">use</span> std::collections::BTreeSet <span class="hljs-keyword">as</span> Set;

<span class="hljs-comment">// tag::setup_main[]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Time</span> = <span class="hljs-type">i64</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-type">i64</span>;

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Pos</span>&lt;T&gt; {
	x: T,
	y: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Velo</span>&lt;T&gt; {
	vx: T,
	vy: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span>&lt;T&gt; {
	x_min: T,
	x_max: T,
	y_min: T,
	y_max: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Trajectory</span> {
	_t: Time,
	_pos: Pos&lt;Num&gt;,
	velo: Velo&lt;Num&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Rect&lt;Num&gt;&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">re</span> = {
		regex::Regex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">r&quot;target area:\s*x=([\d-]+)\.\.([\d-]+),\s*y=([\d-]+)\.\.([\d-]+)&quot;</span>)
			.<span class="hljs-title function_ invoke__">ok</span>()?
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">caps</span> = re.<span class="hljs-title function_ invoke__">captures</span>(input.<span class="hljs-title function_ invoke__">trim</span>())?;
	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = <span class="hljs-comment">// force line break :/</span>
		[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">map</span>(|i| caps.<span class="hljs-title function_ invoke__">get</span>(i).<span class="hljs-title function_ invoke__">and_then</span>(|m| m.<span class="hljs-title function_ invoke__">as_str</span>().<span class="hljs-title function_ invoke__">parse</span>().<span class="hljs-title function_ invoke__">ok</span>()));

	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = [x1?, x2?, y1?, y2?];

	<span class="hljs-keyword">let</span> [x_min, x_max] = <span class="hljs-keyword">if</span> x1 &lt; x2 { [x1, x2] } <span class="hljs-keyword">else</span> { [x2, x1] };
	<span class="hljs-keyword">let</span> [y_min, y_max] = <span class="hljs-keyword">if</span> y1 &lt; y2 { [y1, y2] } <span class="hljs-keyword">else</span> { [y2, y1] };

	<span class="hljs-title function_ invoke__">Some</span>(Rect {
		x_min,
		x_max,
		y_min,
		y_max,
	})
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sqrt</span>(n: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt</span> = Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;n);
	<span class="hljs-keyword">if</span> sqrt * sqrt == n {
		<span class="hljs-title function_ invoke__">Some</span>(sqrt)
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-literal">None</span>
	}
}

<span class="hljs-comment">// end::setup_main[]</span>

<span class="hljs-comment">// tag::velo_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_velocities</span>(t: Time, position: Pos&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">Option</span>&lt;Velo&lt;Num&gt;&gt;; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-title function_ invoke__">Some</span>(Velo { vx: <span class="hljs-number">0</span>, vy: <span class="hljs-number">0</span> }), <span class="hljs-literal">None</span>];
	}

	<span class="hljs-keyword">let</span> <span class="hljs-variable">Pos</span> { x, y } = position;

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_numer</span> = <span class="hljs-number">2</span> * y + t * (t - <span class="hljs-number">1</span>);
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_denom</span> = <span class="hljs-number">2</span> * t;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = <span class="hljs-keyword">if</span> vy_numer % vy_denom == <span class="hljs-number">0</span> {
		vy_numer / vy_denom
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>];
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx1</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = <span class="hljs-number">2</span> * x + t * (t - <span class="hljs-number">1</span>);
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span> * t;
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
		<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &gt;= t {
			<span class="hljs-title function_ invoke__">Some</span>(vx)
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-literal">None</span>
		}
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx2</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = <span class="hljs-number">1</span> + <span class="hljs-number">8</span> * x;
		<span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">and_then</span>(|sqrt_disc| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = sqrt_disc - <span class="hljs-number">1</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
			<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &lt;= t {
				<span class="hljs-title function_ invoke__">Some</span>(vx)
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-literal">None</span>
			}
		})
	};

	[vx1, vx2].<span class="hljs-title function_ invoke__">map</span>(|opt_vx| opt_vx.<span class="hljs-title function_ invoke__">map</span>(|vx| Velo { vx, vy }))
}
<span class="hljs-comment">// end::velo_finder[]</span>

<span class="hljs-comment">// tag::time_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_ts_and_vys_for_y</span>(y: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;(Time, Num)&gt; {
	<span class="hljs-built_in">assert_ne!</span>(y, <span class="hljs-number">0</span>);

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">ans</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-comment">// Need to find all integer (t, vy) that satisfy y = vy * t - t*(t-1)/2 with t &gt; 0</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// Step one: (2*vy + 1)^2 - 8*y = must be square</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// In other words there must exist integral m and n such that m^2 - n^2 = 8y (with</span>
	<span class="hljs-comment">// 2*vy + 1 = m). m^2 - n^2 = (m-n)*(m+n), and so...</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">eight_y</span> = <span class="hljs-number">8</span> * y;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">abs_eight_y</span> = eight_y.<span class="hljs-title function_ invoke__">abs</span>();
	<span class="hljs-keyword">for</span> <span class="hljs-variable">k1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;abs_eight_y) {
		<span class="hljs-keyword">if</span> abs_eight_y % k1 != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">for</span> <span class="hljs-variable">sign</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k1</span> = sign * k1;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k2</span> = eight_y / k1;
			<span class="hljs-comment">// k1 and k2 are now two signed integers that multiply to 8y</span>

			<span class="hljs-keyword">let</span> <span class="hljs-variable">two_m</span> = k1 + k2;
			<span class="hljs-keyword">if</span> two_m % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">m</span> = two_m / <span class="hljs-number">2</span>;

			<span class="hljs-comment">// Now, m was 2*vy + 1, and so...</span>
			<span class="hljs-title function_ invoke__">if</span> (m - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = (m - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = m * m - eight_y;
			<span class="hljs-keyword">if</span> discriminant &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt_disc</span> = <span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">unwrap</span>();

			<span class="hljs-keyword">for</span> <span class="hljs-variable">pm</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t_numer</span> = <span class="hljs-number">2</span> * vy + <span class="hljs-number">1</span> + pm * sqrt_disc;
				<span class="hljs-keyword">if</span> t_numer &lt;= <span class="hljs-number">0</span> || t_numer % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
					<span class="hljs-keyword">continue</span>;
				}
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t</span> = t_numer / <span class="hljs-number">2</span>;
				ans.<span class="hljs-title function_ invoke__">push</span>((t, vy));
			}
		}
	}

	ans
}
<span class="hljs-comment">// end::time_finder[]</span>

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();
	<span class="hljs-keyword">let</span> <span class="hljs-variable">trajectories</span> = <span class="hljs-title function_ invoke__">get_trajectories</span>(rect);
	(<span class="hljs-number">17</span>, (<span class="hljs-title function_ invoke__">pt1</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()), <span class="hljs-title function_ invoke__">pt2</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()))).<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::get_traj[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_x</span>(t: Time, vx: Num) <span class="hljs-punctuation">-&gt;</span> Num {
	<span class="hljs-keyword">if</span> t &lt;= vx {
		vx * t - t * (t - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	} <span class="hljs-keyword">else</span> {
		vx * (vx + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_trajectories</span>(rect: Rect&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;Trajectory&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">Rect</span> {
		x_min,
		x_max,
		y_min,
		y_max,
	} = rect;

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">trajectories</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-keyword">for</span> <span class="hljs-variable">y</span> <span class="hljs-keyword">in</span> y_min..=y_max {
		<span class="hljs-keyword">if</span> y == <span class="hljs-number">0</span> {
			<span class="hljs-comment">// If any vx works, then there will be infinitely many choices for vy because it</span>
			<span class="hljs-comment">// retraces its ascent on its descent. And if no vx works, then it&#x27;s moot</span>
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">let</span> <span class="hljs-variable">ts_and_vys</span> = <span class="hljs-title function_ invoke__">find_ts_and_vys_for_y</span>(y);

		<span class="hljs-title function_ invoke__">for</span> (t, vy) <span class="hljs-keyword">in</span> ts_and_vys {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">x</span> <span class="hljs-keyword">in</span> x_min..=x_max {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">velocities</span> = <span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y });

				<span class="hljs-keyword">for</span> <span class="hljs-variable">velo</span> <span class="hljs-keyword">in</span> velocities {
					<span class="hljs-keyword">let</span> <span class="hljs-variable">velo</span> = <span class="hljs-keyword">match</span> velo {
						<span class="hljs-title function_ invoke__">Some</span>(v) =&gt; v,
						<span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">continue</span>,
					};
					<span class="hljs-keyword">if</span> velo.vy == vy &amp;&amp; <span class="hljs-title function_ invoke__">get_x</span>(t, velo.vx) == x {
						trajectories.<span class="hljs-title function_ invoke__">push</span>(Trajectory {
							_t: t,
							_pos: Pos { x, y },
							velo,
						});
					}
				}
			}
		}
	}

	trajectories
}
<span class="hljs-comment">// end::get_traj[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">traj</span> = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = traj.velo.vy;
			<span class="hljs-keyword">if</span> vy &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
			}
			vy * (vy + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
		})
		.<span class="hljs-title function_ invoke__">max</span>()
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">Trajectory</span> { velo, .. } = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			(velo.vx, velo.vy)
		})
		.collect::&lt;Set&lt;_&gt;&gt;()
		.<span class="hljs-title function_ invoke__">len</span>()
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_velocity_finder</span>() {
		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">18</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">22</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">27</span>, -<span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">28</span>, -<span class="hljs-number">7</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">7</span>, vy: <span class="hljs-number">2</span> }
			);
		}

		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">18</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">21</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">8</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">4</span>),
			(<span class="hljs-number">9</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">9</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">6</span>, vy: <span class="hljs-number">3</span> }
			);
		}

		test_input!(<span class="hljs-string">&quot;target area: x=20..30, y=-10..-5&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">45</span>), <span class="hljs-number">112</span>));
		test_input!(<span class="hljs-string">&quot;target area: x=34..35, y=-8..-6&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">3</span>), <span class="hljs-number">9</span>));
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are nearly there!
To find whether, and how, the projectile can reach the point <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span>, we find:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the set of pairs <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(t, v_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> that give the projectile a vertical position of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> at time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, and</p>
</li>
<li>
<p>for each of these pairs, we check that the projectile can indeed reach <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> at time <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> (we know it can reach <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>, but can it reach <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>?) and find the velocities <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>v</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v_x,v_y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> that will achieve that, if possible.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>And we simply do this for every <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">(x,y)\in R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;
<span class="hljs-keyword">use</span> num::integer::Roots;
<span class="hljs-keyword">use</span> std::collections::BTreeSet <span class="hljs-keyword">as</span> Set;

<span class="hljs-comment">// tag::setup_main[]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Time</span> = <span class="hljs-type">i64</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-type">i64</span>;

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Pos</span>&lt;T&gt; {
	x: T,
	y: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Velo</span>&lt;T&gt; {
	vx: T,
	vy: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span>&lt;T&gt; {
	x_min: T,
	x_max: T,
	y_min: T,
	y_max: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Trajectory</span> {
	_t: Time,
	_pos: Pos&lt;Num&gt;,
	velo: Velo&lt;Num&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Rect&lt;Num&gt;&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">re</span> = {
		regex::Regex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">r&quot;target area:\s*x=([\d-]+)\.\.([\d-]+),\s*y=([\d-]+)\.\.([\d-]+)&quot;</span>)
			.<span class="hljs-title function_ invoke__">ok</span>()?
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">caps</span> = re.<span class="hljs-title function_ invoke__">captures</span>(input.<span class="hljs-title function_ invoke__">trim</span>())?;
	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = <span class="hljs-comment">// force line break :/</span>
		[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">map</span>(|i| caps.<span class="hljs-title function_ invoke__">get</span>(i).<span class="hljs-title function_ invoke__">and_then</span>(|m| m.<span class="hljs-title function_ invoke__">as_str</span>().<span class="hljs-title function_ invoke__">parse</span>().<span class="hljs-title function_ invoke__">ok</span>()));

	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = [x1?, x2?, y1?, y2?];

	<span class="hljs-keyword">let</span> [x_min, x_max] = <span class="hljs-keyword">if</span> x1 &lt; x2 { [x1, x2] } <span class="hljs-keyword">else</span> { [x2, x1] };
	<span class="hljs-keyword">let</span> [y_min, y_max] = <span class="hljs-keyword">if</span> y1 &lt; y2 { [y1, y2] } <span class="hljs-keyword">else</span> { [y2, y1] };

	<span class="hljs-title function_ invoke__">Some</span>(Rect {
		x_min,
		x_max,
		y_min,
		y_max,
	})
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sqrt</span>(n: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt</span> = Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;n);
	<span class="hljs-keyword">if</span> sqrt * sqrt == n {
		<span class="hljs-title function_ invoke__">Some</span>(sqrt)
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-literal">None</span>
	}
}

<span class="hljs-comment">// end::setup_main[]</span>

<span class="hljs-comment">// tag::velo_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_velocities</span>(t: Time, position: Pos&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">Option</span>&lt;Velo&lt;Num&gt;&gt;; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-title function_ invoke__">Some</span>(Velo { vx: <span class="hljs-number">0</span>, vy: <span class="hljs-number">0</span> }), <span class="hljs-literal">None</span>];
	}

	<span class="hljs-keyword">let</span> <span class="hljs-variable">Pos</span> { x, y } = position;

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_numer</span> = <span class="hljs-number">2</span> * y + t * (t - <span class="hljs-number">1</span>);
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_denom</span> = <span class="hljs-number">2</span> * t;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = <span class="hljs-keyword">if</span> vy_numer % vy_denom == <span class="hljs-number">0</span> {
		vy_numer / vy_denom
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>];
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx1</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = <span class="hljs-number">2</span> * x + t * (t - <span class="hljs-number">1</span>);
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span> * t;
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
		<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &gt;= t {
			<span class="hljs-title function_ invoke__">Some</span>(vx)
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-literal">None</span>
		}
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx2</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = <span class="hljs-number">1</span> + <span class="hljs-number">8</span> * x;
		<span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">and_then</span>(|sqrt_disc| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = sqrt_disc - <span class="hljs-number">1</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
			<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &lt;= t {
				<span class="hljs-title function_ invoke__">Some</span>(vx)
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-literal">None</span>
			}
		})
	};

	[vx1, vx2].<span class="hljs-title function_ invoke__">map</span>(|opt_vx| opt_vx.<span class="hljs-title function_ invoke__">map</span>(|vx| Velo { vx, vy }))
}
<span class="hljs-comment">// end::velo_finder[]</span>

<span class="hljs-comment">// tag::time_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_ts_and_vys_for_y</span>(y: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;(Time, Num)&gt; {
	<span class="hljs-built_in">assert_ne!</span>(y, <span class="hljs-number">0</span>);

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">ans</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-comment">// Need to find all integer (t, vy) that satisfy y = vy * t - t*(t-1)/2 with t &gt; 0</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// Step one: (2*vy + 1)^2 - 8*y = must be square</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// In other words there must exist integral m and n such that m^2 - n^2 = 8y (with</span>
	<span class="hljs-comment">// 2*vy + 1 = m). m^2 - n^2 = (m-n)*(m+n), and so...</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">eight_y</span> = <span class="hljs-number">8</span> * y;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">abs_eight_y</span> = eight_y.<span class="hljs-title function_ invoke__">abs</span>();
	<span class="hljs-keyword">for</span> <span class="hljs-variable">k1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;abs_eight_y) {
		<span class="hljs-keyword">if</span> abs_eight_y % k1 != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">for</span> <span class="hljs-variable">sign</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k1</span> = sign * k1;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k2</span> = eight_y / k1;
			<span class="hljs-comment">// k1 and k2 are now two signed integers that multiply to 8y</span>

			<span class="hljs-keyword">let</span> <span class="hljs-variable">two_m</span> = k1 + k2;
			<span class="hljs-keyword">if</span> two_m % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">m</span> = two_m / <span class="hljs-number">2</span>;

			<span class="hljs-comment">// Now, m was 2*vy + 1, and so...</span>
			<span class="hljs-title function_ invoke__">if</span> (m - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = (m - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = m * m - eight_y;
			<span class="hljs-keyword">if</span> discriminant &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt_disc</span> = <span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">unwrap</span>();

			<span class="hljs-keyword">for</span> <span class="hljs-variable">pm</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t_numer</span> = <span class="hljs-number">2</span> * vy + <span class="hljs-number">1</span> + pm * sqrt_disc;
				<span class="hljs-keyword">if</span> t_numer &lt;= <span class="hljs-number">0</span> || t_numer % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
					<span class="hljs-keyword">continue</span>;
				}
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t</span> = t_numer / <span class="hljs-number">2</span>;
				ans.<span class="hljs-title function_ invoke__">push</span>((t, vy));
			}
		}
	}

	ans
}
<span class="hljs-comment">// end::time_finder[]</span>

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();
	<span class="hljs-keyword">let</span> <span class="hljs-variable">trajectories</span> = <span class="hljs-title function_ invoke__">get_trajectories</span>(rect);
	(<span class="hljs-number">17</span>, (<span class="hljs-title function_ invoke__">pt1</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()), <span class="hljs-title function_ invoke__">pt2</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()))).<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::get_traj[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_x</span>(t: Time, vx: Num) <span class="hljs-punctuation">-&gt;</span> Num {
	<span class="hljs-keyword">if</span> t &lt;= vx {
		vx * t - t * (t - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	} <span class="hljs-keyword">else</span> {
		vx * (vx + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_trajectories</span>(rect: Rect&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;Trajectory&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">Rect</span> {
		x_min,
		x_max,
		y_min,
		y_max,
	} = rect;

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">trajectories</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-keyword">for</span> <span class="hljs-variable">y</span> <span class="hljs-keyword">in</span> y_min..=y_max {
		<span class="hljs-keyword">if</span> y == <span class="hljs-number">0</span> {
			<span class="hljs-comment">// If any vx works, then there will be infinitely many choices for vy because it</span>
			<span class="hljs-comment">// retraces its ascent on its descent. And if no vx works, then it&#x27;s moot</span>
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">let</span> <span class="hljs-variable">ts_and_vys</span> = <span class="hljs-title function_ invoke__">find_ts_and_vys_for_y</span>(y);

		<span class="hljs-title function_ invoke__">for</span> (t, vy) <span class="hljs-keyword">in</span> ts_and_vys {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">x</span> <span class="hljs-keyword">in</span> x_min..=x_max {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">velocities</span> = <span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y });

				<span class="hljs-keyword">for</span> <span class="hljs-variable">velo</span> <span class="hljs-keyword">in</span> velocities {
					<span class="hljs-keyword">let</span> <span class="hljs-variable">velo</span> = <span class="hljs-keyword">match</span> velo {
						<span class="hljs-title function_ invoke__">Some</span>(v) =&gt; v,
						<span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">continue</span>,
					};
					<span class="hljs-keyword">if</span> velo.vy == vy &amp;&amp; <span class="hljs-title function_ invoke__">get_x</span>(t, velo.vx) == x {
						trajectories.<span class="hljs-title function_ invoke__">push</span>(Trajectory {
							_t: t,
							_pos: Pos { x, y },
							velo,
						});
					}
				}
			}
		}
	}

	trajectories
}
<span class="hljs-comment">// end::get_traj[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">traj</span> = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = traj.velo.vy;
			<span class="hljs-keyword">if</span> vy &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
			}
			vy * (vy + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
		})
		.<span class="hljs-title function_ invoke__">max</span>()
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">Trajectory</span> { velo, .. } = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			(velo.vx, velo.vy)
		})
		.collect::&lt;Set&lt;_&gt;&gt;()
		.<span class="hljs-title function_ invoke__">len</span>()
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_velocity_finder</span>() {
		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">18</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">22</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">27</span>, -<span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">28</span>, -<span class="hljs-number">7</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">7</span>, vy: <span class="hljs-number">2</span> }
			);
		}

		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">18</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">21</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">8</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">4</span>),
			(<span class="hljs-number">9</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">9</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">6</span>, vy: <span class="hljs-number">3</span> }
			);
		}

		test_input!(<span class="hljs-string">&quot;target area: x=20..30, y=-10..-5&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">45</span>), <span class="hljs-number">112</span>));
		test_input!(<span class="hljs-string">&quot;target area: x=34..35, y=-8..-6&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">3</span>), <span class="hljs-number">9</span>));
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we get all the trajectories, the actual answers we&#8217;re asked for are pretty simple.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_part_1"><a class="anchor" href="#_part_1"></a>Part 1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part 1 asks us to find the maximum possible height that can be achieved by a projectile that reaches <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>.
As we said above, a projectile with initial <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-velocity <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">v_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> reaches an apex of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><msub><mi>v</mi><mi>y</mi></msub><mo stretchy="false">(</mo><msub><mi>v</mi><mi>y</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{1}{2}v_y(v_y+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;
<span class="hljs-keyword">use</span> num::integer::Roots;
<span class="hljs-keyword">use</span> std::collections::BTreeSet <span class="hljs-keyword">as</span> Set;

<span class="hljs-comment">// tag::setup_main[]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Time</span> = <span class="hljs-type">i64</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-type">i64</span>;

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Pos</span>&lt;T&gt; {
	x: T,
	y: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Velo</span>&lt;T&gt; {
	vx: T,
	vy: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span>&lt;T&gt; {
	x_min: T,
	x_max: T,
	y_min: T,
	y_max: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Trajectory</span> {
	_t: Time,
	_pos: Pos&lt;Num&gt;,
	velo: Velo&lt;Num&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Rect&lt;Num&gt;&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">re</span> = {
		regex::Regex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">r&quot;target area:\s*x=([\d-]+)\.\.([\d-]+),\s*y=([\d-]+)\.\.([\d-]+)&quot;</span>)
			.<span class="hljs-title function_ invoke__">ok</span>()?
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">caps</span> = re.<span class="hljs-title function_ invoke__">captures</span>(input.<span class="hljs-title function_ invoke__">trim</span>())?;
	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = <span class="hljs-comment">// force line break :/</span>
		[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">map</span>(|i| caps.<span class="hljs-title function_ invoke__">get</span>(i).<span class="hljs-title function_ invoke__">and_then</span>(|m| m.<span class="hljs-title function_ invoke__">as_str</span>().<span class="hljs-title function_ invoke__">parse</span>().<span class="hljs-title function_ invoke__">ok</span>()));

	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = [x1?, x2?, y1?, y2?];

	<span class="hljs-keyword">let</span> [x_min, x_max] = <span class="hljs-keyword">if</span> x1 &lt; x2 { [x1, x2] } <span class="hljs-keyword">else</span> { [x2, x1] };
	<span class="hljs-keyword">let</span> [y_min, y_max] = <span class="hljs-keyword">if</span> y1 &lt; y2 { [y1, y2] } <span class="hljs-keyword">else</span> { [y2, y1] };

	<span class="hljs-title function_ invoke__">Some</span>(Rect {
		x_min,
		x_max,
		y_min,
		y_max,
	})
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sqrt</span>(n: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt</span> = Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;n);
	<span class="hljs-keyword">if</span> sqrt * sqrt == n {
		<span class="hljs-title function_ invoke__">Some</span>(sqrt)
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-literal">None</span>
	}
}

<span class="hljs-comment">// end::setup_main[]</span>

<span class="hljs-comment">// tag::velo_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_velocities</span>(t: Time, position: Pos&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">Option</span>&lt;Velo&lt;Num&gt;&gt;; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-title function_ invoke__">Some</span>(Velo { vx: <span class="hljs-number">0</span>, vy: <span class="hljs-number">0</span> }), <span class="hljs-literal">None</span>];
	}

	<span class="hljs-keyword">let</span> <span class="hljs-variable">Pos</span> { x, y } = position;

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_numer</span> = <span class="hljs-number">2</span> * y + t * (t - <span class="hljs-number">1</span>);
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_denom</span> = <span class="hljs-number">2</span> * t;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = <span class="hljs-keyword">if</span> vy_numer % vy_denom == <span class="hljs-number">0</span> {
		vy_numer / vy_denom
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>];
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx1</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = <span class="hljs-number">2</span> * x + t * (t - <span class="hljs-number">1</span>);
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span> * t;
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
		<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &gt;= t {
			<span class="hljs-title function_ invoke__">Some</span>(vx)
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-literal">None</span>
		}
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx2</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = <span class="hljs-number">1</span> + <span class="hljs-number">8</span> * x;
		<span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">and_then</span>(|sqrt_disc| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = sqrt_disc - <span class="hljs-number">1</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
			<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &lt;= t {
				<span class="hljs-title function_ invoke__">Some</span>(vx)
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-literal">None</span>
			}
		})
	};

	[vx1, vx2].<span class="hljs-title function_ invoke__">map</span>(|opt_vx| opt_vx.<span class="hljs-title function_ invoke__">map</span>(|vx| Velo { vx, vy }))
}
<span class="hljs-comment">// end::velo_finder[]</span>

<span class="hljs-comment">// tag::time_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_ts_and_vys_for_y</span>(y: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;(Time, Num)&gt; {
	<span class="hljs-built_in">assert_ne!</span>(y, <span class="hljs-number">0</span>);

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">ans</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-comment">// Need to find all integer (t, vy) that satisfy y = vy * t - t*(t-1)/2 with t &gt; 0</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// Step one: (2*vy + 1)^2 - 8*y = must be square</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// In other words there must exist integral m and n such that m^2 - n^2 = 8y (with</span>
	<span class="hljs-comment">// 2*vy + 1 = m). m^2 - n^2 = (m-n)*(m+n), and so...</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">eight_y</span> = <span class="hljs-number">8</span> * y;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">abs_eight_y</span> = eight_y.<span class="hljs-title function_ invoke__">abs</span>();
	<span class="hljs-keyword">for</span> <span class="hljs-variable">k1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;abs_eight_y) {
		<span class="hljs-keyword">if</span> abs_eight_y % k1 != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">for</span> <span class="hljs-variable">sign</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k1</span> = sign * k1;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k2</span> = eight_y / k1;
			<span class="hljs-comment">// k1 and k2 are now two signed integers that multiply to 8y</span>

			<span class="hljs-keyword">let</span> <span class="hljs-variable">two_m</span> = k1 + k2;
			<span class="hljs-keyword">if</span> two_m % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">m</span> = two_m / <span class="hljs-number">2</span>;

			<span class="hljs-comment">// Now, m was 2*vy + 1, and so...</span>
			<span class="hljs-title function_ invoke__">if</span> (m - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = (m - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = m * m - eight_y;
			<span class="hljs-keyword">if</span> discriminant &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt_disc</span> = <span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">unwrap</span>();

			<span class="hljs-keyword">for</span> <span class="hljs-variable">pm</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t_numer</span> = <span class="hljs-number">2</span> * vy + <span class="hljs-number">1</span> + pm * sqrt_disc;
				<span class="hljs-keyword">if</span> t_numer &lt;= <span class="hljs-number">0</span> || t_numer % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
					<span class="hljs-keyword">continue</span>;
				}
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t</span> = t_numer / <span class="hljs-number">2</span>;
				ans.<span class="hljs-title function_ invoke__">push</span>((t, vy));
			}
		}
	}

	ans
}
<span class="hljs-comment">// end::time_finder[]</span>

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();
	<span class="hljs-keyword">let</span> <span class="hljs-variable">trajectories</span> = <span class="hljs-title function_ invoke__">get_trajectories</span>(rect);
	(<span class="hljs-number">17</span>, (<span class="hljs-title function_ invoke__">pt1</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()), <span class="hljs-title function_ invoke__">pt2</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()))).<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::get_traj[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_x</span>(t: Time, vx: Num) <span class="hljs-punctuation">-&gt;</span> Num {
	<span class="hljs-keyword">if</span> t &lt;= vx {
		vx * t - t * (t - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	} <span class="hljs-keyword">else</span> {
		vx * (vx + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_trajectories</span>(rect: Rect&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;Trajectory&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">Rect</span> {
		x_min,
		x_max,
		y_min,
		y_max,
	} = rect;

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">trajectories</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-keyword">for</span> <span class="hljs-variable">y</span> <span class="hljs-keyword">in</span> y_min..=y_max {
		<span class="hljs-keyword">if</span> y == <span class="hljs-number">0</span> {
			<span class="hljs-comment">// If any vx works, then there will be infinitely many choices for vy because it</span>
			<span class="hljs-comment">// retraces its ascent on its descent. And if no vx works, then it&#x27;s moot</span>
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">let</span> <span class="hljs-variable">ts_and_vys</span> = <span class="hljs-title function_ invoke__">find_ts_and_vys_for_y</span>(y);

		<span class="hljs-title function_ invoke__">for</span> (t, vy) <span class="hljs-keyword">in</span> ts_and_vys {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">x</span> <span class="hljs-keyword">in</span> x_min..=x_max {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">velocities</span> = <span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y });

				<span class="hljs-keyword">for</span> <span class="hljs-variable">velo</span> <span class="hljs-keyword">in</span> velocities {
					<span class="hljs-keyword">let</span> <span class="hljs-variable">velo</span> = <span class="hljs-keyword">match</span> velo {
						<span class="hljs-title function_ invoke__">Some</span>(v) =&gt; v,
						<span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">continue</span>,
					};
					<span class="hljs-keyword">if</span> velo.vy == vy &amp;&amp; <span class="hljs-title function_ invoke__">get_x</span>(t, velo.vx) == x {
						trajectories.<span class="hljs-title function_ invoke__">push</span>(Trajectory {
							_t: t,
							_pos: Pos { x, y },
							velo,
						});
					}
				}
			}
		}
	}

	trajectories
}
<span class="hljs-comment">// end::get_traj[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">traj</span> = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = traj.velo.vy;
			<span class="hljs-keyword">if</span> vy &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
			}
			vy * (vy + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
		})
		.<span class="hljs-title function_ invoke__">max</span>()
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">Trajectory</span> { velo, .. } = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			(velo.vx, velo.vy)
		})
		.collect::&lt;Set&lt;_&gt;&gt;()
		.<span class="hljs-title function_ invoke__">len</span>()
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_velocity_finder</span>() {
		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">18</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">22</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">27</span>, -<span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">28</span>, -<span class="hljs-number">7</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">7</span>, vy: <span class="hljs-number">2</span> }
			);
		}

		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">18</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">21</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">8</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">4</span>),
			(<span class="hljs-number">9</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">9</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">6</span>, vy: <span class="hljs-number">3</span> }
			);
		}

		test_input!(<span class="hljs-string">&quot;target area: x=20..30, y=-10..-5&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">45</span>), <span class="hljs-number">112</span>));
		test_input!(<span class="hljs-string">&quot;target area: x=34..35, y=-8..-6&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">3</span>), <span class="hljs-number">9</span>));
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_part_2"><a class="anchor" href="#_part_2"></a>Part 2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part 2 asks us to simply count distinct initial velocities that land the projectile in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;
<span class="hljs-keyword">use</span> num::integer::Roots;
<span class="hljs-keyword">use</span> std::collections::BTreeSet <span class="hljs-keyword">as</span> Set;

<span class="hljs-comment">// tag::setup_main[]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Time</span> = <span class="hljs-type">i64</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = <span class="hljs-type">i64</span>;

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Pos</span>&lt;T&gt; {
	x: T,
	y: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Velo</span>&lt;T&gt; {
	vx: T,
	vy: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span>&lt;T&gt; {
	x_min: T,
	x_max: T,
	y_min: T,
	y_max: T,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Trajectory</span> {
	_t: Time,
	_pos: Pos&lt;Num&gt;,
	velo: Velo&lt;Num&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Rect&lt;Num&gt;&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">re</span> = {
		regex::Regex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">r&quot;target area:\s*x=([\d-]+)\.\.([\d-]+),\s*y=([\d-]+)\.\.([\d-]+)&quot;</span>)
			.<span class="hljs-title function_ invoke__">ok</span>()?
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">caps</span> = re.<span class="hljs-title function_ invoke__">captures</span>(input.<span class="hljs-title function_ invoke__">trim</span>())?;
	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = <span class="hljs-comment">// force line break :/</span>
		[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">map</span>(|i| caps.<span class="hljs-title function_ invoke__">get</span>(i).<span class="hljs-title function_ invoke__">and_then</span>(|m| m.<span class="hljs-title function_ invoke__">as_str</span>().<span class="hljs-title function_ invoke__">parse</span>().<span class="hljs-title function_ invoke__">ok</span>()));

	<span class="hljs-keyword">let</span> [x1, x2, y1, y2] = [x1?, x2?, y1?, y2?];

	<span class="hljs-keyword">let</span> [x_min, x_max] = <span class="hljs-keyword">if</span> x1 &lt; x2 { [x1, x2] } <span class="hljs-keyword">else</span> { [x2, x1] };
	<span class="hljs-keyword">let</span> [y_min, y_max] = <span class="hljs-keyword">if</span> y1 &lt; y2 { [y1, y2] } <span class="hljs-keyword">else</span> { [y2, y1] };

	<span class="hljs-title function_ invoke__">Some</span>(Rect {
		x_min,
		x_max,
		y_min,
		y_max,
	})
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">sqrt</span>(n: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt</span> = Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;n);
	<span class="hljs-keyword">if</span> sqrt * sqrt == n {
		<span class="hljs-title function_ invoke__">Some</span>(sqrt)
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-literal">None</span>
	}
}

<span class="hljs-comment">// end::setup_main[]</span>

<span class="hljs-comment">// tag::velo_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_velocities</span>(t: Time, position: Pos&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">Option</span>&lt;Velo&lt;Num&gt;&gt;; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-title function_ invoke__">Some</span>(Velo { vx: <span class="hljs-number">0</span>, vy: <span class="hljs-number">0</span> }), <span class="hljs-literal">None</span>];
	}

	<span class="hljs-keyword">let</span> <span class="hljs-variable">Pos</span> { x, y } = position;

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_numer</span> = <span class="hljs-number">2</span> * y + t * (t - <span class="hljs-number">1</span>);
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy_denom</span> = <span class="hljs-number">2</span> * t;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = <span class="hljs-keyword">if</span> vy_numer % vy_denom == <span class="hljs-number">0</span> {
		vy_numer / vy_denom
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>];
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx1</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = <span class="hljs-number">2</span> * x + t * (t - <span class="hljs-number">1</span>);
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span> * t;
		<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
		<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &gt;= t {
			<span class="hljs-title function_ invoke__">Some</span>(vx)
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-literal">None</span>
		}
	};

	<span class="hljs-keyword">let</span> <span class="hljs-variable">vx2</span> = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = <span class="hljs-number">1</span> + <span class="hljs-number">8</span> * x;
		<span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">and_then</span>(|sqrt_disc| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_numer</span> = sqrt_disc - <span class="hljs-number">1</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx_denom</span> = <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vx</span> = vx_numer / vx_denom;
			<span class="hljs-keyword">if</span> vx_numer % vx_denom == <span class="hljs-number">0</span> &amp;&amp; vx &lt;= t {
				<span class="hljs-title function_ invoke__">Some</span>(vx)
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-literal">None</span>
			}
		})
	};

	[vx1, vx2].<span class="hljs-title function_ invoke__">map</span>(|opt_vx| opt_vx.<span class="hljs-title function_ invoke__">map</span>(|vx| Velo { vx, vy }))
}
<span class="hljs-comment">// end::velo_finder[]</span>

<span class="hljs-comment">// tag::time_finder[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_ts_and_vys_for_y</span>(y: Num) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;(Time, Num)&gt; {
	<span class="hljs-built_in">assert_ne!</span>(y, <span class="hljs-number">0</span>);

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">ans</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-comment">// Need to find all integer (t, vy) that satisfy y = vy * t - t*(t-1)/2 with t &gt; 0</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// Step one: (2*vy + 1)^2 - 8*y = must be square</span>
	<span class="hljs-comment">//</span>
	<span class="hljs-comment">// In other words there must exist integral m and n such that m^2 - n^2 = 8y (with</span>
	<span class="hljs-comment">// 2*vy + 1 = m). m^2 - n^2 = (m-n)*(m+n), and so...</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">eight_y</span> = <span class="hljs-number">8</span> * y;
	<span class="hljs-keyword">let</span> <span class="hljs-variable">abs_eight_y</span> = eight_y.<span class="hljs-title function_ invoke__">abs</span>();
	<span class="hljs-keyword">for</span> <span class="hljs-variable">k1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=Roots::<span class="hljs-title function_ invoke__">sqrt</span>(&amp;abs_eight_y) {
		<span class="hljs-keyword">if</span> abs_eight_y % k1 != <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">for</span> <span class="hljs-variable">sign</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k1</span> = sign * k1;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">k2</span> = eight_y / k1;
			<span class="hljs-comment">// k1 and k2 are now two signed integers that multiply to 8y</span>

			<span class="hljs-keyword">let</span> <span class="hljs-variable">two_m</span> = k1 + k2;
			<span class="hljs-keyword">if</span> two_m % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">m</span> = two_m / <span class="hljs-number">2</span>;

			<span class="hljs-comment">// Now, m was 2*vy + 1, and so...</span>
			<span class="hljs-title function_ invoke__">if</span> (m - <span class="hljs-number">1</span>) % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = (m - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>;
			<span class="hljs-keyword">let</span> <span class="hljs-variable">discriminant</span> = m * m - eight_y;
			<span class="hljs-keyword">if</span> discriminant &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">let</span> <span class="hljs-variable">sqrt_disc</span> = <span class="hljs-title function_ invoke__">sqrt</span>(discriminant).<span class="hljs-title function_ invoke__">unwrap</span>();

			<span class="hljs-keyword">for</span> <span class="hljs-variable">pm</span> <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t_numer</span> = <span class="hljs-number">2</span> * vy + <span class="hljs-number">1</span> + pm * sqrt_disc;
				<span class="hljs-keyword">if</span> t_numer &lt;= <span class="hljs-number">0</span> || t_numer % <span class="hljs-number">2</span> != <span class="hljs-number">0</span> {
					<span class="hljs-keyword">continue</span>;
				}
				<span class="hljs-keyword">let</span> <span class="hljs-variable">t</span> = t_numer / <span class="hljs-number">2</span>;
				ans.<span class="hljs-title function_ invoke__">push</span>((t, vy));
			}
		}
	}

	ans
}
<span class="hljs-comment">// end::time_finder[]</span>

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();
	<span class="hljs-keyword">let</span> <span class="hljs-variable">trajectories</span> = <span class="hljs-title function_ invoke__">get_trajectories</span>(rect);
	(<span class="hljs-number">17</span>, (<span class="hljs-title function_ invoke__">pt1</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()), <span class="hljs-title function_ invoke__">pt2</span>(trajectories.<span class="hljs-title function_ invoke__">iter</span>()))).<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">Option</span>&lt;Num&gt;, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::get_traj[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_x</span>(t: Time, vx: Num) <span class="hljs-punctuation">-&gt;</span> Num {
	<span class="hljs-keyword">if</span> t &lt;= vx {
		vx * t - t * (t - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	} <span class="hljs-keyword">else</span> {
		vx * (vx + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_trajectories</span>(rect: Rect&lt;Num&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;Trajectory&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">Rect</span> {
		x_min,
		x_max,
		y_min,
		y_max,
	} = rect;

	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">trajectories</span> = <span class="hljs-built_in">vec!</span>[];

	<span class="hljs-keyword">for</span> <span class="hljs-variable">y</span> <span class="hljs-keyword">in</span> y_min..=y_max {
		<span class="hljs-keyword">if</span> y == <span class="hljs-number">0</span> {
			<span class="hljs-comment">// If any vx works, then there will be infinitely many choices for vy because it</span>
			<span class="hljs-comment">// retraces its ascent on its descent. And if no vx works, then it&#x27;s moot</span>
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">let</span> <span class="hljs-variable">ts_and_vys</span> = <span class="hljs-title function_ invoke__">find_ts_and_vys_for_y</span>(y);

		<span class="hljs-title function_ invoke__">for</span> (t, vy) <span class="hljs-keyword">in</span> ts_and_vys {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">x</span> <span class="hljs-keyword">in</span> x_min..=x_max {
				<span class="hljs-keyword">let</span> <span class="hljs-variable">velocities</span> = <span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y });

				<span class="hljs-keyword">for</span> <span class="hljs-variable">velo</span> <span class="hljs-keyword">in</span> velocities {
					<span class="hljs-keyword">let</span> <span class="hljs-variable">velo</span> = <span class="hljs-keyword">match</span> velo {
						<span class="hljs-title function_ invoke__">Some</span>(v) =&gt; v,
						<span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">continue</span>,
					};
					<span class="hljs-keyword">if</span> velo.vy == vy &amp;&amp; <span class="hljs-title function_ invoke__">get_x</span>(t, velo.vx) == x {
						trajectories.<span class="hljs-title function_ invoke__">push</span>(Trajectory {
							_t: t,
							_pos: Pos { x, y },
							velo,
						});
					}
				}
			}
		}
	}

	trajectories
}
<span class="hljs-comment">// end::get_traj[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Num&gt; {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">traj</span> = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			<span class="hljs-keyword">let</span> <span class="hljs-variable">vy</span> = traj.velo.vy;
			<span class="hljs-keyword">if</span> vy &lt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
			}
			vy * (vy + <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>
		})
		.<span class="hljs-title function_ invoke__">max</span>()
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>&lt;T: std::borrow::Borrow&lt;Trajectory&gt;&gt;(trajectories: <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Iterator</span>&lt;Item = T&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	trajectories
		.<span class="hljs-title function_ invoke__">map</span>(|traj| {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">Trajectory</span> { velo, .. } = *traj.<span class="hljs-title function_ invoke__">borrow</span>();
			(velo.vx, velo.vy)
		})
		.collect::&lt;Set&lt;_&gt;&gt;()
		.<span class="hljs-title function_ invoke__">len</span>()
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_velocity_finder</span>() {
		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">18</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">22</span>, <span class="hljs-number">2</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">25</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">27</span>, -<span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">28</span>, -<span class="hljs-number">7</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">7</span>, vy: <span class="hljs-number">2</span> }
			);
		}

		<span class="hljs-title function_ invoke__">for</span> (t, x, y) <span class="hljs-keyword">in</span> [
			(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">2</span>, <span class="hljs-number">11</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">4</span>, <span class="hljs-number">18</span>, <span class="hljs-number">6</span>),
			(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>),
			(<span class="hljs-number">6</span>, <span class="hljs-number">21</span>, <span class="hljs-number">3</span>),
			(<span class="hljs-number">7</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>),
			(<span class="hljs-number">8</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">4</span>),
			(<span class="hljs-number">9</span>, <span class="hljs-number">21</span>, -<span class="hljs-number">9</span>),
		] {
			<span class="hljs-built_in">assert_eq!</span>(
				<span class="hljs-title function_ invoke__">find_velocities</span>(t, Pos { x, y })
					.<span class="hljs-title function_ invoke__">iter</span>()
					.<span class="hljs-title function_ invoke__">flatten</span>()
					.<span class="hljs-title function_ invoke__">next</span>()
					.<span class="hljs-title function_ invoke__">unwrap</span>(),
				&amp;Velo { vx: <span class="hljs-number">6</span>, vy: <span class="hljs-number">3</span> }
			);
		}

		test_input!(<span class="hljs-string">&quot;target area: x=20..30, y=-10..-5&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">45</span>), <span class="hljs-number">112</span>));
		test_input!(<span class="hljs-string">&quot;target area: x=34..35, y=-8..-6&quot;</span>, day: <span class="hljs-number">17</span>, ans: (<span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">3</span>), <span class="hljs-number">9</span>));
	}
}</code></pre>
</div>
</div>
</div>
</div>     <nav class="pagination">
        <span class="prev"><a href="../day_16/soln">Day 16: Packet Decoder</a></span>
        <span class="next"><a href="../day_18/soln">Day 18: Snailfish</a></span>
    </nav>

</article>
  </div>
  <footer class="footer">
  <p>This page was built using <a href="https://antora.org" target="_blank">Antora</a> with a theme forked from the <a
      href="https://gitlab.com/antora/antora-ui-default" target="_blank">default UI</a>. Search is powered by <a
      href="https://lunrjs.com" target="_blank">Lunr</a>.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script>
	function add_is_current_path() {
		let elem = document.querySelector(`.nav-container .is-current-page > .final-depth`);
		if (!elem) { return; }
		while (!elem.classList.contains("nav-panel-explore")) {
			if (elem.tagName === "LI") {
				elem.classList.add("is-current-path");
			}
			elem = elem.parentNode;
		}
	}
	add_is_current_path()
</script>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
	<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
<script>
	function set_up_footnotes() {
		let footnoteBox;
		let footnoteP;
		const _isMobile = "ontouchstart" in document.documentElement;

		// Apparently, sticking the tooltip in a child div of document.body, instead of in
		// document.body directly, helps performance.
		// https://atfzl.com/don-t-attach-tooltips-to-document-body
		const footnoteHolder = document.createElement("div");
		document.body.appendChild(footnoteHolder);

		function showFootnoteBoxOnHover(elem) {
			const FOOTNOTE_BOX_MAX_WIDTH = 400;

			if (footnoteBox === undefined) {
				footnoteBox = document.createElement("div");
				footnoteHolder.appendChild(footnoteBox);
				footnoteBox.classList.add("footnote-box");
				footnoteBox.addEventListener("mouseleave", () => removeFootnoteBox());

				footnoteP = document.createElement("p");
				footnoteBox.appendChild(footnoteP);

				footnoteBox.style.zIndex = 9999;
			}

			// Remove the numbering from this footnote box
			const footnoteId = elem.getAttribute("href"); // Starts with #
			const footnoteClone = document
				.getElementById(footnoteId.substring(1))
				.cloneNode(true);
			const footnoteA = footnoteClone.getElementsByTagName("a")[0];
			footnoteA.remove();

			const footnoteHtml = footnoteClone.innerHTML.replace(/^\s*\.\s*/, "");

			footnoteP.innerHTML = footnoteHtml;
			footnoteBox.style.right = null;
			footnoteBox.style.left = "0px";
			footnoteBox.style.top = "0px";

			const elemRect = elem.getBoundingClientRect();
			const bodyRect = document.body.getBoundingClientRect();

			footnoteBox.style.display = "block";

			let tx = false;
			let ty = false;

			if (elemRect.left - FOOTNOTE_BOX_MAX_WIDTH < 10) {
				const px = -bodyRect.left + 10;
				footnoteBox.style.left = `${px}px`;

				tx = true;
			} else {
				const px = elemRect.left - bodyRect.left + 20;
				footnoteBox.style.left = `${px}px`;
			}

			const footnoteRect = footnoteBox.getBoundingClientRect();

			const windowHeight = document.documentElement.clientHeight;
			if (elemRect.top + footnoteRect.height > windowHeight) {
				const py = -10 + window.scrollY + windowHeight;
				footnoteBox.style.top = `${py}px`;
			} else {
				const py = elemRect.top - bodyRect.top;
				footnoteBox.style.top = `${py}px`;

				ty = true;
			}

			footnoteBox.style.transform = (() => {
				let transX = tx ? 0 : "-100%";
				let transY = ty ? 0 : "-100%";
				return `translate(${transX}, ${transY})`;
			})();

			// if (elemRect.right + FOOTNOTE_BOX_MAX_WIDTH - 30 > bodyRect.right) {
			// 	const px = bodyRect.right - (bodyRect.left + bodyRect.width);
			// 	console.log(bodyRect);
			// 	footnoteBox.style.left = null;
			// 	footnoteBox.style.right = `${px}px`;
			// 	console.log("right");
			// } else {
			// 	const px = -10 + elemRect.left - bodyRect.left;
			// 	footnoteBox.style.right = null;
			// 	footnoteBox.style.left = `${px}px`;
			// 	console.log("left");
			// }
		}

		function removeFootnoteBox() {
			if (footnoteBox === undefined) {
				return;
			}
			footnoteBox.style.display = "none";
		}

		function initializeFootnotes() {
			const footnotes = document.querySelectorAll(
				":not(#footnotes) .footnote a.footnote",
			);
			const nFootnotes = footnotes.length;
			for (let i = 0; i < nFootnotes; i++) {
				const footnote = footnotes[i];
				footnote.addEventListener("mouseenter", event => {
					showFootnoteBoxOnHover(footnote);
				});
			}
		}

		if (!_isMobile) {
			initializeFootnotes();
		}
	}
	set_up_footnotes()
</script>
<script>
	function add_titles() {
		const elems = document.querySelectorAll(".ui-icon.nav-menu-icon");
		for (let i = 0, len = elems.length; i < len; i++) {
			const elem = elems[i];
			if (elem.getAttribute('title') === null) {
				elems[i].setAttribute("title", "Navigation menu icon: one bullet followed by three sub-bullets");
			}
		}
	}
	add_titles()
</script>
</main>
</div>
</body>

</html>
