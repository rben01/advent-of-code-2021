<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Day 11: Dumbo Octopus</title>
<link rel="stylesheet" href="./../aoc.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<!-- <script defer src="https://use.fontawesome.com/releases/v5.0.4/js/all.js"></script> -->
<link rel="preconnect" href="https://fonts.googleapis.com" /><link
	rel="preconnect"
	href="https://fonts.gstatic.com"
	crossorigin
/><link
	href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
	rel="stylesheet"
/>

<link
	rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"
	integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw"
	crossorigin="anonymous"
/>

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js"
	integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH"
	crossorigin="anonymous"
></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js"
	integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v"
	crossorigin="anonymous"
	onload="renderMathInElement(document.body);"
></script>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="paragraph">
<p><a href="../advent_of_code_2021.html#_problems_and_solutions" class="header-nav-link first"><span class="icon"><i class="fa fa-list-ol"></i></span> Back to Home</a>
<a href="././day_10.html" class="header-nav-link"><span class="icon"><i class="fa fa-chevron-left"></i></span> Previous (Day 10)</a>
<a href="././day_12.html" class="header-nav-link">Next (Day 12) <span class="icon"><i class="fa fa-chevron-right"></i></span></a></p>
</div>
<div class="sect1">
<h2 id="_day_11_dumbo_octopus">Day 11: Dumbo Octopus</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/11" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 11 problem description</a> â”‚ <a href="../../src/day_11/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>These problems where you just have to manage the state of an array and update it correctly, and potentially query the state of the array, aren&#8217;t that interesting to me anymore.
There is no algorithmic interestingness to them.</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use crate::Answer;
use ndarray::prelude::*;

#[derive(Clone, Debug)]
struct Octopi {
	arr: Array2&lt;usize&gt;,
}

impl Octopi {
	fn from_str(s: &amp;str) -&gt; Option&lt;Self&gt; {
		let mut data = Vec::new();
		let width = s.lines().next()?.len();
		let height = s.lines().count();
		for line in s.lines() {
			data.extend(
				line.trim()
					.chars()
					.map(|c| c.to_digit(10).and_then(|d| usize::try_from(d).ok())),
			);
		}
		let data = data.into_iter().collect::&lt;Option&lt;Vec&lt;_&gt;&gt;&gt;()?;
		let arr = Array2::from_shape_vec((width, height), data).ok()?;
		Some(Self { arr })
	}

	fn tick_in_place_and_count_flashes(&amp;mut self) -&gt; usize {
		// We use equality with FLASH_THRESH to mean "will flash right now", whereas being
		// greater than FLASH_THRESH means "has already flashed (and won't flash again)"
		let flash_thresh = 10;

		let (n_rows, n_cols) = self.arr.dim();

		self.arr.mapv_inplace(|x| x + 1);
		let mut n_flashes = 0;

		loop {
			let flashing_octopi_idxs = (0..n_rows)
				.flat_map(|r| {
					let arr = &amp;self.arr;
					(0..n_cols).filter_map(move |c| {
						let idx = [r, c];
						let val = &amp;arr[idx];
						(*val == flash_thresh).then_some(idx)
					})
				})
				.collect::&lt;Vec&lt;_&gt;&gt;();

			if flashing_octopi_idxs.is_empty() {
				break;
			}

			n_flashes += flashing_octopi_idxs.len();

			for [base_row, base_col] in flashing_octopi_idxs {
				self.arr[[base_row, base_col]] += 1;

				let rows = [
					base_row.checked_sub(1),
					Some(base_row),
					(base_row + 1 &lt; n_rows).then_some(base_row + 1),
				];
				let cols = [
					base_col.checked_sub(1),
					Some(base_col),
					(base_col + 1 &lt; n_rows).then_some(base_col + 1),
				];

				for row in rows.into_iter().flatten() {
					for col in cols.into_iter().flatten() {
						if self.arr[[row, col]] &lt; flash_thresh {
							self.arr[[row, col]] += 1;
						}
					}
				}
			}
		}

		self.arr
			.mapv_inplace(|val| if val &gt;= flash_thresh { 0 } else { val });

		n_flashes
	}
}

fn ans_for_input(input: &amp;str) -&gt; Answer&lt;usize, usize&gt; {
	let octopi = Octopi::from_str(input).unwrap();
	(11, (pt1(octopi.clone()), pt2(octopi))).into()
}

pub fn ans() -&gt; Answer&lt;usize, usize&gt; {
	ans_for_input(include_str!("input.txt"))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">fn tick(mut octopi: Octopi, n: usize) -&gt; usize {
	let mut n_flashes = 0;
	for _ in 0..n {
		n_flashes += octopi.tick_in_place_and_count_flashes();
	}
	n_flashes
}

fn pt1(octopi: Octopi) -&gt; usize {
	tick(octopi, 100)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">fn pt2(mut octopi: Octopi) -&gt; usize {
	let mut n = 0;
	while octopi.arr.iter().any(|&amp;val| val != 0) {
		octopi.tick_in_place_and_count_flashes();
		n += 1;
	}
	n
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/languages/rust.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/languages/swift.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>