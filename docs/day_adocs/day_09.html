<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Smoke Basin</title>
<link rel="stylesheet" href="./../aoc.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<!-- <script defer src="https://use.fontawesome.com/releases/v5.0.4/js/all.js"></script> -->
<link rel="preconnect" href="https://fonts.googleapis.com" /><link
	rel="preconnect"
	href="https://fonts.gstatic.com"
	crossorigin
/><link
	href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
	rel="stylesheet"
/>

<link
	rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"
	integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw"
	crossorigin="anonymous"
/>

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js"
	integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH"
	crossorigin="anonymous"
></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js"
	integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v"
	crossorigin="anonymous"
	onload="renderMathInElement(document.body);"
></script>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="paragraph">
<p><a href="../advent_of_code_2021.html#_problems_and_solutions"><span class="icon"><i class="fa fa-list-ol"></i></span> Back to Home</a></p>
</div>
<div class="sect1">
<h2 id="_smoke_basin">Smoke Basin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/9" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 9 problem description</a> â”‚ <a href="/src/day_09/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Nothing complicated here.
We must do the following things with a 2D matrix whose entries are between 1 and 9 (inclusive).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Part 1 we have to find the local minima of the matrix.</p>
</li>
<li>
<p>In Part 2 we have to find the matrix&#8217;s maximal connected regions containing no 9s.
This is just a DFS through the matrix with a small amount of bookkeeping.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use crate::Answer;
use ndarray::prelude::*;
use std::collections::BTreeSet as Set;

#[derive(Debug)]
struct Heightmap {
	arr: Array2&lt;usize&gt;,
}

fn get_neighbor_idxs(
	[row, col]: [usize; 2],
	n_rows: usize,
	n_cols: usize,
) -&gt; [[Option&lt;usize&gt;; 2]; 4] {
	[
		[(row + 1 &lt; n_rows).then_some(row + 1), Some(col)],
		[row.checked_sub(1), Some(col)],
		[Some(row), (col + 1 &lt; n_cols).then_some(col + 1)],
		[Some(row), col.checked_sub(1)],
	]
}

impl Heightmap {
	fn from_str(s: &amp;str) -&gt; Option&lt;Self&gt; {
		let width = s.lines().next()?.chars().count();
		let height = s.lines().count();

		let mut data = Vec::new();
		for line in s.lines() {
			data.extend(
				line.trim()
					.chars()
					.map(|c| c.to_digit(10).and_then(|d| usize::try_from(d).ok())),
			);
		}
		let data = data.iter().copied().collect::&lt;Option&lt;Vec&lt;_&gt;&gt;&gt;()?;

		let arr = Array2::from_shape_vec((width, height), data).ok()?;
		Some(Self { arr })
	}
}

fn ans_for_input(input: &amp;str) -&gt; Answer&lt;usize, usize&gt; {
	let hm = Heightmap::from_str(input).unwrap();
	(9, (pt1(&amp;hm), pt2(&amp;hm))).into()
}

pub fn ans() -&gt; Answer&lt;usize, usize&gt; {
	ans_for_input(include_str!("input.txt"))
}</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">impl Heightmap {
	fn is_lower_than_neighbors(&amp;self, idx: [usize; 2]) -&gt; bool {
		let val = self.arr[idx];
		let (n_rows, n_cols) = self.arr.dim();

		let neighbors = get_neighbor_idxs(idx, n_rows, n_cols);
		for idx_pair in neighbors {
			let idxs = match idx_pair {
				[Some(r), Some(c)] =&gt; [r, c],
				_ =&gt; continue,
			};
			if self.arr[idxs] &lt;= val {
				return false;
			}
		}

		true
	}

	fn idxs_where_lower_than_neighbors(&amp;self) -&gt; Vec&lt;[usize; 2]&gt; {
		let (n_rows, n_cols) = self.arr.dim();
		let mut idxs = Vec::new();
		for r in 0..n_rows {
			for c in 0..n_cols {
				if self.is_lower_than_neighbors([r, c]) {
					idxs.push([r, c]);
				}
			}
		}
		idxs
	}
}

fn pt1(hm: &amp;Heightmap) -&gt; usize {
	hm.idxs_where_lower_than_neighbors()
		.into_iter()
		.map(|idx| hm.arr[idx] + 1)
		.sum()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">impl Heightmap {
	fn basin_sizes(&amp;self) -&gt; Vec&lt;usize&gt; {
		let (n_rows, n_cols) = self.arr.dim();
		let mut basin_sizes = Vec::new();

		let mut not_yet_visited_idxs = (0..n_rows)
			.flat_map(|r| {
				(0..n_cols).filter_map(move |c| {
					let idx = [r, c];
					(self.arr[idx] != 9).then_some(idx)
				})
			})
			.collect::&lt;Set&lt;_&gt;&gt;();

		while let Some(first_idx) = not_yet_visited_idxs.pop_first() {
			let mut visited_idxs = Set::new();
			let mut coords_stack = vec![first_idx];
			while let Some(idx) = coords_stack.pop() {
				if !visited_idxs.insert(idx) {
					continue;
				}

				let neighbor_idxs = get_neighbor_idxs(idx, n_rows, n_cols);

				for nghbr_idx in neighbor_idxs {
					let nghbr_idx = match nghbr_idx {
						[Some(r), Some(c)] =&gt; [r, c],
						_ =&gt; continue,
					};
					if self.arr[nghbr_idx] != 9 &amp;&amp; !visited_idxs.contains(&amp;nghbr_idx) {
						coords_stack.push(nghbr_idx);
					}
				}

				for idx in &amp;visited_idxs {
					not_yet_visited_idxs.remove(idx);
				}
			}
			basin_sizes.push(visited_idxs.len());
		}

		basin_sizes
	}
}

fn pt2(hm: &amp;Heightmap) -&gt; usize {
	let mut basin_sizes = hm.basin_sizes();
	basin_sizes.sort_unstable_by_key(|&amp;size| std::cmp::Reverse(size));
	basin_sizes.into_iter().take(3).product()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/languages/rust.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/languages/swift.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>