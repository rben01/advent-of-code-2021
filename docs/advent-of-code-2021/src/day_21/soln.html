<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
<title>Day 21: Dirac Dice :: Robert Bennett — Advent of Code 2021</title>
        <link rel="prev" href="../day_20/soln">
        <link rel="next" href="../day_22/soln">
    <meta name="generator" content="Antora 3.1.2">
<link rel="stylesheet" href="../../../_/css/site.css" />
<link rel="stylesheet" href="../../../_/css/code-syntax-highlight.css" />
<link rel="stylesheet" href="https://use.typekit.net/fnd4xvj.css" />
<link rel="stylesheet" href="https://iosevka-rltb.pages.dev/dist/iosevka-rltb-mono/iosevka-rltb-mono-cloudflare.css">
<meta name="theme-color" content="#0970c4" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0967b4" media="(prefers-color-scheme: dark)">
<script>var uiRootPath = '../../../_';</script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
		integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
	<!-- The loading of KaTeX is deferred to speed up page rendering -->
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
		integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
		crossorigin="anonymous"></script>
	<!-- To automatically render math in text elements, include the auto-render extension: -->
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
		integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
		onload="renderMathInElement(document.body);"></script>
<link rel="icon" type="image/x-icon" href="../../../favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../favicon-16x16.png">
</head>

<body class="article">
  <header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="/advent-of-code-2021">Robert Bennett — Advent of Code 2021</a>
      <button class="navbar-burger" data-target="topbar-nav" type="button"
        title="Expand or collapse toolbar: a search bar and a collection of external links">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable open-left">
          <span class="navbar-link">Links</span>
          <div class="navbar-dropdown">
            <a class="navbar-item navbar-external-link" href="https://github.com/rben01" target="_blank">
              <div class="site-logo github-logo github-repo-logo"></div><span class="site-url">/&nbsp;rben01</span>
            </a>
          </div>
        </div>
          <div class="navbar-item search hide-for-print">
            <div id="search-field" class="field">
              <input id="search-input" type="text" placeholder="Search this site">
            </div>
          </div>
      </div>
    </div>
  </nav>
</header>
<svg xmlns="http://www.w3.org/2000/svg" id="icon-mask-container" width="0" height="0">
	<defs>
		<clipPath id="icon-github" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.0102040816) translate(-49 -48)" clip-rule="evenodd"
				d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z">
			</path>
		</clipPath>
		<clipPath id="icon-menu" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-256 -256)"
				d="M64 144a48 48 0 1 0 0-96 48 48 0 1 0 0 96zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zM64 464a48 48 0 1 0 0-96 48 48 0 1 0 0 96zm48-208a48 48 0 1 0 -96 0 48 48 0 1 0 96 0z">
			</path>
		</clipPath>
		<clipPath id="icon-external-link" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.0017) translate(-256 -256)"
				d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z" />
		</clipPath>
		<clipPath id="icon-star" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001736) translate(-288 -256)"
				d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
		</clipPath>
		<clipPath id="icon-half-star" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001736) translate(-288 -256)"
				d="M288 376.4l.1-.1 26.4 14.1 85.2 45.5-16.5-97.6-4.8-28.7 20.7-20.5 70.1-69.3-96.1-14.2-29.3-4.3-12.9-26.6L288.1 86.9l-.1 .3V376.4zm175.1 98.3c2 12-3 24.2-12.9 31.3s-23 8-33.8 2.3L288.1 439.8 159.8 508.3C149 514 135.9 513.1 126 506s-14.9-19.3-12.9-31.3L137.8 329 33.6 225.9c-8.6-8.5-11.7-21.2-7.9-32.7s13.7-19.9 25.7-21.7L195 150.3 259.4 18c5.4-11 16.5-18 28.8-18s23.4 7 28.8 18l64.3 132.3 143.6 21.2c12 1.8 22 10.2 25.7 21.7s.7 24.2-7.9 32.7L438.5 329l24.6 145.7z" />
		</clipPath>
		<clipPath id="icon-file-lines" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-192 -256)"
				d="M64 464c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16H224v80c0 17.7 14.3 32 32 32h80V448c0 8.8-7.2 16-16 16H64zM64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V154.5c0-17-6.7-33.3-18.7-45.3L274.7 18.7C262.7 6.7 246.5 0 229.5 0H64zm56 256c-13.3 0-24 10.7-24 24s10.7 24 24 24H264c13.3 0 24-10.7 24-24s-10.7-24-24-24H120zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24H264c13.3 0 24-10.7 24-24s-10.7-24-24-24H120z" />
		</clipPath>
		<clipPath id="icon-admon-caution" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-224 -256)" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7
			.1c27.6 25.9 53.5 53.8 77.7 84c11-14.4 23.5-30.1 37-42.9c7.9-7.4 20.1-7.4 28 .1c34.6 33 63.9 76.6 84.5 118c20.3
			40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512C98.4 512 0 404.1 0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3
			97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3 0 47.7-7 68.8-21c42.1-29.4 53.4-88.2
			28.1-134.4c-4.5-9-16-9.6-22.5-2l-25.2 29.3c-6.6 7.6-18.5
			7.4-24.7-.5c-16.5-21-46-58.5-62.8-79.8c-6.3-8-18.3-8.1-24.7-.1c-33.8 42.5-50.8 69.3-50.8 99.4C112 375.4 162.6
			416 225.7 416z" />
		</clipPath>
		<clipPath id="icon-admon-important" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001753125) translate(-256 -256)"
				d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z" />
		</clipPath>
		<clipPath id="icon-admon-note" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001753125) translate(-256 -256)"
				d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z" />
		</clipPath>
		<clipPath id="icon-admon-tip" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-192 -256)"
				d="M256 384c9.6-31.9 29.5-59.1 49.2-86.2l0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C352 78.8 273.2 0 176 0S0 78.8 0 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4l0 0C66.5 324.9 86.4 352.1 96 384H256zM176 512c44.2 0 80-35.8 80-80V416H96v16c0 44.2 35.8 80 80 80zM96 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z" />
		</clipPath>
		<clipPath id="icon-admon-warning" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-256 -256)"
				d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z" />
		</clipPath>
		<clipPath id="icon-close" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-160 -256)"
				d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z" />
		</clipPath>
		<clipPath id="icon-chevron" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-192 -256)"
				d="M169.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L192 205.3 54.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160z" />
		</clipPath>
		<clipPath id="icon-caret" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(0.001953125) translate(-160 -256)"
				d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z" />
		</clipPath>
		<clipPath id="icon-home-outline" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(.01) translate(-50 -50)"
				d="M 49.417969 11.148438 A 2.50025 2.50025 0 0 0 48.353516 11.710938 L 19.773438 37.251953 L 9.7910156 46.171875 A 2.5 2.5 0 0 0 9.59375 49.701172 A 2.5 2.5 0 0 0 13.123047 49.900391 L 18.9375 44.705078 L 18.919922 86.458984 A 2.50025 2.50025 0 0 0 21.419922 88.960938 L 42.925781 88.960938 A 2.50025 2.50025 0 0 0 45.425781 86.462891 L 45.449219 63.794922 L 54.552734 63.794922 L 54.574219 86.462891 A 2.50025 2.50025 0 0 0 57.074219 88.960938 L 78.619141 88.960938 A 2.50025 2.50025 0 0 0 81.119141 86.462891 L 81.138672 44.738281 L 86.916016 49.900391 A 2.5 2.5 0 0 0 90.445312 49.701172 A 2.5 2.5 0 0 0 90.248047 46.171875 L 80.328125 37.308594 L 80.306641 37.287109 L 80.304688 37.287109 L 74.972656 32.521484 L 74.972656 16.6875 A 2.50025 2.50025 0 0 0 72.472656 14.1875 L 63.814453 14.1875 A 2.50025 2.50025 0 0 0 61.314453 16.6875 L 61.314453 20.316406 L 51.685547 11.710938 A 2.50025 2.50025 0 0 0 49.417969 11.148438 z M 50.019531 16.927734 L 62.146484 27.765625 A 2.50025 2.50025 0 0 0 62.148438 27.767578 L 70.806641 35.503906 L 76.138672 40.269531 L 76.121094 83.960938 L 59.572266 83.960938 L 59.550781 61.292969 A 2.50025 2.50025 0 0 0 57.050781 58.794922 L 42.951172 58.794922 A 2.50025 2.50025 0 0 0 40.451172 61.292969 L 40.427734 83.960938 L 23.921875 83.960938 L 23.939453 40.234375 L 50.019531 16.927734 z M 66.314453 19.1875 L 69.972656 19.1875 L 69.972656 28.052734 L 66.314453 24.785156 L 66.314453 24.783203 L 66.314453 19.1875 z " />
		</clipPath>
		<clipPath id="icon-home-filled" clipPathUnits="objectBoundingBox">
			<path transform="translate(.5 .5) scale(.01) translate(-50 -50)"
				d="M 50.019531 11.074219 C 49.423735 11.074219 48.827938 11.286976 48.353516 11.710938 L 47.027344 12.896484 L 19.773438 37.251953 L 9.7910156 46.171875 A 2.5 2.5 0 0 0 9.59375 49.701172 A 2.5 2.5 0 0 0 13.123047 49.900391 L 18.9375 44.705078 L 18.919922 86.458984 C 18.918981 87.8404 20.038505 88.9608 21.419922 88.960938 L 42.925781 88.960938 C 44.305672 88.960801 45.424565 87.842781 45.425781 86.462891 L 45.449219 63.794922 L 54.552734 63.794922 L 54.574219 86.462891 C 54.575419 87.842781 55.694328 88.960801 57.074219 88.960938 L 78.619141 88.960938 C 79.999031 88.960801 81.117925 87.842781 81.119141 86.462891 L 81.138672 44.738281 L 86.916016 49.900391 A 2.5 2.5 0 0 0 90.445312 49.701172 A 2.5 2.5 0 0 0 90.248047 46.171875 L 80.314453 37.296875 L 80.306641 37.287109 L 80.304688 37.287109 L 74.972656 32.521484 L 74.972656 16.6875 C 74.972518 15.306846 73.85331 14.187638 72.472656 14.1875 L 63.814453 14.1875 C 62.4338 14.187638 61.314591 15.306846 61.314453 16.6875 L 61.314453 16.8125 L 61.314453 20.316406 L 55.660156 15.263672 L 51.685547 11.710938 C 51.211125 11.286976 50.615327 11.074219 50.019531 11.074219 z " />
		</clipPath>
	</defs>
	<symbol viewBox="0 0 16 16" id="icon-clipboard">
		<path fill-rule="evenodd"
			d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z" />
	</symbol>
</svg>
  <div class="body">
	<div class="nav-container"  data-component="advent-of-code-2021"
  data-version="" >
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">Navigation</span>
    <span class="nav-explore-expander">
      <svg xmlns="http://www.w3.org/2000/svg" class="svg-icon" viewBox="0 0 1 1">
        <title>Discloure chevron</title>
        <use href="#icon-chevron"></use>
      </svg>
    </span>
  </div>
  <ul class="components">
      <li
        class="component is-current">
          <a class="title" href="../../">Solutions</a>
            <ul class="nav-list">
      <li class="nav-item is-active"
        data-depth="0">
        <span
          class="nav-item-expander clickable">
        </span>
          <ul class="nav-list">
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_01/soln">Day 1: Sonar Sweep</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_02/soln">Day 2: Dive!</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_03/soln">Day 3: Binary Diagnostic</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_04/soln">Day 4: Giant Squid</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_05/soln">Day 5: Hydrothermal Venture</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_06/soln">Day 6: Lanternfish</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_07/soln">Day 7: The Treachery of Whales</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_08/soln">Day 8: Seven Segment Search</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_09/soln">Day 9: Smoke Basin</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_10/soln">Day 10: Syntax Scoring</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_11/soln">Day 11: Dumbo Octopus</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_12/soln">Day 12: Passage Pathing</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_13/soln">Day 13: Transparent Origami</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_14/soln">Day 14: Extended Polymerization</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_15/soln">Day 15: Chiton</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_16/soln">Day 16: Packet Decoder</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_17/soln">Day 17: Trick Shot</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_18/soln">Day 18: Snailfish</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_19/soln">Day 19: Beacon Scanner</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_20/soln">Day 20: Trench Map</a>
        </span>
              </li>
      <li class="nav-item is-active is-current-page"
        data-depth="1">
        <span
          class="nav-item-expander final-depth">
              <span class="nav-text">Day 21: Dirac Dice</span>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_22/soln">Day 22: Reactor Reboot</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_23/soln">Day 23: Amphipod</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_24/soln">Day 24: Arithmetic Logic Unit</a>
        </span>
              </li>
      <li class="nav-item is-active"
        data-depth="1">
        <span
          class="nav-item-expander clickable final-depth">
              <a class="nav-link"
                href="../day_25/soln">Day 25: Sea Cucumber</a>
        </span>
              </li>
  </ul>
      </li>
  </ul>
      </li>
  </ul>
</div>
    </div>
  </aside>
</div>
	<main class="article">
  <div class="toolbar" role="navigation">
  <button class="nav-toggle" title="Show or hide menu" type="button">
	<div class="menu-icon-duo">
		<span class="ui-icon icon-menu-pair icon-menu"></span>
		<span class="ui-icon icon-menu-pair icon-close"></span>
	</div>
</button>
    <a href="../.." class="home-link" title="Home">
      <div class="home-icon-duo" title="Home">
        <span class="ui-icon icon-home icon-home-outline"></span>
        <span class="ui-icon icon-home icon-home-filled"></span>
      </div>
    </a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li>&#47;</li> 
          <li>
              <a href="../../">Solutions</a>

          </li>
        <li>&#47;</li>
        <li><a href="#">Day 21: Dirac Dice</a></li>
    </ul>
</nav>
  </div>
  <div class="content">
      <aside class="toc sidebar" data-title="Contents"
  data-levels="2">
  <div class="toc-menu"></div>
</aside>
      <article class="doc">
	<div class="title-container">
			<h1 class="page">Day 21: Dirac Dice</h1>
	</div>
	<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/21" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span>Day #21 problem description</a> │ <a href="/advent-of-code-2021/_attachments/src/day_21/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span>Problem input</a></p>
</div>
<div class="paragraph">
<p>This problem asks us to simulate a two-layer dice game.
In this game, a move consists of rolling a die three times, adding up the rolled numbers, and then moving around the board based on the sum.
In Part 1 we merely need to simulate this game for a deterministic die; this is so simple it&#8217;s not worth discussing.</p>
</div>
<div class="paragraph">
<p>In Part 2 we need to count how many times each player wins across <em>every possible sequence of die rolls</em>.
(Thankfully, the die in Part 2 only has three sides.)
My first attempt at this actually went through every possible sequence.
With a three-sided die, and games ranging in length from (say) 50 to 100 rolls, this was clearly computationally infeasible.</p>
</div>
<div class="paragraph">
<p>To improve upon this, we note that while there are <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>3</mn><mn>3</mn></msup><mo>=</mo><mn>27</mn></mrow><annotation encoding="application/x-tex">3^3=27</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">27</span></span></span></span> ways to roll a three-sided die three times, there are only seven possible outcomes: the numbers 3 through 9.
By precomputing the number of ways these sums can be rolled each turn, and then weighting each outcome by the number of ways it can be rolled, we cut down the base of the exponent by a factor of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>27</mn><mn>7</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{27}{7}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">27</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>, bringing the problem well into the realm of what is computationally feasible.</p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_setup"><a class="anchor" href="#_setup"></a>Setup</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Players</span> = [Player; <span class="hljs-number">2</span>];

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(s: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Players&gt; {
	s.<span class="hljs-title function_ invoke__">lines</span>()
		.<span class="hljs-title function_ invoke__">map</span>(|line| {
			line.<span class="hljs-title function_ invoke__">split</span>(<span class="hljs-string">&#x27;:&#x27;</span>)
				.<span class="hljs-title function_ invoke__">nth_back</span>(<span class="hljs-number">0</span>)?
				.<span class="hljs-title function_ invoke__">trim</span>()
				.<span class="hljs-title function_ invoke__">parse</span>()
				.<span class="hljs-title function_ invoke__">ok</span>()
				.<span class="hljs-title function_ invoke__">map</span>(Player::new)
		})
		.collect::&lt;<span class="hljs-type">Option</span>&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;&gt;()?
		.<span class="hljs-title function_ invoke__">try_into</span>()
		.<span class="hljs-title function_ invoke__">ok</span>()
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Board</span> {
	size: <span class="hljs-type">usize</span>,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Player</span> {
	score: <span class="hljs-type">usize</span>,
	position: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Player</span> {
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(pos: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
		<span class="hljs-keyword">Self</span> {
			score: <span class="hljs-number">0</span>,
			position: pos,
		}
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll_value</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, board: &amp;Board, value: <span class="hljs-type">usize</span>) {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">new_pos</span> = ((<span class="hljs-keyword">self</span>.position + value - <span class="hljs-number">1</span>) % board.size) + <span class="hljs-number">1</span>;
		<span class="hljs-keyword">self</span>.position = new_pos;
		<span class="hljs-keyword">self</span>.score += new_pos;
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll_deterministic_die</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, board: &amp;Board, die: &amp;<span class="hljs-keyword">mut</span> DeterministicDie) {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">move_dist</span> = (<span class="hljs-number">0</span>..<span class="hljs-number">3</span>).<span class="hljs-title function_ invoke__">map</span>(|_| die.<span class="hljs-title function_ invoke__">roll</span>()).sum::&lt;<span class="hljs-type">usize</span>&gt;();
		<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">roll_value</span>(board, move_dist);
	}
}

<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DeterministicDie</span> {
	next: <span class="hljs-type">usize</span>,
	min: <span class="hljs-type">usize</span>,
	max: <span class="hljs-type">usize</span>,
	n_rolls: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">DeterministicDie</span> {
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(min: <span class="hljs-type">usize</span>, max: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
		<span class="hljs-keyword">Self</span> {
			next: <span class="hljs-number">1</span>,
			min,
			max,
			n_rolls: <span class="hljs-number">0</span>,
		}
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
		<span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.next &gt; <span class="hljs-keyword">self</span>.max {
			<span class="hljs-keyword">self</span>.next = <span class="hljs-keyword">self</span>.min;
		}
		<span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">self</span>.next;
		<span class="hljs-keyword">self</span>.next += <span class="hljs-number">1</span>;
		<span class="hljs-keyword">self</span>.n_rolls += <span class="hljs-number">1</span>;
		ret
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">board</span> = Board { size: <span class="hljs-number">10</span> };
	<span class="hljs-keyword">let</span> <span class="hljs-variable">players</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();

	(
		<span class="hljs-number">21</span>,
		(
			<span class="hljs-title function_ invoke__">pt1</span>(players, &amp;board, DeterministicDie::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)),
			<span class="hljs-title function_ invoke__">pt2</span>(players),
		),
	)
		.<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>(<span class="hljs-keyword">mut</span> players: Players, board: &amp;Board, die: DeterministicDie) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">die</span> = die;
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">loser</span> = players[<span class="hljs-number">1</span>];

	<span class="hljs-symbol">&#x27;game</span>: <span class="hljs-keyword">loop</span> {
		<span class="hljs-keyword">for</span> <span class="hljs-variable">player</span> <span class="hljs-keyword">in</span> &amp;<span class="hljs-keyword">mut</span> players {
			player.<span class="hljs-title function_ invoke__">roll_deterministic_die</span>(board, &amp;<span class="hljs-keyword">mut</span> die);

			<span class="hljs-keyword">if</span> player.score &gt;= <span class="hljs-number">1000</span> {
				<span class="hljs-keyword">break</span> <span class="hljs-symbol">&#x27;game</span>;
			}
			loser = *player;
		}
	}

	die.n_rolls * loser.score
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Turn</span> {
	players: Players,
	is_p0s_turn: <span class="hljs-type">bool</span>,
	n_ways: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">play_quantum_dice</span>(
	players: Players,
	board: &amp;Board,
	die_n_faces: <span class="hljs-type">usize</span>,
	n_rolls_per_turn: <span class="hljs-type">usize</span>,
	win_threshold: <span class="hljs-type">usize</span>,
) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">usize</span>; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">tally</span> = [<span class="hljs-number">0</span>; <span class="hljs-number">2</span>];
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">turn_stack</span> = <span class="hljs-built_in">vec!</span>[Turn {
		players,
		is_p0s_turn: <span class="hljs-literal">true</span>,
		n_ways: <span class="hljs-number">1</span>,
	}];

	<span class="hljs-comment">// Pairs of `(dice sum, # ways)`</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">outcome_counts</span>: [(<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>); <span class="hljs-number">7</span>] = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">max_sum</span> = die_n_faces * n_rolls_per_turn;
		<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">counts</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>; max_sum + <span class="hljs-number">1</span>];

		<span class="hljs-keyword">for</span> <span class="hljs-variable">r1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">r2</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
				<span class="hljs-keyword">for</span> <span class="hljs-variable">r3</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
					counts[r1 + r2 + r3] += <span class="hljs-number">1</span>;
				}
			}
		}

		counts
			.<span class="hljs-title function_ invoke__">iter</span>()
			.<span class="hljs-title function_ invoke__">enumerate</span>()
			.<span class="hljs-title function_ invoke__">filter_map</span>(|(i, &amp;c)| <span class="hljs-keyword">if</span> c &gt; <span class="hljs-number">0</span> { <span class="hljs-title function_ invoke__">Some</span>((i, c)) } <span class="hljs-keyword">else</span> { <span class="hljs-literal">None</span> })
			.collect::&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;()
			.<span class="hljs-title function_ invoke__">try_into</span>()
			.<span class="hljs-title function_ invoke__">unwrap</span>()
	};

	<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">Some</span>(Turn {
		players,
		is_p0s_turn,
		n_ways: n_ways_to_have_gotten_here,
	}) = turn_stack.<span class="hljs-title function_ invoke__">pop</span>()
	{
		<span class="hljs-keyword">let</span> <span class="hljs-variable">player_index</span> = <span class="hljs-keyword">if</span> is_p0s_turn { <span class="hljs-number">0</span> } <span class="hljs-keyword">else</span> { <span class="hljs-number">1</span> };

		<span class="hljs-title function_ invoke__">for</span> (roll_value, n_ways_to_roll_this) <span class="hljs-keyword">in</span> outcome_counts {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">n_ways_to_get_here</span> = n_ways_to_have_gotten_here * n_ways_to_roll_this;

			<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">player</span> = players[player_index];
			player.<span class="hljs-title function_ invoke__">roll_value</span>(board, roll_value);

			<span class="hljs-keyword">if</span> player.score &gt;= win_threshold {
				tally[player_index] += n_ways_to_get_here;
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">players</span> = players;
				players[player_index] = player;
				turn_stack.<span class="hljs-title function_ invoke__">push</span>(Turn {
					players,
					is_p0s_turn: !is_p0s_turn,
					n_ways: n_ways_to_get_here,
				});
			}
		}
	}

	tally
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>(players: Players) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	<span class="hljs-keyword">let</span> [p1_n_wins, p2_n_wins] = <span class="hljs-title function_ invoke__">play_quantum_dice</span>(players, &amp;Board { size: <span class="hljs-number">10</span> }, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">21</span>);
	p1_n_wins.<span class="hljs-title function_ invoke__">max</span>(p2_n_wins)
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test</span>() {
		test_input!(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>), day: <span class="hljs-number">21</span>, ans: (<span class="hljs-number">757_770</span>, <span class="hljs-number">712_381_680_443_927</span>));
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_part_1"><a class="anchor" href="#_part_1"></a>Part 1</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Players</span> = [Player; <span class="hljs-number">2</span>];

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(s: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Players&gt; {
	s.<span class="hljs-title function_ invoke__">lines</span>()
		.<span class="hljs-title function_ invoke__">map</span>(|line| {
			line.<span class="hljs-title function_ invoke__">split</span>(<span class="hljs-string">&#x27;:&#x27;</span>)
				.<span class="hljs-title function_ invoke__">nth_back</span>(<span class="hljs-number">0</span>)?
				.<span class="hljs-title function_ invoke__">trim</span>()
				.<span class="hljs-title function_ invoke__">parse</span>()
				.<span class="hljs-title function_ invoke__">ok</span>()
				.<span class="hljs-title function_ invoke__">map</span>(Player::new)
		})
		.collect::&lt;<span class="hljs-type">Option</span>&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;&gt;()?
		.<span class="hljs-title function_ invoke__">try_into</span>()
		.<span class="hljs-title function_ invoke__">ok</span>()
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Board</span> {
	size: <span class="hljs-type">usize</span>,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Player</span> {
	score: <span class="hljs-type">usize</span>,
	position: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Player</span> {
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(pos: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
		<span class="hljs-keyword">Self</span> {
			score: <span class="hljs-number">0</span>,
			position: pos,
		}
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll_value</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, board: &amp;Board, value: <span class="hljs-type">usize</span>) {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">new_pos</span> = ((<span class="hljs-keyword">self</span>.position + value - <span class="hljs-number">1</span>) % board.size) + <span class="hljs-number">1</span>;
		<span class="hljs-keyword">self</span>.position = new_pos;
		<span class="hljs-keyword">self</span>.score += new_pos;
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll_deterministic_die</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, board: &amp;Board, die: &amp;<span class="hljs-keyword">mut</span> DeterministicDie) {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">move_dist</span> = (<span class="hljs-number">0</span>..<span class="hljs-number">3</span>).<span class="hljs-title function_ invoke__">map</span>(|_| die.<span class="hljs-title function_ invoke__">roll</span>()).sum::&lt;<span class="hljs-type">usize</span>&gt;();
		<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">roll_value</span>(board, move_dist);
	}
}

<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DeterministicDie</span> {
	next: <span class="hljs-type">usize</span>,
	min: <span class="hljs-type">usize</span>,
	max: <span class="hljs-type">usize</span>,
	n_rolls: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">DeterministicDie</span> {
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(min: <span class="hljs-type">usize</span>, max: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
		<span class="hljs-keyword">Self</span> {
			next: <span class="hljs-number">1</span>,
			min,
			max,
			n_rolls: <span class="hljs-number">0</span>,
		}
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
		<span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.next &gt; <span class="hljs-keyword">self</span>.max {
			<span class="hljs-keyword">self</span>.next = <span class="hljs-keyword">self</span>.min;
		}
		<span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">self</span>.next;
		<span class="hljs-keyword">self</span>.next += <span class="hljs-number">1</span>;
		<span class="hljs-keyword">self</span>.n_rolls += <span class="hljs-number">1</span>;
		ret
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">board</span> = Board { size: <span class="hljs-number">10</span> };
	<span class="hljs-keyword">let</span> <span class="hljs-variable">players</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();

	(
		<span class="hljs-number">21</span>,
		(
			<span class="hljs-title function_ invoke__">pt1</span>(players, &amp;board, DeterministicDie::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)),
			<span class="hljs-title function_ invoke__">pt2</span>(players),
		),
	)
		.<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>(<span class="hljs-keyword">mut</span> players: Players, board: &amp;Board, die: DeterministicDie) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">die</span> = die;
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">loser</span> = players[<span class="hljs-number">1</span>];

	<span class="hljs-symbol">&#x27;game</span>: <span class="hljs-keyword">loop</span> {
		<span class="hljs-keyword">for</span> <span class="hljs-variable">player</span> <span class="hljs-keyword">in</span> &amp;<span class="hljs-keyword">mut</span> players {
			player.<span class="hljs-title function_ invoke__">roll_deterministic_die</span>(board, &amp;<span class="hljs-keyword">mut</span> die);

			<span class="hljs-keyword">if</span> player.score &gt;= <span class="hljs-number">1000</span> {
				<span class="hljs-keyword">break</span> <span class="hljs-symbol">&#x27;game</span>;
			}
			loser = *player;
		}
	}

	die.n_rolls * loser.score
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Turn</span> {
	players: Players,
	is_p0s_turn: <span class="hljs-type">bool</span>,
	n_ways: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">play_quantum_dice</span>(
	players: Players,
	board: &amp;Board,
	die_n_faces: <span class="hljs-type">usize</span>,
	n_rolls_per_turn: <span class="hljs-type">usize</span>,
	win_threshold: <span class="hljs-type">usize</span>,
) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">usize</span>; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">tally</span> = [<span class="hljs-number">0</span>; <span class="hljs-number">2</span>];
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">turn_stack</span> = <span class="hljs-built_in">vec!</span>[Turn {
		players,
		is_p0s_turn: <span class="hljs-literal">true</span>,
		n_ways: <span class="hljs-number">1</span>,
	}];

	<span class="hljs-comment">// Pairs of `(dice sum, # ways)`</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">outcome_counts</span>: [(<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>); <span class="hljs-number">7</span>] = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">max_sum</span> = die_n_faces * n_rolls_per_turn;
		<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">counts</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>; max_sum + <span class="hljs-number">1</span>];

		<span class="hljs-keyword">for</span> <span class="hljs-variable">r1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">r2</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
				<span class="hljs-keyword">for</span> <span class="hljs-variable">r3</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
					counts[r1 + r2 + r3] += <span class="hljs-number">1</span>;
				}
			}
		}

		counts
			.<span class="hljs-title function_ invoke__">iter</span>()
			.<span class="hljs-title function_ invoke__">enumerate</span>()
			.<span class="hljs-title function_ invoke__">filter_map</span>(|(i, &amp;c)| <span class="hljs-keyword">if</span> c &gt; <span class="hljs-number">0</span> { <span class="hljs-title function_ invoke__">Some</span>((i, c)) } <span class="hljs-keyword">else</span> { <span class="hljs-literal">None</span> })
			.collect::&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;()
			.<span class="hljs-title function_ invoke__">try_into</span>()
			.<span class="hljs-title function_ invoke__">unwrap</span>()
	};

	<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">Some</span>(Turn {
		players,
		is_p0s_turn,
		n_ways: n_ways_to_have_gotten_here,
	}) = turn_stack.<span class="hljs-title function_ invoke__">pop</span>()
	{
		<span class="hljs-keyword">let</span> <span class="hljs-variable">player_index</span> = <span class="hljs-keyword">if</span> is_p0s_turn { <span class="hljs-number">0</span> } <span class="hljs-keyword">else</span> { <span class="hljs-number">1</span> };

		<span class="hljs-title function_ invoke__">for</span> (roll_value, n_ways_to_roll_this) <span class="hljs-keyword">in</span> outcome_counts {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">n_ways_to_get_here</span> = n_ways_to_have_gotten_here * n_ways_to_roll_this;

			<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">player</span> = players[player_index];
			player.<span class="hljs-title function_ invoke__">roll_value</span>(board, roll_value);

			<span class="hljs-keyword">if</span> player.score &gt;= win_threshold {
				tally[player_index] += n_ways_to_get_here;
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">players</span> = players;
				players[player_index] = player;
				turn_stack.<span class="hljs-title function_ invoke__">push</span>(Turn {
					players,
					is_p0s_turn: !is_p0s_turn,
					n_ways: n_ways_to_get_here,
				});
			}
		}
	}

	tally
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>(players: Players) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	<span class="hljs-keyword">let</span> [p1_n_wins, p2_n_wins] = <span class="hljs-title function_ invoke__">play_quantum_dice</span>(players, &amp;Board { size: <span class="hljs-number">10</span> }, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">21</span>);
	p1_n_wins.<span class="hljs-title function_ invoke__">max</span>(p2_n_wins)
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test</span>() {
		test_input!(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>), day: <span class="hljs-number">21</span>, ans: (<span class="hljs-number">757_770</span>, <span class="hljs-number">712_381_680_443_927</span>));
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_part_2"><a class="anchor" href="#_part_2"></a>Part 2</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-rust" data-lang="rust"><span class="hljs-comment">// tag::setup[]</span>
<span class="hljs-keyword">use</span> crate::Answer;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Players</span> = [Player; <span class="hljs-number">2</span>];

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_input</span>(s: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;Players&gt; {
	s.<span class="hljs-title function_ invoke__">lines</span>()
		.<span class="hljs-title function_ invoke__">map</span>(|line| {
			line.<span class="hljs-title function_ invoke__">split</span>(<span class="hljs-string">&#x27;:&#x27;</span>)
				.<span class="hljs-title function_ invoke__">nth_back</span>(<span class="hljs-number">0</span>)?
				.<span class="hljs-title function_ invoke__">trim</span>()
				.<span class="hljs-title function_ invoke__">parse</span>()
				.<span class="hljs-title function_ invoke__">ok</span>()
				.<span class="hljs-title function_ invoke__">map</span>(Player::new)
		})
		.collect::&lt;<span class="hljs-type">Option</span>&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;&gt;()?
		.<span class="hljs-title function_ invoke__">try_into</span>()
		.<span class="hljs-title function_ invoke__">ok</span>()
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Board</span> {
	size: <span class="hljs-type">usize</span>,
}

<span class="hljs-meta">#[derive(Debug, Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Player</span> {
	score: <span class="hljs-type">usize</span>,
	position: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Player</span> {
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(pos: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
		<span class="hljs-keyword">Self</span> {
			score: <span class="hljs-number">0</span>,
			position: pos,
		}
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll_value</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, board: &amp;Board, value: <span class="hljs-type">usize</span>) {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">new_pos</span> = ((<span class="hljs-keyword">self</span>.position + value - <span class="hljs-number">1</span>) % board.size) + <span class="hljs-number">1</span>;
		<span class="hljs-keyword">self</span>.position = new_pos;
		<span class="hljs-keyword">self</span>.score += new_pos;
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll_deterministic_die</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, board: &amp;Board, die: &amp;<span class="hljs-keyword">mut</span> DeterministicDie) {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">move_dist</span> = (<span class="hljs-number">0</span>..<span class="hljs-number">3</span>).<span class="hljs-title function_ invoke__">map</span>(|_| die.<span class="hljs-title function_ invoke__">roll</span>()).sum::&lt;<span class="hljs-type">usize</span>&gt;();
		<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">roll_value</span>(board, move_dist);
	}
}

<span class="hljs-meta">#[derive(Clone, Copy)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DeterministicDie</span> {
	next: <span class="hljs-type">usize</span>,
	min: <span class="hljs-type">usize</span>,
	max: <span class="hljs-type">usize</span>,
	n_rolls: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">DeterministicDie</span> {
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(min: <span class="hljs-type">usize</span>, max: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
		<span class="hljs-keyword">Self</span> {
			next: <span class="hljs-number">1</span>,
			min,
			max,
			n_rolls: <span class="hljs-number">0</span>,
		}
	}

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">roll</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
		<span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.next &gt; <span class="hljs-keyword">self</span>.max {
			<span class="hljs-keyword">self</span>.next = <span class="hljs-keyword">self</span>.min;
		}
		<span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-keyword">self</span>.next;
		<span class="hljs-keyword">self</span>.next += <span class="hljs-number">1</span>;
		<span class="hljs-keyword">self</span>.n_rolls += <span class="hljs-number">1</span>;
		ret
	}
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans_for_input</span>(input: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-keyword">let</span> <span class="hljs-variable">board</span> = Board { size: <span class="hljs-number">10</span> };
	<span class="hljs-keyword">let</span> <span class="hljs-variable">players</span> = <span class="hljs-title function_ invoke__">read_input</span>(input).<span class="hljs-title function_ invoke__">unwrap</span>();

	(
		<span class="hljs-number">21</span>,
		(
			<span class="hljs-title function_ invoke__">pt1</span>(players, &amp;board, DeterministicDie::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)),
			<span class="hljs-title function_ invoke__">pt2</span>(players),
		),
	)
		.<span class="hljs-title function_ invoke__">into</span>()
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">ans</span>() <span class="hljs-punctuation">-&gt;</span> Answer&lt;<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>&gt; {
	<span class="hljs-title function_ invoke__">ans_for_input</span>(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>))
}
<span class="hljs-comment">// end::setup[]</span>

<span class="hljs-comment">// tag::pt1[]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt1</span>(<span class="hljs-keyword">mut</span> players: Players, board: &amp;Board, die: DeterministicDie) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">die</span> = die;
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">loser</span> = players[<span class="hljs-number">1</span>];

	<span class="hljs-symbol">&#x27;game</span>: <span class="hljs-keyword">loop</span> {
		<span class="hljs-keyword">for</span> <span class="hljs-variable">player</span> <span class="hljs-keyword">in</span> &amp;<span class="hljs-keyword">mut</span> players {
			player.<span class="hljs-title function_ invoke__">roll_deterministic_die</span>(board, &amp;<span class="hljs-keyword">mut</span> die);

			<span class="hljs-keyword">if</span> player.score &gt;= <span class="hljs-number">1000</span> {
				<span class="hljs-keyword">break</span> <span class="hljs-symbol">&#x27;game</span>;
			}
			loser = *player;
		}
	}

	die.n_rolls * loser.score
}
<span class="hljs-comment">// end::pt1[]</span>

<span class="hljs-comment">// tag::pt2[]</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Turn</span> {
	players: Players,
	is_p0s_turn: <span class="hljs-type">bool</span>,
	n_ways: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">play_quantum_dice</span>(
	players: Players,
	board: &amp;Board,
	die_n_faces: <span class="hljs-type">usize</span>,
	n_rolls_per_turn: <span class="hljs-type">usize</span>,
	win_threshold: <span class="hljs-type">usize</span>,
) <span class="hljs-punctuation">-&gt;</span> [<span class="hljs-type">usize</span>; <span class="hljs-number">2</span>] {
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">tally</span> = [<span class="hljs-number">0</span>; <span class="hljs-number">2</span>];
	<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">turn_stack</span> = <span class="hljs-built_in">vec!</span>[Turn {
		players,
		is_p0s_turn: <span class="hljs-literal">true</span>,
		n_ways: <span class="hljs-number">1</span>,
	}];

	<span class="hljs-comment">// Pairs of `(dice sum, # ways)`</span>
	<span class="hljs-keyword">let</span> <span class="hljs-variable">outcome_counts</span>: [(<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>); <span class="hljs-number">7</span>] = {
		<span class="hljs-keyword">let</span> <span class="hljs-variable">max_sum</span> = die_n_faces * n_rolls_per_turn;
		<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">counts</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>; max_sum + <span class="hljs-number">1</span>];

		<span class="hljs-keyword">for</span> <span class="hljs-variable">r1</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
			<span class="hljs-keyword">for</span> <span class="hljs-variable">r2</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
				<span class="hljs-keyword">for</span> <span class="hljs-variable">r3</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..=die_n_faces {
					counts[r1 + r2 + r3] += <span class="hljs-number">1</span>;
				}
			}
		}

		counts
			.<span class="hljs-title function_ invoke__">iter</span>()
			.<span class="hljs-title function_ invoke__">enumerate</span>()
			.<span class="hljs-title function_ invoke__">filter_map</span>(|(i, &amp;c)| <span class="hljs-keyword">if</span> c &gt; <span class="hljs-number">0</span> { <span class="hljs-title function_ invoke__">Some</span>((i, c)) } <span class="hljs-keyword">else</span> { <span class="hljs-literal">None</span> })
			.collect::&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;()
			.<span class="hljs-title function_ invoke__">try_into</span>()
			.<span class="hljs-title function_ invoke__">unwrap</span>()
	};

	<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-variable">Some</span>(Turn {
		players,
		is_p0s_turn,
		n_ways: n_ways_to_have_gotten_here,
	}) = turn_stack.<span class="hljs-title function_ invoke__">pop</span>()
	{
		<span class="hljs-keyword">let</span> <span class="hljs-variable">player_index</span> = <span class="hljs-keyword">if</span> is_p0s_turn { <span class="hljs-number">0</span> } <span class="hljs-keyword">else</span> { <span class="hljs-number">1</span> };

		<span class="hljs-title function_ invoke__">for</span> (roll_value, n_ways_to_roll_this) <span class="hljs-keyword">in</span> outcome_counts {
			<span class="hljs-keyword">let</span> <span class="hljs-variable">n_ways_to_get_here</span> = n_ways_to_have_gotten_here * n_ways_to_roll_this;

			<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">player</span> = players[player_index];
			player.<span class="hljs-title function_ invoke__">roll_value</span>(board, roll_value);

			<span class="hljs-keyword">if</span> player.score &gt;= win_threshold {
				tally[player_index] += n_ways_to_get_here;
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">players</span> = players;
				players[player_index] = player;
				turn_stack.<span class="hljs-title function_ invoke__">push</span>(Turn {
					players,
					is_p0s_turn: !is_p0s_turn,
					n_ways: n_ways_to_get_here,
				});
			}
		}
	}

	tally
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">pt2</span>(players: Players) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
	<span class="hljs-keyword">let</span> [p1_n_wins, p2_n_wins] = <span class="hljs-title function_ invoke__">play_quantum_dice</span>(players, &amp;Board { size: <span class="hljs-number">10</span> }, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">21</span>);
	p1_n_wins.<span class="hljs-title function_ invoke__">max</span>(p2_n_wins)
}
<span class="hljs-comment">// end::pt2[]</span>

<span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> test {
	<span class="hljs-keyword">use</span> super::*;
	<span class="hljs-keyword">use</span> crate::test_input;

	<span class="hljs-meta">#[test]</span>
	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">test</span>() {
		test_input!(<span class="hljs-built_in">include_str!</span>(<span class="hljs-string">&quot;input.txt&quot;</span>), day: <span class="hljs-number">21</span>, ans: (<span class="hljs-number">757_770</span>, <span class="hljs-number">712_381_680_443_927</span>));
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>     <nav class="pagination">
        <span class="prev"><a href="../day_20/soln">Day 20: Trench Map</a></span>
        <span class="next"><a href="../day_22/soln">Day 22: Reactor Reboot</a></span>
    </nav>

</article>
  </div>
  <footer class="footer">
  <p>This page was built using <a href="https://antora.org" target="_blank">Antora</a> with a theme forked from the <a
      href="https://gitlab.com/antora/antora-ui-default" target="_blank">default UI</a>. Search is powered by <a
      href="https://lunrjs.com" target="_blank">Lunr</a>.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script>
	function add_is_current_path() {
		let elem = document.querySelector(`.nav-container .is-current-page > .final-depth`);
		if (!elem) { return; }
		while (!elem.classList.contains("nav-panel-explore")) {
			if (elem.tagName === "LI") {
				elem.classList.add("is-current-path");
			}
			elem = elem.parentNode;
		}
	}
	add_is_current_path()
</script>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
	<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script>
	function set_up_footnotes() {
		let footnoteBox;
		let footnoteP;
		const _isMobile = "ontouchstart" in document.documentElement;

		// Apparently, sticking the tooltip in a child div of document.body, instead of in
		// document.body directly, helps performance.
		// https://atfzl.com/don-t-attach-tooltips-to-document-body
		const footnoteHolder = document.createElement("div");
		(document.querySelector('body .doc') ?? document.body).appendChild(footnoteHolder);

		function showFootnoteBoxOnHover(elem) {
			const FOOTNOTE_BOX_MAX_WIDTH = 400;

			if (footnoteBox === undefined) {
				footnoteBox = document.createElement("div");
				footnoteHolder.appendChild(footnoteBox);
				footnoteBox.classList.add("footnote-box");
				footnoteBox.addEventListener("mouseleave", () => removeFootnoteBox());

				footnoteP = document.createElement("p");
				footnoteBox.appendChild(footnoteP);

				footnoteBox.style.zIndex = 9999;
			}

			// Remove the numbering from this footnote box
			const footnoteId = elem.getAttribute("href"); // Starts with #
			const footnoteClone = document
				.getElementById(footnoteId.substring(1))
				.cloneNode(true);
			const footnoteA = footnoteClone.getElementsByTagName("a")[0];
			footnoteA.remove();

			const footnoteHtml = footnoteClone.innerHTML.replace(/^\s*\.\s*/, "");

			footnoteP.innerHTML = footnoteHtml;
			footnoteBox.style.right = null;
			footnoteBox.style.left = "0px";
			footnoteBox.style.top = "0px";

			const elemRect = elem.getBoundingClientRect();
			const bodyRect = document.body.getBoundingClientRect();

			footnoteBox.style.display = "block";

			let tx = false;
			let ty = false;

			if (elemRect.left - FOOTNOTE_BOX_MAX_WIDTH < 10) {
				const px = -bodyRect.left + 10;
				footnoteBox.style.left = `${px}px`;

				tx = true;
			} else {
				const px = elemRect.left - bodyRect.left + 20;
				footnoteBox.style.left = `${px}px`;
			}

			const footnoteRect = footnoteBox.getBoundingClientRect();

			const windowHeight = document.documentElement.clientHeight;
			if (elemRect.top + footnoteRect.height > windowHeight) {
				const py = -10 + window.scrollY + windowHeight;
				footnoteBox.style.top = `${py}px`;
			} else {
				const py = elemRect.top - bodyRect.top;
				footnoteBox.style.top = `${py}px`;

				ty = true;
			}

			footnoteBox.style.transform = (() => {
				let transX = tx ? 0 : "-100%";
				let transY = ty ? 0 : "-100%";
				return `translate(${transX}, ${transY})`;
			})();

			// if (elemRect.right + FOOTNOTE_BOX_MAX_WIDTH - 30 > bodyRect.right) {
			// 	const px = bodyRect.right - (bodyRect.left + bodyRect.width);
			// 	console.log(bodyRect);
			// 	footnoteBox.style.left = null;
			// 	footnoteBox.style.right = `${px}px`;
			// 	console.log("right");
			// } else {
			// 	const px = -10 + elemRect.left - bodyRect.left;
			// 	footnoteBox.style.right = null;
			// 	footnoteBox.style.left = `${px}px`;
			// 	console.log("left");
			// }
		}

		function removeFootnoteBox() {
			if (footnoteBox === undefined) {
				return;
			}
			footnoteBox.style.display = "none";
		}

		function initializeFootnotes() {
			const footnotes = document.querySelectorAll(
				":not(#footnotes) .footnote a.footnote",
			);
			const nFootnotes = footnotes.length;
			for (let i = 0; i < nFootnotes; i++) {
				const footnote = footnotes[i];
				footnote.addEventListener("mouseenter", event => {
					showFootnoteBoxOnHover(footnote);
				});
			}
		}

		if (!_isMobile) {
			initializeFootnotes();
		}
	}
	set_up_footnotes()
</script>
<script>
	function add_titles() {
		const elems = document.querySelectorAll(".ui-icon.nav-menu-icon");
		for (let i = 0, len = elems.length; i < len; i++) {
			const elem = elems[i];
			if (elem.getAttribute('title') === null) {
				elems[i].setAttribute("title", "Navigation menu icon: one bullet followed by three sub-bullets");
			}
		}
	}
	add_titles()
</script>
</main>
</div>
</body>

</html>
