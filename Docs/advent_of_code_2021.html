<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Advent of Code 2021</title>
<link rel="stylesheet" href="/Docs/aoc.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/Docs/syntax-theme.css">
<!-- <script defer src="https://use.fontawesome.com/releases/v5.0.4/js/all.js"></script> -->

<link
	rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"
	integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw"
	crossorigin="anonymous"
/>

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js"
	integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH"
	crossorigin="anonymous"
></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js"
	integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v"
	crossorigin="anonymous"
	onload="renderMathInElement(document.body);"
></script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Advent of Code 2021</h1>
<div id="toc" class="toc2">
<div id="toctitle">Challenges</div>
<ul class="sectlevel1">
<li><a href="#_sonar_sweep">1. Sonar Sweep</a></li>
<li><a href="#_dive">2. Dive!</a></li>
<li><a href="#_binary_diagnostic">3. Binary Diagnostic</a></li>
<li><a href="#_giant_squid">4. Giant Squid</a></li>
<li><a href="#_hydrothermal_venture">5. Hydrothermal Venture</a></li>
<li><a href="#_lanternfish">6. Lanternfish</a></li>
<li><a href="#_the_treachery_of_whales">7. The Treachery of Whales</a></li>
<li><a href="#_seven_segment_search">8. Seven Segment Search</a></li>
<li><a href="#_smoke_basin">9. Smoke Basin</a></li>
<li><a href="#_syntax_scoring">10. Syntax Scoring</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p>This doc has my solutions for the <a href="https://adventofcode.com/2021" target="_blank" rel="noopener">2021 Advent of Code</a>.
It assumes some familiarity with <a href="https://www.rust-lang.org/" target="_blank" rel="noopener">the Rust language</a>.</p>
</div>
<div class="paragraph">
<p>Rust is a very strict language and makes you explicitly handle all errors that might arise (as opposed to, say,  exceptions implicitly being thrown on error, as Python does).
However, we can trust our inputs, taken straight from Advent of Code, to be correct and give unambiguous answers without errors.
For this reason, we tend to be pretty loosey-goosey about unwrapping the <code>Option</code>s and <code>Result</code>s that the Rust compiler correctly points out we could theoretically encounter.
(There wouldn&#8217;t be any point to handling those cases gracefully; we&#8217;re just trying to solve Advent of Code, not create general-purpose submarine-squid-bingo-players.
Their residual variants might as well be marked <code>unreachable!()</code>.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Advent of Code gives all participants the same problems, but gives different inputs to each participant.
Therefore, it makes little sense to give the actual numeric answers to problems here.
However, these solutions should work for any input/output pair provided by Advent of Code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This document has the solutions out in the open!
Don&#8217;t read it if you&#8217;re still working on Advent of Code.</p>
</div>
</td>
</tr>
</table>
</div>
<h2 id="_setup" class="discrete">Setup</h2>
<div class="paragraph">
<p>Commonly used code, in <code>src/lib.rs</code>, is below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-p">{</span><span class="tok-n">Debug</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Display</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span> <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">pt1</span>: <span class="tok-nc">T1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">pt2</span>: <span class="tok-nc">T2</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">new</span><span class="tok-p">(</span><span class="tok-n">pt1</span>: <span class="tok-nc">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span>: <span class="tok-nc">T2</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span>: <span class="tok-nc">Debug</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span>: <span class="tok-nc">Debug</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Display</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">fmt</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">f</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-n">Formatter</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">std</span>::<span class="tok-n">fmt</span>::<span class="tok-nb">Result</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-fm">write!</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;Part 1: {:?}; Part 2: {:?}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">pt2</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nb">From</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">(</span><span class="tok-n">other</span>: <span class="tok-p">(</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-p">))</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">to_decimal</span><span class="tok-o">&lt;</span><span class="tok-n">V</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-kt">bool</span><span class="tok-p">]</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">binary_digits_msbf</span>: <span class="tok-nc">V</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">binary_digits_msbf</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">binary_digits_msbf</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_digits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">binary_digits_msbf</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">pow2s</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">range_step_inclusive</span><span class="tok-p">((</span><span class="tok-n">n_digits</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">pow2s</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">zip</span><span class="tok-p">(</span><span class="tok-n">binary_digits_msbf</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">pow2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">is_on</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">is_on</span>: <span class="tok-kt">usize</span> <span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">is_on</span><span class="tok-p">).</span><span class="tok-n">into</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">is_on</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-k">usize</span><span class="tok-p">.</span><span class="tok-n">pow</span><span class="tok-p">(</span><span class="tok-n">pow2</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">reduce</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">unwrap_or</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sonar_sweep">1. Sonar Sweep</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/1" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 1 problem description</a></p>
</div>
<div class="paragraph">
<p>Part 1 asks to find when the current depth is greater than the previous depth.
Part 2 asks to find when the current running sum of depths is greater than the previous running sum, with a running sum of length 3.
These are both special cases of finding when the current length-\(n\) running sum of depths is greater than the previous length-\(n\) running sum, with Part 1 using a length of \(n=1\) and Part 2 using \(n=3\).</p>
</div>
<div class="paragraph">
<p>The solution uses a <a href="https://en.wikipedia.org/wiki/Circular_buffer/" target="_blank" rel="noopener">CircularBuffer</a> to keep the past \(n\) depths.
Since the “interior” components of the current and previous running sums are the same, we can compare the two running sums by merely checking the incoming number against the outgoing number, i.e., the new depth against the oldest depth still in the buffer.
If the current depth is greater, then so is the current running sum.</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">collections</span>::<span class="tok-n">VecDeque</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_n_increasing_running_sum_of_depths</span><span class="tok-p">(</span><span class="tok-n">n</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">depth_buf</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">VecDeque</span>::<span class="tok-n">with_capacity</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">depths</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;./input.txt&quot;</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">());</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">extend</span><span class="tok-p">(</span><span class="tok-n">depths</span><span class="tok-p">.</span><span class="tok-n">by_ref</span><span class="tok-p">().</span><span class="tok-n">take</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">n_increasing</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">new_depth</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">depths</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">old_depth</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">pop_front</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">new_depth</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">new_depth</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">old_depth</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">n_increasing</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">n_increasing</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">()).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">pub</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_n_increasing_running_sum_of_depths</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">pub</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_n_increasing_running_sum_of_depths</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dive">2. Dive!</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/2" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 2 problem description</a></p>
</div>
<div class="paragraph">
<p>There isn&#8217;t really anything too deep to go into here.
You just have to update the current state correctly.
Easy!</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">struct</span> <span class="tok-nc">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">h</span>: <span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">v</span>: <span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">get_ans</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">i32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">v</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;./input.txt&quot;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-o">&lt;</span><span class="tok-n">S</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-kt">str</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-nc">S</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">().</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split_whitespace</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;forward&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;up&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;down&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-p">}.</span><span class="tok-n">get_ans</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-o">&lt;</span><span class="tok-n">S</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-kt">str</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-nc">S</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">().</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split_whitespace</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;forward&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;up&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;down&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-p">}.</span><span class="tok-n">get_ans</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binary_diagnostic">3. Binary Diagnostic</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/3" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 3 problem description</a></p>
</div>
<div class="paragraph">
<p>This challenge mostly just requires filtering arrays and counting elements satisfying a condition.</p>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>The first thing we do is read the input file into a <code>ndarray::Array2&lt;bool&gt;</code> of size <code>(n_rows, n_cols)</code>, where a <code>true</code> value corresponds to a <code>1</code> character in the input, and a <code>false</code> to a <code>0</code>.
We also created a function that converts a binary vector, most significant digit first, to a (decimal) number (see the <a href="#_setup">Setup</a> section above).
For example, given <code>10011</code>, we compute <code>[1, 0, 0, 1, 1] .* [16, 8, 4, 2, 1] = [16, 0, 0, 2, 1]</code>, whose sum is 19.
(This is just how <a href="https://en.wikipedia.org/wiki/Positional_notation#Mathematics" target="_blank" rel="noopener">positional notation</a> works.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-p">{</span><span class="tok-n">to_decimal</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">prelude</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_input_mat</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">ndarray</span>::<span class="tok-n">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">bit_vec</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Vec</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;./input.txt&quot;</span><span class="tok-p">).</span><span class="tok-n">lines</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">first_line</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">line_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">first_line</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">iter</span>::<span class="tok-n">once</span><span class="tok-p">(</span><span class="tok-n">first_line</span><span class="tok-p">).</span><span class="tok-n">chain</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">bytes</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">bit_vec</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-sc">b&#39;1&#39;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">bit_vec</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">line_length</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Array2</span>::<span class="tok-n">from_shape_vec</span><span class="tok-p">((</span><span class="tok-n">n_lines</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">line_length</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">bit_vec</span><span class="tok-p">).</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_input_mat</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">mat</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">mat</span><span class="tok-p">)).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>We are asked to find two numbers, <code>gamma_rate</code> (\(\gamma\)) and <code>epsilon_rate</code> (\(\varepsilon\)).
\(\gamma\) is the value of the binary number whose \(k\)<sup>th</sup> digit is the most common digit in column \(k\) of the array of values.
\(\varepsilon\) is computed using the same idea, but with the least common digit instead.
(It is assumed that there will be no ties.)</p>
</div>
<div class="paragraph">
<p>Since there are only two digits to choose from, the most common digit and the least common digit in each column will be opposites, and so \(\gamma + \varepsilon = \text{all 1s} = 2^{\text{\texttt{line\textunderscore{}width}}}-1\).
In other words we don&#8217;t need to compute \(\varepsilon\) “the long way”; once we have \(\gamma\), we immediately have \(\varepsilon\).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">mat</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_ones</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">x</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">).</span><span class="tok-n">sum_axis</span><span class="tok-p">(</span><span class="tok-n">Axis</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_zeros</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">n_ones</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">n</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">col_has_more_ones_than_zeros</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">Zip</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">n_ones</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">and</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">n_zeros</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map_collect</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">n_o</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_z</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">n_o</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">n_z</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">into_shape</span><span class="tok-p">((</span><span class="tok-n">n_cols</span><span class="tok-p">,))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">gamma_rate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-n">col_has_more_ones_than_zeros</span><span class="tok-p">.</span><span class="tok-n">to_vec</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">epsilon_rate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-k">usize</span><span class="tok-p">.</span><span class="tok-n">pow</span><span class="tok-p">(</span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">gamma_rate</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">gamma_rate</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">epsilon_rate</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>We are asked to find two new numbers, the oxygen scrubber rating <code>oxy_rate</code> and the CO2 scrubber rating <code>co2_rate</code>.
The procedure to find the <code>oxy_rate</code> is as follows:<br></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the list of candidate values to the full list of rows in <code>elems</code> as defined above.</p>
</li>
<li>
<p>With \(k\) ranging from the leftmost column index in <code>elems</code> to the rightmost column index (most significant digit to least):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Successively narrow down the list of candidates by keeping only those remaining candidates whose \(k\)<sup>th</sup> digit is the most common \(k\)<sup>th</sup> digit of the remaining candidates, with a tie between 0 and 1 going to 1.</p>
<div class="ulist">
<ul>
<li>
<p>For instance, when \(k=5\), then keep only the remaining candidates whose 5<sup>th</sup> digit is the most common 5<sup>th</sup> digit (0 or 1, ties going to 1) of all remaining candidates at that stage.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Stop when only one candidate remains.
(This is guaranteed to happen as long as the rows are all distinct.)</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The procedure for <code>co2_rate</code> is the same, except that the list of candidates is filtered down according to the <em>least</em> common digit in each position, with ties going to 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">value_of_line_chosen_by_criterion</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">mat</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">cmp_predicate</span>: <span class="tok-nc">impl</span><span class="tok-w"> </span><span class="tok-nb">Fn</span><span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Array1</span>::<span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;</span>::<span class="tok-n">from_shape_simple_fn</span><span class="tok-p">((</span><span class="tok-n">n_rows</span><span class="tok-p">,),</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_candidates_remaining</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">c</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-k">usize</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">}).</span><span class="tok-n">sum</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">n_candidates_remaining</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">break</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">column</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">index_axis</span><span class="tok-p">(</span><span class="tok-n">Axis</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">digit_sum</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">column</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">filter_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">x</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-p">[[</span><span class="tok-n">i</span><span class="tok-p">]]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">sum</span>::<span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">most_common_digit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">cmp_predicate</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">digit_sum</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_candidates_remaining</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">candidates</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">Zip</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">candidates</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">and</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">column</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">map_collect</span><span class="tok-p">(</span><span class="tok-o">|&amp;</span><span class="tok-n">candidate</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">digit</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">candidate</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">digit</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">most_common_digit</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">into_iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">filter_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">index_axis</span><span class="tok-p">(</span><span class="tok-n">Axis</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">to_vec</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">mat</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">oxy_rate</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">co2_rate</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">[</span><span class="tok-o">|</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">op</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">value_of_line_chosen_by_criterion</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">op</span><span class="tok-p">));</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">oxy_rate</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">co2_rate</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_giant_squid">4. Giant Squid</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/4" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 4 problem description</a></p>
</div>
<div class="paragraph">
<p>The game is represented as a list of boards and a list of drawn numbers.
Each board has:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A dictionary <code>grid</code> that maps undrawn numbers on the board to their Cartesian coordinates (a pair <code>(row, col)</code>) on the board.
When a number is drawn, its Cartesian coordinates are used to update <code>progress</code> (below), and then the number is removed from the dictionary.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The only reason drawn numbers are removed from a board&#8217;s dictionary is that Advent of Code asks for the sum of the board&#8217;s undrawn numbers to compute the answer, so we need to keep track of which numbers on a given board haven&#8217;t been drawn yet.
Otherwise, we&#8217;d have had no reason to mutate the dictionary at all.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>progress</code>, which stores for each row and column the count of numbers in that row/column have not yet been drawn.
If one of those counts hit zero, then every number in that row/column has been drawn, and so the board has a "Bingo" (i.e., has won).</p>
<div class="paragraph">
<p>The row and column indices have the same meaning as the Cartesian coordinates in the dictionary described above: if number 25 is drawn, and 25&#8217;s position on a particular board is <code>(2, 3)</code>, then <code>progress.rows[2]</code> and <code>progress.cols[3]</code> each get decremented.</p>
</div>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>Reading the input text into a game (numbers and boards) is in <code>read_input_into_game</code>, whose (not particularly interesting) implementation should serve as its docs.
<code>get_answer_from_final_game_state</code> is just used to prove to Advent of Code that we actually got the solution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">import</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">Iterators</span><span class="tok-o">:</span> <span class="tok-n">Stateful</span><span class="tok-p">,</span> <span class="tok-n">popfirst!</span><span class="tok-p">,</span> <span class="tok-n">flatten</span>

<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-s">Gives progress towards a win as the number of unmarked squares per row/col. If one of those</span>
<span class="tok-s">numbers hits 0 — the row/col has no unmarked squares left — the board has won.</span>
<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-k">mutable</span> <span class="tok-k">struct</span> <span class="tok-n">BoardProgress</span>
    <span class="tok-c"># From top to bottom</span>
    <span class="tok-n">rows</span><span class="tok-o">::</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-kt">Int</span><span class="tok-p">}</span>

    <span class="tok-c"># From left to right</span>
    <span class="tok-n">cols</span><span class="tok-o">::</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-kt">Int</span><span class="tok-p">}</span>

    <span class="tok-n">BoardProgress</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">fill</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-n">n</span><span class="tok-p">),</span> <span class="tok-n">fill</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-n">n</span><span class="tok-p">))</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">has_won</span><span class="tok-p">(</span><span class="tok-n">progress</span><span class="tok-o">::</span><span class="tok-n">BoardProgress</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-n">any</span><span class="tok-p">(</span><span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-k">for</span> <span class="tok-n">count</span> <span class="tok-kp">in</span> <span class="tok-n">flatten</span><span class="tok-p">((</span><span class="tok-n">progress</span><span class="tok-o">.</span><span class="tok-n">rows</span><span class="tok-p">,</span> <span class="tok-n">progress</span><span class="tok-o">.</span><span class="tok-n">cols</span><span class="tok-p">)))</span>
<span class="tok-k">end</span>

<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-s">Represents a board with numbers of type `T`. Has the following members:</span>

<span class="tok-s">  - `grid`, a `Dict{T, CartesianIndex{2}}` mapping as-yet-undrawn numbers to their</span>
<span class="tok-s">    `CartesianIndex` on the board</span>
<span class="tok-s">  - `progress`, a `BoardProgress`</span>
<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-k">mutable</span> <span class="tok-k">struct</span> <span class="tok-n">Board</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-o">&lt;:</span><span class="tok-kt">Integer</span><span class="tok-p">}</span>
    <span class="tok-n">grid</span><span class="tok-o">::</span><span class="tok-kt">Dict</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-kt">CartesianIndex</span><span class="tok-p">{</span><span class="tok-mi">2</span><span class="tok-p">}}</span>
    <span class="tok-n">progress</span><span class="tok-o">::</span><span class="tok-n">BoardProgress</span>

    <span class="tok-k">function</span> <span class="tok-n">Board</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-o">::</span><span class="tok-kt">Matrix</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}</span>
        <span class="tok-n">size</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">size</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;grid must be a square; got </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>

        <span class="tok-n">grid_size</span> <span class="tok-o">=</span> <span class="tok-n">size</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
        <span class="tok-n">grid</span> <span class="tok-o">=</span> <span class="tok-kt">Dict</span><span class="tok-p">((</span><span class="tok-n">reverse</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-n">p</span> <span class="tok-kp">in</span> <span class="tok-n">pairs</span><span class="tok-p">(</span><span class="tok-n">IndexCartesian</span><span class="tok-p">(),</span> <span class="tok-n">mat</span><span class="tok-p">)))</span>
        <span class="tok-k">return</span> <span class="tok-n">new</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}(</span><span class="tok-n">grid</span><span class="tok-p">,</span> <span class="tok-n">BoardProgress</span><span class="tok-p">(</span><span class="tok-n">grid_size</span><span class="tok-p">))</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">apply_number</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-o">::</span><span class="tok-n">Board</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">},</span> <span class="tok-n">number</span><span class="tok-o">::</span><span class="tok-n">T</span><span class="tok-p">)</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}</span>
    <span class="tok-n">cartesian_index</span> <span class="tok-o">=</span> <span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-n">grid</span><span class="tok-p">,</span> <span class="tok-n">number</span><span class="tok-p">,</span> <span class="tok-n">missing</span><span class="tok-p">)</span>

    <span class="tok-k">if</span> <span class="tok-n">cartesian_index</span> <span class="tok-o">!==</span> <span class="tok-n">missing</span>
        <span class="tok-p">(</span><span class="tok-n">row</span><span class="tok-p">,</span> <span class="tok-n">col</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">cartesian_index</span><span class="tok-p">)</span>
        <span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-n">progress</span><span class="tok-o">.</span><span class="tok-n">rows</span><span class="tok-p">[</span><span class="tok-n">row</span><span class="tok-p">]</span> <span class="tok-o">-=</span> <span class="tok-mi">1</span>
        <span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-n">progress</span><span class="tok-o">.</span><span class="tok-n">cols</span><span class="tok-p">[</span><span class="tok-n">col</span><span class="tok-p">]</span> <span class="tok-o">-=</span> <span class="tok-mi">1</span>

        <span class="tok-n">delete!</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-n">grid</span><span class="tok-p">,</span> <span class="tok-n">number</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-n">has_won</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-o">::</span><span class="tok-n">Board</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">has_won</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-n">progress</span><span class="tok-p">)</span>

<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-s">The entire game: a `Vector{Board}` of boards and a `Vector` of numbers that will be drawn</span>
<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-k">mutable</span> <span class="tok-k">struct</span> <span class="tok-n">Game</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-o">&lt;:</span><span class="tok-kt">Integer</span><span class="tok-p">}</span>
    <span class="tok-n">boards</span><span class="tok-o">::</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">Board</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}}</span>
    <span class="tok-n">numbers</span><span class="tok-o">::</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">read_input_into_game</span><span class="tok-p">(</span><span class="tok-o">::</span><span class="tok-kt">Type</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">},</span> <span class="tok-n">in_file</span><span class="tok-o">::</span><span class="tok-kt">AbstractString</span><span class="tok-p">)</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-o">&lt;:</span><span class="tok-kt">Integer</span><span class="tok-p">}</span>
    <span class="tok-c"># Add an empty last element to the iterator so we don&#39;t have to special-case collecting</span>
    <span class="tok-c"># the rows of the last board in the event that the file doesn&#39;t already end in a newline</span>
    <span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-n">Stateful</span><span class="tok-p">(</span><span class="tok-n">strip</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-n">line</span> <span class="tok-kp">in</span> <span class="tok-n">flatten</span><span class="tok-p">((</span><span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">in_file</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-p">,))))</span>

    <span class="tok-n">numbers_drawn</span> <span class="tok-o">=</span> <span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">,</span> <span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">popfirst!</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">),</span> <span class="tok-sc">&#39;,&#39;</span><span class="tok-p">))</span>

    <span class="tok-n">boards</span> <span class="tok-o">=</span> <span class="tok-n">Board</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}[]</span>
    <span class="tok-n">this_mat_rows</span> <span class="tok-o">=</span> <span class="tok-kt">Matrix</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}[]</span>

    <span class="tok-k">for</span> <span class="tok-n">line</span> <span class="tok-kp">in</span> <span class="tok-n">lines</span>
        <span class="tok-k">if</span> <span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span>
            <span class="tok-k">if</span> <span class="tok-o">!</span><span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">this_mat_rows</span><span class="tok-p">)</span>
                <span class="tok-k">let</span> <span class="tok-n">mat</span> <span class="tok-o">=</span> <span class="tok-n">vcat</span><span class="tok-p">(</span><span class="tok-n">this_mat_rows</span><span class="tok-o">...</span><span class="tok-p">),</span> <span class="tok-n">board</span> <span class="tok-o">=</span> <span class="tok-n">Board</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span>
                    <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">boards</span><span class="tok-p">,</span> <span class="tok-n">board</span><span class="tok-p">)</span>
                <span class="tok-k">end</span>
                <span class="tok-n">empty!</span><span class="tok-p">(</span><span class="tok-n">this_mat_rows</span><span class="tok-p">)</span>
            <span class="tok-k">end</span>
        <span class="tok-k">else</span>
            <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-n">reshape</span><span class="tok-p">(</span><span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">,</span> <span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)),</span> <span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-p">))</span>
            <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">this_mat_rows</span><span class="tok-p">,</span> <span class="tok-n">row</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">Game</span><span class="tok-p">(</span><span class="tok-n">boards</span><span class="tok-p">,</span> <span class="tok-n">numbers_drawn</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">get_answer_from_final_game_state</span><span class="tok-p">(</span><span class="tok-n">winning_number</span><span class="tok-p">,</span> <span class="tok-n">board</span><span class="tok-o">::</span><span class="tok-n">Board</span><span class="tok-p">)</span>
    <span class="tok-n">unmarked_sum</span> <span class="tok-o">=</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-n">grid</span><span class="tok-p">))</span>
    <span class="tok-k">return</span> <span class="tok-n">winning_number</span> <span class="tok-o">*</span> <span class="tok-n">unmarked_sum</span>
<span class="tok-k">end</span>

<span class="tok-n">game</span> <span class="tok-o">=</span> <span class="tok-n">read_input_into_game</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>We simply draw numbers until a board has won, then get the answer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">play_until_first_winner</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-o">::</span><span class="tok-n">Game</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}</span>
    <span class="tok-k">for</span> <span class="tok-n">number</span> <span class="tok-kp">in</span> <span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">numbers</span><span class="tok-p">,</span> <span class="tok-n">board</span> <span class="tok-kp">in</span> <span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">boards</span>
        <span class="tok-n">apply_number</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-p">,</span> <span class="tok-n">number</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">has_won</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-p">)</span>
            <span class="tok-k">return</span> <span class="tok-n">get_answer_from_final_game_state</span><span class="tok-p">(</span><span class="tok-n">number</span><span class="tok-p">,</span> <span class="tok-n">board</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;no boards won&quot;</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-n">xx</span> <span class="tok-o">=</span> <span class="tok-n">Game</span><span class="tok-p">(</span><span class="tok-n">deepcopy</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">boards</span><span class="tok-p">),</span> <span class="tok-n">copy</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">numbers</span><span class="tok-p">))</span>
<span class="tok-nd">@show</span> <span class="tok-n">play_until_first_winner</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-p">)</span>
<span class="tok-nd">@show</span> <span class="tok-n">xx</span><span class="tok-o">.</span><span class="tok-n">boards</span> <span class="tok-o">==</span> <span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">boards</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>This time, we keep track of all of the boards that haven&#8217;t won yet.
When the last un-won boards wins, we use it to compute the answer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">play_until_last_winner</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-o">::</span><span class="tok-n">Game</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}</span>
    <span class="tok-c"># The boards that haven&#39;t won yet</span>
    <span class="tok-n">ongoing_boards</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-kt">Int</span><span class="tok-p">}(</span><span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">boards</span><span class="tok-p">))</span>

    <span class="tok-k">for</span> <span class="tok-n">number</span> <span class="tok-kp">in</span> <span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">numbers</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-n">board_index</span><span class="tok-p">,</span> <span class="tok-n">board</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">pairs</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-o">.</span><span class="tok-n">boards</span><span class="tok-p">)</span>
        <span class="tok-k">let</span> <span class="tok-n">already_won</span> <span class="tok-o">=</span> <span class="tok-n">board_index</span> <span class="tok-o">∉</span> <span class="tok-n">ongoing_boards</span>
            <span class="tok-n">already_won</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">continue</span>
        <span class="tok-k">end</span>

        <span class="tok-n">apply_number</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-p">,</span> <span class="tok-n">number</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">has_won</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-p">)</span>
            <span class="tok-n">delete!</span><span class="tok-p">(</span><span class="tok-n">ongoing_boards</span><span class="tok-p">,</span> <span class="tok-n">board_index</span><span class="tok-p">)</span>

            <span class="tok-k">if</span> <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">ongoing_boards</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
                <span class="tok-k">return</span> <span class="tok-n">get_answer_from_final_game_state</span><span class="tok-p">(</span><span class="tok-n">number</span><span class="tok-p">,</span> <span class="tok-n">board</span><span class="tok-p">)</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;</span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">ongoing_boards</span><span class="tok-p">))</span><span class="tok-s"> boards didn&#39;t win: boards </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">ongoing_boards</span><span class="tok-p">)</span><span class="tok-s">))&quot;</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-nd">@show</span> <span class="tok-n">play_until_last_winner</span><span class="tok-p">(</span><span class="tok-n">game</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hydrothermal_venture">5. Hydrothermal Venture</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/5" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 5 problem description</a></p>
</div>
<div class="paragraph">
<p>This challenge requires iterating the integer points between two other points on the plane.</p>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>First, we read the input into a list of lines of the form \(((x_1, y_1), (x_2, y_2))\)
We also define the helpful <code>range_between(a, b)</code> function, which returns the (nonempty!) range of integers between <code>a</code> and <code>b</code>, inclusive.
The range is ascending if and only if <code>a &lt; b</code>.
(This is different from <code>a:b</code>, which is empty if <code>a &gt; b</code>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">Integer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">regex</span>::<span class="tok-n">Regex</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">collections</span>::<span class="tok-n">BTreeMap</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-kt">str</span>::<span class="tok-n">FromStr</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Hash, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">struct</span> <span class="tok-nc">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">type</span> <span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_lines</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">FromStr</span><span class="tok-o">&gt;</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">line_re</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Regex</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-s">r&quot;(\d+),(\d+)\s*-&gt;\s*(\d+),(\d+)&quot;</span><span class="tok-p">).</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;./input.txt&quot;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">caps</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line_re</span><span class="tok-p">.</span><span class="tok-n">captures</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">4</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">i</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">caps</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">().</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">EndpointPair</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-o">?</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x2</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-o">?</span><span class="tok-p">)))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">range_between</span><span class="tok-p">(</span><span class="tok-n">a</span>: <span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">b</span>: <span class="tok-kt">i32</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">num</span>::<span class="tok-n">iter</span>::<span class="tok-n">RangeStepInclusive</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">step</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">num</span>::<span class="tok-n">range_step_inclusive</span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">step</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_ans</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">counter</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">counter</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">values</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">count</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">count</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">sum</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">endpoints</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_lines</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">endpoints</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">endpoints</span><span class="tok-p">)).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 asks us to count how many times each point belongs to some horizontal or vertical line.
These are lines \(((x_1, y_1), (x_2, y_2))\) for which \(x_1 = x_2\) or \(y_1 = y_2\).
Such a line&#8217;s points are the Cartesian “product” of the ranges <code>range_between(x1, x2)</code> and <code>range_between(y1, y2)</code> (“product” in quotes because one of those ranges has length 1, so it&#8217;s not much of a product).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">get_hv_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">EndpointPair</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">endpoints</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">x1</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-o">*</span><span class="tok-n">counter</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">counter</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">get_hv_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 asks us to count how many times each point belongs to either a horizontal line, a vertical line, or a \(45^\circ\) diagonal line (whose slope must be \(\pm1\)).
We already found the points on horizontal and vertical lines in Part 1.
Diagonal lines are lines \(((x_1, y_1), (x_2, y_2))\) whose points \( (x_k,y_k)\) satisfy \(|x_k-x_1|=|y_k-y_1|\) with \(x_k\) between \(x_1\) and \(x_2\) and \(y_k\) between \(y_k\) and \(y_2\) (inclusive).
Since the \(k\)<sup>th</sup> element of <code>range_between(a, b)</code> is \(a + k\), the points of the diagonal line in question are in fact simply the elements of <code>zip(range_between(x1, x2), range_between(y1, y2))</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">get_diag_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">EndpointPair</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">endpoints</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">).</span><span class="tok-n">abs</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">y1</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">).</span><span class="tok-n">abs</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">).</span><span class="tok-n">zip</span><span class="tok-p">(</span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">*</span><span class="tok-n">counter</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">counter</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">hv_counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_hv_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">all_counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">diag_counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_diag_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">hv_counter</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">*</span><span class="tok-n">diag_counter</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">diag_counter</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">all_counter</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lanternfish">6. Lanternfish</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/6" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 6 problem description</a></p>
</div>
<div class="paragraph">
<p>At a high level, this problem requires modifying a map from ints to ints in a controlled fashion.
At a low level:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This map&#8217;s keys are actually the integers from 0 to 8 (inclusive), so it can just be stored in a list-like data structure, such as a tuple.</p>
</li>
<li>
<p>The “controlled fashion” is merely shifting most values over, while occasionally adding to said values.</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<p>First things first, we need to read our input in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">using</span> <span class="tok-n">BenchmarkTools</span>

<span class="tok-k">function</span> <span class="tok-n">get_ages_tup</span><span class="tok-p">(</span><span class="tok-o">::</span><span class="tok-kt">Type</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-o">&lt;:</span><span class="tok-kt">Integer</span><span class="tok-p">}</span>
    <span class="tok-n">arr</span> <span class="tok-o">=</span> <span class="tok-n">fill</span><span class="tok-p">(</span><span class="tok-n">zero</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">),</span> <span class="tok-mi">9</span><span class="tok-p">)</span>

    <span class="tok-n">contents</span> <span class="tok-o">=</span> <span class="tok-n">read</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;sample_input.txt&quot;</span><span class="tok-p">),</span> <span class="tok-n">String</span><span class="tok-p">)</span>
    <span class="tok-n">nums_list</span> <span class="tok-o">=</span> <span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">,</span> <span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">contents</span><span class="tok-p">,</span> <span class="tok-sc">&#39;,&#39;</span><span class="tok-p">))</span>

    <span class="tok-k">for</span> <span class="tok-n">num</span> <span class="tok-kp">in</span> <span class="tok-n">nums_list</span>
        <span class="tok-n">arr</span><span class="tok-p">[</span><span class="tok-n">num</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">]</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">arr</span><span class="tok-p">)</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">9</span><span class="tok-p">,</span><span class="tok-n">T</span><span class="tok-p">}</span>
<span class="tok-k">end</span>

<span class="tok-n">get_pop</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">)</span>
<span class="tok-n">ages</span> <span class="tok-o">=</span> <span class="tok-n">get_ages_tup</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we create a <code>@generated</code> function that returns (the expression the evaluates to) the tuple containing the next generation.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>A <a href="https://docs.julialang.org/en/v1/manual/metaprogramming/#Generated-functions"><code>@generated</code> function</a> is compiled anew for each tuple of argument types it receives, allowing the function&#8217;s author to use type information — in particular <em>dependent</em> type information — to build the function&#8217;s body at compile time.</p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-nd">@generated</span> <span class="tok-k">function</span> <span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">}</span>
    <span class="tok-n">tuple_expr</span> <span class="tok-o">=</span> <span class="tok-kt">Expr</span><span class="tok-p">(</span><span class="tok-o">:</span><span class="tok-n">tuple</span><span class="tok-p">)</span>
    <span class="tok-k">for</span> <span class="tok-n">i</span> <span class="tok-kp">in</span> <span class="tok-n">Iterators</span><span class="tok-o">.</span><span class="tok-n">flatten</span><span class="tok-p">((</span><span class="tok-mi">2</span><span class="tok-o">:</span><span class="tok-n">N</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">))</span>
        <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">tuple_expr</span><span class="tok-o">.</span><span class="tok-n">args</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-o">$</span><span class="tok-n">i</span><span class="tok-p">]))</span>
    <span class="tok-k">end</span>

    <span class="tok-c"># We need to update the former location of ages[8]</span>
    <span class="tok-c"># 2, 3, 4, 5, 6, 7, 8 &lt;- 7 items</span>
    <span class="tok-n">tuple_expr</span><span class="tok-o">.</span><span class="tok-n">args</span><span class="tok-p">[</span><span class="tok-mi">7</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-o">:</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">8</span><span class="tok-p">]</span> <span class="tok-o">+</span> <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">])</span>

    <span class="tok-k">return</span> <span class="tok-n">tuple_expr</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-n">ages</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">)</span>
    <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">convert</span><span class="tok-p">(</span><span class="tok-kt">Unsigned</span><span class="tok-p">,</span> <span class="tok-n">n</span><span class="tok-p">)</span>
    <span class="tok-k">for</span> <span class="tok-n">_</span> <span class="tok-kp">in</span> <span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-n">n</span>
        <span class="tok-n">ages</span> <span class="tok-o">=</span> <span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
    <span class="tok-k">return</span> <span class="tok-n">ages</span>
<span class="tok-k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then our answers are just the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-nd">@show</span> <span class="tok-n">get_pop</span><span class="tok-p">(</span><span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-mi">80</span><span class="tok-p">,</span> <span class="tok-n">ages</span><span class="tok-p">))</span>
<span class="tok-nd">@show</span> <span class="tok-n">get_pop</span><span class="tok-p">(</span><span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-mi">256</span><span class="tok-p">,</span> <span class="tok-n">ages</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s interesting to see what the <code>@generated</code> function actually gets turned into.
We can see this using Julia&#8217;s <code>@code_lowered</code> macro.
As we can see, it&#8217;s just creating a tuple with some simple indexing and one addition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">julia</span><span class="tok-o">&gt;</span> <span class="tok-nd">@code_lowered</span> <span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">)</span>
<span class="tok-n">CodeInfo</span><span class="tok-p">(</span>
    <span class="tok-err">@</span> <span class="tok-o">/</span><span class="tok-n">Users</span><span class="tok-o">/</span><span class="tok-n">robert</span><span class="tok-o">/</span><span class="tok-n">Documents</span><span class="tok-o">/</span><span class="tok-n">CloudDocs</span><span class="tok-o">/</span><span class="tok-n">Documents</span><span class="tok-o">/</span><span class="tok-n">Coding</span><span class="tok-o">/</span><span class="tok-n">Projects</span><span class="tok-o">/</span><span class="tok-n">Advent</span> <span class="tok-n">of</span> <span class="tok-n">Code</span><span class="tok-o">/</span><span class="tok-mi">2021</span><span class="tok-o">/</span><span class="tok-n">src</span><span class="tok-o">/</span><span class="tok-n">day_06</span><span class="tok-o">/</span><span class="tok-n">soln</span><span class="tok-o">.</span><span class="tok-n">jl</span><span class="tok-o">:</span><span class="tok-mi">84</span> <span class="tok-n">within</span> <span class="tok-sb">`tick`</span>
   <span class="tok-n">┌</span> <span class="tok-err">@</span> <span class="tok-o">/</span><span class="tok-n">Users</span><span class="tok-o">/</span><span class="tok-n">robert</span><span class="tok-o">/</span><span class="tok-n">Documents</span><span class="tok-o">/</span><span class="tok-n">CloudDocs</span><span class="tok-o">/</span><span class="tok-n">Documents</span><span class="tok-o">/</span><span class="tok-n">Coding</span><span class="tok-o">/</span><span class="tok-n">Projects</span><span class="tok-o">/</span><span class="tok-n">Advent</span> <span class="tok-n">of</span> <span class="tok-n">Code</span><span class="tok-o">/</span><span class="tok-mi">2021</span><span class="tok-o">/</span><span class="tok-n">src</span><span class="tok-o">/</span><span class="tok-n">day_06</span><span class="tok-o">/</span><span class="tok-n">soln</span><span class="tok-o">.</span><span class="tok-n">jl</span> <span class="tok-n">within</span> <span class="tok-sb">`macro expansion`</span>
<span class="tok-mi">1</span> <span class="tok-n">─│</span> <span class="tok-o">%</span><span class="tok-mi">1</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">2</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">3</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">4</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">5</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">6</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">6</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">7</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">8</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">8</span>  <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">9</span>  <span class="tok-o">=</span> <span class="tok-o">%</span><span class="tok-mi">7</span> <span class="tok-o">+</span> <span class="tok-o">%</span><span class="tok-mi">8</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">10</span> <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">9</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">11</span> <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">getindex</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
<span class="tok-n">│</span>  <span class="tok-n">│</span> <span class="tok-o">%</span><span class="tok-mi">12</span> <span class="tok-o">=</span> <span class="tok-n">Core</span><span class="tok-o">.</span><span class="tok-n">tuple</span><span class="tok-p">(</span><span class="tok-o">%</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">6</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">9</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-o">%</span><span class="tok-mi">11</span><span class="tok-p">)</span>
<span class="tok-n">└──│</span>       <span class="tok-k">return</span> <span class="tok-o">%</span><span class="tok-mi">12</span>
   <span class="tok-n">└</span>
<span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, it&#8217;s equivalent to this (which has an identical <code>@code_lowered</code> representation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-n">ages</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">}</span>
   <span class="tok-k">return</span> <span class="tok-p">(</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">4</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">5</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">6</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">7</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">8</span><span class="tok-p">]</span> <span class="tok-o">+</span> <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">9</span><span class="tok-p">],</span>
      <span class="tok-n">ages</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span>
    <span class="tok-p">)</span>
<span class="tok-k">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_treachery_of_whales">7. The Treachery of Whales</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/7" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 7 problem description</a></p>
</div>
<div class="paragraph">
<p>This problem asks us, in effect, to find the number that minimizes the sum of particular measures of error.
(Since the number of points is fixed, we will use “sum” and “mean” of the errors interchangeably, as they merely differ by a constant factor.)
A naive solution would iterate through all possibilities; the right way to do this is to use knowledge of statistics.
In both parts, we aim to minimize an <a href="https://en.wikipedia.org/wiki/Norm_(mathematics)#p-norm" target="_blank" rel="noopener">\(l_p\)-norm</a>.</p>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>Reading in the input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">using</span> <span class="tok-n">Statistics</span>

<span class="tok-n">positions</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">fn</span> <span class="tok-o">=</span> <span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">),</span>
        <span class="tok-n">content</span> <span class="tok-o">=</span> <span class="tok-n">read</span><span class="tok-p">(</span><span class="tok-n">fn</span><span class="tok-p">,</span> <span class="tok-n">String</span><span class="tok-p">),</span>
        <span class="tok-n">items</span> <span class="tok-o">=</span> <span class="tok-n">strip</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">,</span> <span class="tok-sc">&#39;,&#39;</span><span class="tok-p">))</span>

        <span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">items</span><span class="tok-p">)</span>
    <span class="tok-k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 asks us, in effect, to find the number \(x\) that minimizes the mean absolute deviation, or the \(l_1\)-norm of the error.
The number that does this is simply the median of the dataset.</p>
</div>
<div class="paragraph">
<p>Proof:
If you are not at the median and move towards it, you are moving toward at least as many data points as you are moving away from, which at best decreases the mean absolute deviation and at worst leaves it unchanged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">md</span> <span class="tok-o">=</span> <span class="tok-n">round</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">median</span><span class="tok-p">(</span><span class="tok-n">positions</span><span class="tok-p">))</span>
<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">abs</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">positions</span> <span class="tok-o">.-</span> <span class="tok-n">md</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>In Part 2, the cost associated with a distance of \(n\) is \(\sum_{k=1}^n k = \frac{n(n+1)}{2}\).
Since \(n\) is an integer, \(n^2\ge n\), and so \(n^2+n\) is “not relatively penalized more than” \(n^2\) would be, which means the mean of the \(\frac{n(n+1)}{2}\) will be minimized whenever the mean of \(n^2\) is minimized.
(It would be a problem if \(n\) exceeded \(n^2\), as then it might dominate in the sum and we&#8217;d no longer be looking to minimize the mean of the \(n^2\).)
This is the <a href="https://en.wikipedia.org/wiki/Mean_squared_error" target="_blank" rel="noopener">mean squared error</a> (MSE, or \(l_2\)-norm of the error), and it is a <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Markov_theorem" target="_blank" rel="noopener">well-known fact of statistics</a> that the MSE is minimized by the arithmetic mean of the data.</p>
</div>
<div class="paragraph">
<p>The only catch is that the arithmetic mean need not be an integer, but the solution to the problem must be.
Naturally we simply try the two integers on either side of the arithmetic mean (which will both be the arithmetic mean itself if it&#8217;s an integer) and pick whichever of the two leads to a smaller error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">mn_lo</span><span class="tok-p">,</span> <span class="tok-n">mn_hi</span> <span class="tok-o">=</span> <span class="tok-n">round</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">mean</span><span class="tok-p">(</span><span class="tok-n">positions</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-nb">RoundDown</span><span class="tok-p">,</span> <span class="tok-nb">RoundUp</span><span class="tok-p">))</span>
<span class="tok-n">cost</span><span class="tok-p">(</span><span class="tok-n">diff</span><span class="tok-p">)</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">diff</span> <span class="tok-o">=</span> <span class="tok-n">abs</span><span class="tok-p">(</span><span class="tok-n">diff</span><span class="tok-p">)</span>
        <span class="tok-n">div</span><span class="tok-p">(</span><span class="tok-n">diff</span> <span class="tok-o">*</span> <span class="tok-p">(</span><span class="tok-n">diff</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-nd">@show</span> <span class="tok-n">minimum</span><span class="tok-p">(</span><span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">cost</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">positions</span> <span class="tok-o">.-</span> <span class="tok-p">[</span><span class="tok-n">mn_lo</span> <span class="tok-n">mn_hi</span><span class="tok-p">]);</span> <span class="tok-n">dims</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_seven_segment_search">8. Seven Segment Search</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/8" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 8 problem description</a></p>
</div>
<div class="paragraph">
<p>What an interesting problem!
We are asked to deduce the manner in which a computer has been incorrectly hooked up to a <a href="https://en.wikipedia.org/wiki/Seven-segment_display" target="_blank" rel="noopener">seven-segment display</a> (7SD):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Seven_segment_01_Pengo.jpg/485px-Seven_segment_01_Pengo.jpg" alt="A seven-segment display chip with pins showing" width="300">
</div>
</div>
<div class="paragraph">
<p>We will use the following display schematic, with the segments labeled A–G:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>  0:      1:      2:      3:      4:
 AAAA            AAAA    AAAA
B    C       C       C       C  B    C
B    C       C       C       C  B    C
                 DDDD    DDDD    DDDD
E    F       F  E            F       F
E    F       F  E            F       F
 GGGG            GGGG    GGGG

  5:      6:      7:      8:      9:
 AAAA    AAAA    AAAA    AAAA    AAAA
B       B            C  B    C  B    C
B       B            C  B    C  B    C
 DDDD    DDDD            DDDD    DDDD
     F  E    F       F  E    F       F
     F  E    F       F  E    F       F
 GGGG    GGGG            GGGG    GGGG</code></pre>
</div>
</div>
<div class="paragraph">
<p>The computer sends a stream of digits that we see as various patterns of lit segments on the 7SD.
The computer has the correct logic to display digits, but its wires to the 7SD got crossed during setup, so the digits it attempts to display end up looking like gibberish to us.
But because the computer&#8217;s underlying logic still holds, we can still deduce things from its output.
For instance, if it lights up only two segments, we know that it is trying to display a 1 (because 1 is the only digit made of exactly two segments), and so the two segments it lit up <em>should</em> be rewired to the two segments <code>CF</code> (although we still don&#8217;t know in which order).
If it lights up five segments, then it could be trying to display either a 2 (<code>ACDEG</code>), 3 (<code>ACDFG</code>), or 5 (<code>ABDFG</code>).
By observing the patterns it lights up, and using our knowledge of how the digits 0–9 should have been displayed, we can deduce the full wiring scheme and how the computer must be rewired to the display in order to function correctly.</p>
</div>
<div class="paragraph">
<p>The only other wrinkle is we don&#8217;t even get to tell the computer which digits to attempt to display; that is entirely up to it.
We simply receive a stream of <em>some</em> digits, and from that must deduce the wiring scheme.</p>
</div>
<div class="paragraph">
<div class="title">The Solution</div>
<p>The strategy is as follows: for each garbled digit we see, record its pattern and the list of candidate digits (those having the same number of segments turned on).
Then, by taking set differences and intersections between the patterns seen and their candidates, we can derive more specific information about the rewiring.
For instance:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Suppose the computer sends two digits and lights up <code>ABD</code> and <code>AB</code>.
<code>ABD</code> only has one candidate, 7 (<code>ACF</code>), because only 7 has three segments turned on.
<code>AB</code> only has one candidate, 1 (<code>CF</code>), because only 1 has two segments turned on.
Then we take the difference of the displayed segments — <code>ABD − AB = D</code> — and all pairwise differences between their corresponding candidates (just one in this case) — <code>ACF − CF = A</code> — to deduce that <code>D</code> must be rewired to <code>A</code>.
We continue this logic, subtracting (say) the map <code>D ➜ A</code> from other display-candidate pairs to narrow <em>them</em> down.
We are done when we know the one segment that each segment needs to be rewired to.</p>
</li>
<li>
<p>Suppose the computer sends <code>ABCDE</code>; its candidates would be 2 (<code>ACDEG</code>), 3 (<code>ACDFG</code>), and 5 (<code>ABDFG</code>).
If it then sends <code>DEF</code>, its candidates would be just 7 (<code>ACF</code>).
The intersection of the two sent digits is <code>DE</code>.
Taking the pairwise intersections between the candidates, and keeping only those with the same length as <code>DE</code>, we see that the candidates for <code>DE</code> are <code>AC</code> and <code>AF</code>.
Subtracting <code>D ➜ A</code> from this, we deduce that <code>E</code> must be mapped to either <code>C</code> or <code>F</code>.
Subtracting <code>D ➜ A</code> and <code>E ➜ C|F</code> from <code>DEF ➜ ACF</code>, we see that <code>F ➜ C|F</code> as well.</p>
</li>
<li>
<p>Continuing this way, we can eventually deduce all the mappings.</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>First, we model the notion of a digit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">N_SEGMENTS</span> <span class="tok-o">=</span> <span class="tok-mi">7</span>

<span class="tok-k">struct</span> <span class="tok-n">Digit</span>
    <span class="tok-n">segments</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-n">N_SEGMENTS</span><span class="tok-p">,</span><span class="tok-kt">Bool</span><span class="tok-p">}</span>
    <span class="tok-n">n_on</span><span class="tok-o">::</span><span class="tok-kt">UInt8</span>

    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-n">N_SEGMENTS</span><span class="tok-p">,</span><span class="tok-kt">Bool</span><span class="tok-p">})</span> <span class="tok-o">=</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-p">,</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-p">))</span>
<span class="tok-k">end</span>
<span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">b</span><span class="tok-o">::</span><span class="tok-kt">Bool</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">ntuple</span><span class="tok-p">(</span><span class="tok-n">Returns</span><span class="tok-p">(</span><span class="tok-n">b</span><span class="tok-p">),</span> <span class="tok-n">N_SEGMENTS</span><span class="tok-p">))</span>

<span class="tok-k">function</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-o">::</span><span class="tok-kt">AbstractString</span><span class="tok-p">)</span>
    <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-n">fill</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">,</span> <span class="tok-n">N_SEGMENTS</span><span class="tok-p">)</span>
    <span class="tok-k">for</span> <span class="tok-n">c</span> <span class="tok-kp">in</span> <span class="tok-n">segments</span>
        <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-o">+</span> <span class="tok-kt">Int</span><span class="tok-p">(</span><span class="tok-n">lowercase</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">))</span> <span class="tok-o">-</span> <span class="tok-kt">Int</span><span class="tok-p">(</span><span class="tok-sc">&#39;a&#39;</span><span class="tok-p">)</span>
        <span class="tok-n">v</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-k">end</span>
    <span class="tok-k">return</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">))</span>
<span class="tok-k">end</span>

<span class="tok-n">segments</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">d</span><span class="tok-o">.</span><span class="tok-n">segments</span>
<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">d</span><span class="tok-o">.</span><span class="tok-n">n_on</span>

<span class="tok-n">DIGITS</span> <span class="tok-o">=</span> <span class="tok-kt">Dict</span><span class="tok-p">(</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abcefg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;cf&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;acdeg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;acdfg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">3</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;bcdf&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">4</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abdfg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">5</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abdefg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">6</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;acf&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">7</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abcdefg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">8</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abcdfg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">9</span><span class="tok-p">,</span>
<span class="tok-p">)</span>

<span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-n">op</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-o">...</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">op</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">)</span><span class="tok-o">...</span><span class="tok-p">))</span>
<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-o">...</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-o">.|</span><span class="tok-p">,</span> <span class="tok-n">x</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">...</span><span class="tok-p">)</span>
<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-o">...</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-o">.&amp;</span><span class="tok-p">,</span> <span class="tok-n">x</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">...</span><span class="tok-p">)</span>
<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">~</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-o">.~</span><span class="tok-p">,</span> <span class="tok-n">x</span><span class="tok-p">)</span>

<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">⊆</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">x</span> <span class="tok-o">&amp;</span> <span class="tok-n">y</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">x</span>
<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">isless</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">string</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">)</span> <span class="tok-o">&lt;</span> <span class="tok-n">string</span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-p">)</span>

<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-o">::</span><span class="tok-kt">IO</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-n">segments</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">),</span> <span class="tok-n">on_indices</span> <span class="tok-o">=</span> <span class="tok-n">findall</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">on_indices</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
            <span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-sc">&#39;∅&#39;</span><span class="tok-p">)</span>
        <span class="tok-k">else</span>
            <span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-s">&quot;ABCDEFG&quot;</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-k">for</span> <span class="tok-n">i</span> <span class="tok-kp">in</span> <span class="tok-n">on_indices</span><span class="tok-p">))</span>
        <span class="tok-k">end</span>
        <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(</span><span class="tok-o">==</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">),</span> <span class="tok-n">DIGITS</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">index</span> <span class="tok-o">!==</span> <span class="tok-nb">nothing</span>
            <span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-sc">&#39;=&#39;</span><span class="tok-p">,</span> <span class="tok-n">index</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>
<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">show</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-o">::</span><span class="tok-kt">IO</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">The Algorithm</div>
<p>We repeatedly take the intersection and set-differences between digits, getting a more and more refined mapping until finally we are left with a 1:1 mapping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">using</span> <span class="tok-n">Combinatorics</span>

<span class="tok-k">function</span> <span class="tok-n">mapping_from_garbled_digits</span><span class="tok-p">(</span><span class="tok-n">garbled_digits</span><span class="tok-o">::</span><span class="tok-kt">AbstractVector</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">})</span>
    <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-kt">Dict</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">,</span><span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}}()</span>
    <span class="tok-k">for</span> <span class="tok-n">gd</span> <span class="tok-kp">in</span> <span class="tok-n">garbled_digits</span>
        <span class="tok-n">mappings</span><span class="tok-p">[</span><span class="tok-n">gd</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">(</span><span class="tok-n">Iterators</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-p">(</span><span class="tok-n">d</span> <span class="tok-o">-&gt;</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">gd</span><span class="tok-p">),</span> <span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">DIGITS</span><span class="tok-p">)))</span>
    <span class="tok-k">end</span>

    <span class="tok-k">while</span> <span class="tok-kc">true</span>
        <span class="tok-n">new_mappings</span> <span class="tok-o">=</span> <span class="tok-n">typeof</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">)()</span>

        <span class="tok-n">garbled_keys</span> <span class="tok-o">=</span> <span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">))</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">garbled1</span><span class="tok-p">,</span> <span class="tok-n">garbled2</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">combinations</span><span class="tok-p">(</span><span class="tok-n">garbled_keys</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
            <span class="tok-n">choices1</span> <span class="tok-o">=</span> <span class="tok-n">mappings</span><span class="tok-p">[</span><span class="tok-n">garbled1</span><span class="tok-p">]</span>
            <span class="tok-n">choices2</span> <span class="tok-o">=</span> <span class="tok-n">mappings</span><span class="tok-p">[</span><span class="tok-n">garbled2</span><span class="tok-p">]</span>

            <span class="tok-n">ops</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">identity</span><span class="tok-p">,</span> <span class="tok-o">~</span><span class="tok-p">)</span>
            <span class="tok-k">for</span> <span class="tok-n">op1</span> <span class="tok-kp">in</span> <span class="tok-n">ops</span><span class="tok-p">,</span> <span class="tok-n">op2</span> <span class="tok-kp">in</span> <span class="tok-n">ops</span>
                <span class="tok-n">op1</span> <span class="tok-o">==</span> <span class="tok-n">op2</span> <span class="tok-o">==</span> <span class="tok-p">(</span><span class="tok-o">~</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">continue</span>

                <span class="tok-n">new_garbled</span> <span class="tok-o">=</span> <span class="tok-n">op1</span><span class="tok-p">(</span><span class="tok-n">garbled1</span><span class="tok-p">)</span> <span class="tok-o">&amp;</span> <span class="tok-n">op2</span><span class="tok-p">(</span><span class="tok-n">garbled2</span><span class="tok-p">)</span>
                <span class="tok-mi">0</span> <span class="tok-o">&lt;</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">new_garbled</span><span class="tok-p">)</span> <span class="tok-o">&lt;</span> <span class="tok-n">N_SEGMENTS</span> <span class="tok-o">||</span> <span class="tok-k">continue</span>

                <span class="tok-n">new_goods</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}()</span>

                <span class="tok-k">for</span> <span class="tok-n">good1</span> <span class="tok-kp">in</span> <span class="tok-n">choices1</span><span class="tok-p">,</span> <span class="tok-n">good2</span> <span class="tok-kp">in</span> <span class="tok-n">choices2</span>
                    <span class="tok-n">new_good</span> <span class="tok-o">=</span> <span class="tok-n">op1</span><span class="tok-p">(</span><span class="tok-n">good1</span><span class="tok-p">)</span> <span class="tok-o">&amp;</span> <span class="tok-n">op2</span><span class="tok-p">(</span><span class="tok-n">good2</span><span class="tok-p">)</span>
                    <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">new_good</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">new_garbled</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-k">continue</span>
                    <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">new_goods</span><span class="tok-p">,</span> <span class="tok-n">new_good</span><span class="tok-p">)</span>
                <span class="tok-k">end</span>

                <span class="tok-k">if</span> <span class="tok-n">new_garbled</span> <span class="tok-o">∉</span> <span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">)</span>
                    <span class="tok-n">new_mappings</span><span class="tok-p">[</span><span class="tok-n">new_garbled</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">new_goods</span>
                <span class="tok-k">else</span>
                    <span class="tok-n">intersect!</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">[</span><span class="tok-n">new_garbled</span><span class="tok-p">],</span> <span class="tok-n">new_goods</span><span class="tok-p">)</span>
                <span class="tok-k">end</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>

        <span class="tok-c"># Remove all keys that can be written as the disjoint-bitwise-or of two other keys,</span>
        <span class="tok-c"># as they&#39;re redundant. This means if e.g., A and BC are present, then remove ABC.</span>
        <span class="tok-c"># But if only AB and BC are present, then do *not* remove ABC (as AB and BC are not</span>
        <span class="tok-c"># disjoint)</span>
        <span class="tok-n">redundant_keys</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}()</span>
        <span class="tok-n">new_garbled_keys</span> <span class="tok-o">=</span> <span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">garbled1</span><span class="tok-p">,</span> <span class="tok-n">garbled2</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">combinations</span><span class="tok-p">(</span><span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">new_garbled_keys</span><span class="tok-p">),</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
            <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">garbled1</span> <span class="tok-o">&amp;</span> <span class="tok-n">garbled2</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-k">continue</span>

            <span class="tok-n">bwo</span> <span class="tok-o">=</span> <span class="tok-n">garbled1</span> <span class="tok-o">|</span> <span class="tok-n">garbled2</span>
            <span class="tok-k">if</span> <span class="tok-n">bwo</span> <span class="tok-o">∈</span> <span class="tok-n">new_garbled_keys</span>
                <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">redundant_keys</span><span class="tok-p">,</span> <span class="tok-n">bwo</span><span class="tok-p">)</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>

        <span class="tok-k">for</span> <span class="tok-n">k</span> <span class="tok-kp">in</span> <span class="tok-n">redundant_keys</span>
            <span class="tok-n">delete!</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">,</span> <span class="tok-n">k</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>

        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">N_SEGMENTS</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">all</span><span class="tok-p">(</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-k">for</span> <span class="tok-n">o</span> <span class="tok-kp">in</span> <span class="tok-n">values</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">)))</span>
            <span class="tok-k">return</span> <span class="tok-kt">Dict</span><span class="tok-p">((</span><span class="tok-n">k</span> <span class="tok-o">=&gt;</span> <span class="tok-n">first</span><span class="tok-p">(</span><span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span> <span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">mappings</span><span class="tok-p">)</span><span class="tok-o">...</span><span class="tok-p">)</span>
        <span class="tok-k">elseif</span> <span class="tok-n">mappings</span> <span class="tok-o">==</span> <span class="tok-n">new_mappings</span>
            <span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">,</span> <span class="tok-s">&quot;could not narrow down to just one choice per segment&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>

        <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-n">new_mappings</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">apply_mapping_to_garbled_digit</span><span class="tok-p">(</span>
    <span class="tok-n">mapping</span><span class="tok-o">::</span><span class="tok-n">AbstractDict</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">,</span><span class="tok-n">Digit</span><span class="tok-p">},</span> <span class="tok-n">garbled_digit</span><span class="tok-o">::</span><span class="tok-n">Digit</span>
<span class="tok-p">)</span>
    <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">)</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span> <span class="tok-n">v</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">mapping</span>
        <span class="tok-k">if</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">garbled_digit</span> <span class="tok-o">&amp;</span> <span class="tok-n">k</span><span class="tok-p">)</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span>
            <span class="tok-n">result</span> <span class="tok-o">|=</span> <span class="tok-n">v</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>
    <span class="tok-k">return</span> <span class="tok-n">DIGITS</span><span class="tok-p">[</span><span class="tok-n">result</span><span class="tok-p">]</span>
<span class="tok-k">end</span>

<span class="tok-n">Line</span> <span class="tok-o">=</span> <span class="tok-n">NamedTuple</span><span class="tok-p">{(</span><span class="tok-o">:</span><span class="tok-kp">in</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-n">out</span><span class="tok-p">),</span><span class="tok-kt">Tuple</span><span class="tok-p">{</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">},</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}}}</span>
<span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-k">let</span>
    <span class="tok-n">arr</span> <span class="tok-o">=</span> <span class="tok-n">Line</span><span class="tok-p">[]</span>
    <span class="tok-k">for</span> <span class="tok-n">line</span> <span class="tok-kp">in</span> <span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span>
        <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">strip</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span>
        <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">continue</span>

        <span class="tok-kp">in</span><span class="tok-p">,</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">strip</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">,</span> <span class="tok-sc">&#39;|&#39;</span><span class="tok-p">))</span>

        <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">arr</span><span class="tok-p">,</span> <span class="tok-p">(;</span> <span class="tok-kp">in</span><span class="tok-o">=</span><span class="tok-n">Digit</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-kp">in</span><span class="tok-p">)),</span> <span class="tok-n">out</span><span class="tok-o">=</span><span class="tok-n">Digit</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">out</span><span class="tok-p">))))</span>
    <span class="tok-k">end</span>
    <span class="tok-n">arr</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">translate_line_to_digits</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">::</span><span class="tok-n">Line</span><span class="tok-p">)</span>
    <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-n">mapping_from_garbled_digits</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-kp">in</span><span class="tok-p">)</span>
    <span class="tok-n">digits</span> <span class="tok-o">=</span> <span class="tok-n">apply_mapping_to_garbled_digit</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Ref</span><span class="tok-p">(</span><span class="tok-n">mapping</span><span class="tok-p">),</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-n">out</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-n">digits</span>
<span class="tok-k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we prove to Advent of Code that we got the right answer.</p>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">all_output_digits</span> <span class="tok-o">=</span> <span class="tok-n">hcat</span><span class="tok-p">(</span><span class="tok-n">translate_line_to_digits</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">)</span><span class="tok-o">...</span><span class="tok-p">)</span>
<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">all_output_digits</span> <span class="tok-o">.∈</span> <span class="tok-kt">Ref</span><span class="tok-p">((</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">8</span><span class="tok-p">)))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">translate_line_to_base10</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">::</span><span class="tok-n">Line</span><span class="tok-p">)</span>
    <span class="tok-n">digits</span> <span class="tok-o">=</span> <span class="tok-n">translate_line_to_digits</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span>
    <span class="tok-n">pow10s</span> <span class="tok-o">=</span> <span class="tok-mi">10</span> <span class="tok-o">.^</span> <span class="tok-p">((</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">digits</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-o">:-</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">0</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">digits</span> <span class="tok-o">.*</span> <span class="tok-n">pow10s</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">translate_line_to_base10</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_smoke_basin">9. Smoke Basin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/9" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 9 problem description</a></p>
</div>
<div class="paragraph">
<p>Nothing complicated here, especially because Julia makes working with arrays/matrices so easy.
We must do the following things with a 2D matrix whose entries are between 1 and 9 (inclusive).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Part 1 we have to find the local minima of the matrix.</p>
</li>
<li>
<p>In Part 2 we have to find the matrix&#8217;s maximal connected regions containing no 9s.
This is just a DFS through the matrix with a small amount of bookkeeping.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">heightmap</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">)),</span>
        <span class="tok-n">vecs</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">line</span> <span class="tok-o">-&gt;</span> <span class="tok-n">reshape</span><span class="tok-p">(</span><span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)),</span> <span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-p">)),</span> <span class="tok-n">lines</span><span class="tok-p">),</span>
        <span class="tok-n">mat</span> <span class="tok-o">=</span> <span class="tok-n">vcat</span><span class="tok-p">(</span><span class="tok-n">vecs</span><span class="tok-o">...</span><span class="tok-p">)</span>

        <span class="tok-n">mat</span>
    <span class="tok-k">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-o">::</span><span class="tok-kt">CartesianIndex</span><span class="tok-p">,</span> <span class="tok-n">mat_axes</span><span class="tok-p">)</span>
    <span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span>
    <span class="tok-n">val</span> <span class="tok-o">=</span> <span class="tok-n">mat</span><span class="tok-p">[</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">]</span>

    <span class="tok-n">row_ax</span><span class="tok-p">,</span> <span class="tok-n">col_ax</span> <span class="tok-o">=</span> <span class="tok-n">mat_axes</span>

    <span class="tok-n">neighbor_indices</span> <span class="tok-o">=</span> <span class="tok-p">((</span><span class="tok-n">r</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">))</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">neighbor_indices</span>
        <span class="tok-k">if</span> <span class="tok-n">nghbr_r</span> <span class="tok-o">∈</span> <span class="tok-n">row_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">nghbr_c</span> <span class="tok-o">∈</span> <span class="tok-n">col_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">mat</span><span class="tok-p">[</span><span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span><span class="tok-p">]</span> <span class="tok-o">&lt;=</span> <span class="tok-n">val</span>
            <span class="tok-k">return</span> <span class="tok-kc">false</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-kc">true</span>
<span class="tok-k">end</span>

<span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">mat_axes</span> <span class="tok-o">=</span> <span class="tok-n">axes</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span>
        <span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">-&gt;</span> <span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">mat_axes</span><span class="tok-p">),</span> <span class="tok-n">CartesianIndices</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">))</span>
    <span class="tok-k">end</span>

<span class="tok-n">risk_level</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">mat</span> <span class="tok-o">.+</span> <span class="tok-mi">1</span>

<span class="tok-n">low_point_risks</span> <span class="tok-o">=</span> <span class="tok-n">risk_level</span><span class="tok-p">(</span><span class="tok-n">heightmap</span><span class="tok-p">)</span> <span class="tok-o">.*</span> <span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">heightmap</span><span class="tok-p">)</span>
<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">low_point_risks</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">get_basin_sizes</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-o">::</span><span class="tok-kt">AbstractMatrix</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}</span>
    <span class="tok-n">row_ax</span><span class="tok-p">,</span> <span class="tok-n">col_ax</span> <span class="tok-o">=</span> <span class="tok-n">axes</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span>
    <span class="tok-n">basin_sizes</span> <span class="tok-o">=</span> <span class="tok-kt">Int</span><span class="tok-p">[]</span>
    <span class="tok-n">not_yet_visited</span> <span class="tok-o">=</span> <span class="tok-n">mat</span> <span class="tok-o">.!=</span> <span class="tok-mi">9</span>

    <span class="tok-n">visited</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">keytype</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)}()</span>
    <span class="tok-n">coords_stack</span> <span class="tok-o">=</span> <span class="tok-n">keytype</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)[]</span>
    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">first_coords</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(</span><span class="tok-n">not_yet_visited</span><span class="tok-p">))</span> <span class="tok-o">!==</span> <span class="tok-nb">nothing</span>
        <span class="tok-n">empty!</span><span class="tok-p">(</span><span class="tok-n">visited</span><span class="tok-p">)</span>

        <span class="tok-n">empty!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">)</span>
        <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">,</span> <span class="tok-n">first_coords</span><span class="tok-p">)</span>

        <span class="tok-k">while</span> <span class="tok-o">!</span><span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">)</span>
            <span class="tok-n">coords</span> <span class="tok-o">=</span> <span class="tok-n">pop!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">)</span>
            <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">visited</span><span class="tok-p">,</span> <span class="tok-n">coords</span><span class="tok-p">)</span>
            <span class="tok-n">not_yet_visited</span><span class="tok-p">[</span><span class="tok-n">coords</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>

            <span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">coords</span><span class="tok-p">)</span>
            <span class="tok-n">neighbor_indices</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span>
                <span class="tok-kt">CartesianIndex</span><span class="tok-p">,</span> <span class="tok-p">((</span><span class="tok-n">r</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">))</span>
            <span class="tok-p">)</span>

            <span class="tok-k">for</span> <span class="tok-n">nghbr_idx</span> <span class="tok-kp">in</span> <span class="tok-n">neighbor_indices</span>
                <span class="tok-n">nghbr_idx</span> <span class="tok-o">∈</span> <span class="tok-n">visited</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">continue</span>

                <span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">nghbr_idx</span><span class="tok-p">)</span>
                <span class="tok-k">if</span> <span class="tok-n">nghbr_r</span> <span class="tok-o">∈</span> <span class="tok-n">row_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">nghbr_c</span> <span class="tok-o">∈</span> <span class="tok-n">col_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">mat</span><span class="tok-p">[</span><span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span><span class="tok-p">]</span> <span class="tok-o">!=</span> <span class="tok-mi">9</span>
                    <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">,</span> <span class="tok-n">nghbr_idx</span><span class="tok-p">)</span>
                <span class="tok-k">end</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>

        <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">basin_sizes</span><span class="tok-p">,</span> <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">visited</span><span class="tok-p">))</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">basin_sizes</span>
<span class="tok-k">end</span>

<span class="tok-n">basin_sizes</span> <span class="tok-o">=</span> <span class="tok-n">sort</span><span class="tok-p">(</span><span class="tok-n">get_basin_sizes</span><span class="tok-p">(</span><span class="tok-n">heightmap</span><span class="tok-p">);</span> <span class="tok-n">rev</span><span class="tok-o">=</span><span class="tok-kc">true</span><span class="tok-p">)</span>
<span class="tok-nd">@show</span> <span class="tok-n">reduce</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-p">,</span> <span class="tok-n">basin_sizes</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-p">])</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_syntax_scoring">10. Syntax Scoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/10" target="^"><span class="icon"><i class="fa fa-external-link"></i></span> Day 10 problem description</a></p>
</div>
<div class="paragraph">
<p>Pretty basic.
The only way to make this interesting was to try and make the code as DRY as possible and to embed as much information in Julia&#8217;s limited type system as possible.</p>
</div>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">)))</span>

<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-s">```jldoctest</span>
<span class="tok-s">julia&gt; braces</span>
<span class="tok-s">4×2 Matrix{Char}:</span>
<span class="tok-s"> &#39;(&#39;  &#39;)&#39;</span>
<span class="tok-s"> &#39;[&#39;  &#39;]&#39;</span>
<span class="tok-s"> &#39;{&#39;  &#39;}&#39;</span>
<span class="tok-s"> &#39;&lt;&#39;  &#39;&gt;&#39;</span>
<span class="tok-s">```</span>
<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-kd">const</span> <span class="tok-n">braces</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-sc">&#39;(&#39;</span> <span class="tok-sc">&#39;)&#39;</span><span class="tok-p">;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-sc">&#39;]&#39;</span><span class="tok-p">;</span> <span class="tok-sc">&#39;{&#39;</span> <span class="tok-sc">&#39;}&#39;</span><span class="tok-p">;</span> <span class="tok-sc">&#39;&lt;&#39;</span> <span class="tok-sc">&#39;&gt;&#39;</span><span class="tok-p">]</span>

<span class="tok-kd">const</span> <span class="tok-n">bracetype_axis</span><span class="tok-p">,</span> <span class="tok-n">orientation_axis</span> <span class="tok-o">=</span> <span class="tok-n">axes</span><span class="tok-p">(</span><span class="tok-n">braces</span><span class="tok-p">)</span>

<span class="tok-k">struct</span> <span class="tok-n">BraceId</span>
    <span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span>
    <span class="tok-k">function</span> <span class="tok-n">BraceId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span><span class="tok-p">)</span>
        <span class="tok-n">id</span> <span class="tok-kp">in</span> <span class="tok-n">bracetype_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid brace: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>
<span class="tok-k">struct</span> <span class="tok-n">OrientationId</span>
    <span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span>
    <span class="tok-k">function</span> <span class="tok-n">OrientationId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span><span class="tok-p">)</span>
        <span class="tok-n">id</span> <span class="tok-kp">in</span> <span class="tok-n">orientation_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid brace: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-n">flip</span><span class="tok-p">(</span><span class="tok-n">o</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">OrientationId</span><span class="tok-p">(</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">orientation_axis</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-n">o</span><span class="tok-o">.</span><span class="tok-n">id</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">)</span>

<span class="tok-n">BraceKind</span><span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">}</span> <span class="tok-o">=</span> <span class="tok-nd">@NamedTuple</span> <span class="tok-p">{</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-n">BraceId</span><span class="tok-p">,</span> <span class="tok-n">elems</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-kt">Char</span><span class="tok-p">}}</span>
<span class="tok-n">Orientation</span><span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">}</span> <span class="tok-o">=</span> <span class="tok-nd">@NamedTuple</span> <span class="tok-p">{</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span><span class="tok-p">,</span> <span class="tok-n">elems</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-kt">Char</span><span class="tok-p">}}</span>

<span class="tok-kd">const</span> <span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-n">angles</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span>
    <span class="tok-n">i</span> <span class="tok-o">-&gt;</span> <span class="tok-p">(;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-n">BraceId</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">),</span> <span class="tok-n">elems</span><span class="tok-o">=</span><span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">braces</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-p">]))</span><span class="tok-o">::</span><span class="tok-n">BraceKind</span><span class="tok-p">,</span> <span class="tok-n">bracetype_axis</span>
<span class="tok-p">)</span>

<span class="tok-kd">const</span> <span class="tok-n">lefts</span><span class="tok-p">,</span> <span class="tok-n">rights</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span>
    <span class="tok-n">i</span> <span class="tok-o">-&gt;</span> <span class="tok-p">(;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-n">OrientationId</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">),</span> <span class="tok-n">elems</span><span class="tok-o">=</span><span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">braces</span><span class="tok-p">[</span><span class="tok-o">:</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-p">]))</span><span class="tok-o">::</span><span class="tok-n">Orientation</span><span class="tok-p">,</span> <span class="tok-n">orientation_axis</span>
<span class="tok-p">)</span>

<span class="tok-k">struct</span> <span class="tok-n">Token</span>
    <span class="tok-n">brace</span><span class="tok-o">::</span><span class="tok-n">BraceId</span>
    <span class="tok-n">orientation</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span>

    <span class="tok-k">function</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-o">::</span><span class="tok-n">BraceId</span><span class="tok-p">,</span> <span class="tok-n">orientation</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span><span class="tok-p">)</span>
        <span class="tok-n">brace</span><span class="tok-o">.</span><span class="tok-n">id</span> <span class="tok-o">∈</span> <span class="tok-n">bracetype_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid brace: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-n">orientation</span><span class="tok-o">.</span><span class="tok-n">id</span> <span class="tok-o">∈</span> <span class="tok-n">orientation_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid orientation: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">orientation</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-p">,</span> <span class="tok-n">orientation</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">get_container</span><span class="tok-p">(</span><span class="tok-n">elem</span><span class="tok-p">,</span> <span class="tok-n">sets</span><span class="tok-p">)</span>
    <span class="tok-n">maybe_superset</span> <span class="tok-o">=</span> <span class="tok-n">Iterators</span><span class="tok-o">.</span><span class="tok-n">peel</span><span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-k">for</span> <span class="tok-n">a</span> <span class="tok-kp">in</span> <span class="tok-n">sets</span> <span class="tok-k">if</span> <span class="tok-n">elem</span> <span class="tok-o">∈</span> <span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-n">elems</span><span class="tok-p">)</span>
    <span class="tok-n">maybe_superset</span> <span class="tok-o">===</span> <span class="tok-nb">nothing</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;invalid: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">elem</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
    <span class="tok-n">superset</span><span class="tok-p">,</span> <span class="tok-n">_rest</span> <span class="tok-o">=</span> <span class="tok-n">maybe_superset</span>
    <span class="tok-k">return</span> <span class="tok-n">superset</span>
<span class="tok-k">end</span>
<span class="tok-k">function</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-o">::</span><span class="tok-kt">Char</span><span class="tok-p">)</span>
    <span class="tok-n">brace</span> <span class="tok-o">=</span> <span class="tok-n">get_container</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-n">angles</span><span class="tok-p">))</span><span class="tok-o">.</span><span class="tok-n">id</span>
    <span class="tok-n">orientation</span> <span class="tok-o">=</span> <span class="tok-n">get_container</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-n">lefts</span><span class="tok-p">,</span> <span class="tok-n">rights</span><span class="tok-p">))</span><span class="tok-o">.</span><span class="tok-n">id</span>

    <span class="tok-k">return</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-p">,</span> <span class="tok-n">orientation</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">show</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-o">::</span><span class="tok-kt">IO</span><span class="tok-p">,</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">show</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-n">braces</span><span class="tok-p">[</span><span class="tok-n">token</span><span class="tok-o">.</span><span class="tok-n">orientation</span><span class="tok-p">,</span> <span class="tok-n">token</span><span class="tok-o">.</span><span class="tok-n">brace</span><span class="tok-p">])</span>

<span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-n">brace</span>
<span class="tok-n">orientation</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-n">orientation</span>
<span class="tok-n">flip</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">),</span> <span class="tok-n">flip</span><span class="tok-p">(</span><span class="tok-n">orientation</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)))</span>

<span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-o">::</span><span class="tok-n">BraceKind</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-n">id</span>
<span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">,</span> <span class="tok-n">o</span><span class="tok-o">::</span><span class="tok-n">Orientation</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">orientation</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">o</span><span class="tok-o">.</span><span class="tok-n">id</span>

<span class="tok-k">struct</span> <span class="tok-n">Ok</span> <span class="tok-k">end</span>
<span class="tok-k">struct</span> <span class="tok-n">Corrupted</span>
    <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">Token</span>
<span class="tok-k">end</span>
<span class="tok-k">struct</span> <span class="tok-n">Incomplete</span>
    <span class="tok-n">tokens</span><span class="tok-o">::</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">Token</span><span class="tok-p">}</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">parse_line</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">::</span><span class="tok-kt">AbstractString</span><span class="tok-p">)</span><span class="tok-o">::</span><span class="tok-kt">Union</span><span class="tok-p">{</span><span class="tok-n">Ok</span><span class="tok-p">,</span><span class="tok-n">Incomplete</span><span class="tok-p">,</span><span class="tok-n">Corrupted</span><span class="tok-p">}</span>
    <span class="tok-n">token_stack</span> <span class="tok-o">=</span> <span class="tok-n">Token</span><span class="tok-p">[]</span>

    <span class="tok-k">for</span> <span class="tok-n">c</span> <span class="tok-kp">in</span> <span class="tok-n">line</span>
        <span class="tok-n">t</span> <span class="tok-o">=</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">)</span>

        <span class="tok-k">if</span> <span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">)</span>
            <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">,</span> <span class="tok-n">t</span><span class="tok-p">)</span>
            <span class="tok-k">continue</span>
        <span class="tok-k">end</span>

        <span class="tok-n">prev</span> <span class="tok-o">=</span> <span class="tok-n">token_stack</span><span class="tok-p">[</span><span class="tok-k">end</span><span class="tok-p">]</span>

        <span class="tok-k">if</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">prev</span><span class="tok-p">,</span> <span class="tok-n">lefts</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span> <span class="tok-n">rights</span><span class="tok-p">)</span>
            <span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">prev</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-k">return</span> <span class="tok-n">Corrupted</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span>
            <span class="tok-n">pop!</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">)</span>
        <span class="tok-k">else</span>
            <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">,</span> <span class="tok-n">t</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">return</span> <span class="tok-n">Ok</span><span class="tok-p">()</span>

    <span class="tok-n">remaining_tokens</span> <span class="tok-o">=</span> <span class="tok-n">flip</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">reverse</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">))</span>
    <span class="tok-k">return</span> <span class="tok-n">Incomplete</span><span class="tok-p">(</span><span class="tok-n">remaining_tokens</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-n">results</span> <span class="tok-o">=</span> <span class="tok-n">parse_line</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">score</span><span class="tok-p">(</span><span class="tok-n">corr</span><span class="tok-o">::</span><span class="tok-n">Corrupted</span><span class="tok-p">)</span>
    <span class="tok-n">t</span> <span class="tok-o">=</span> <span class="tok-n">corr</span><span class="tok-o">.</span><span class="tok-n">token</span>
    <span class="tok-n">scores</span> <span class="tok-o">=</span> <span class="tok-p">(</span>
        <span class="tok-p">(</span><span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-mi">57</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-mi">1197</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">angles</span><span class="tok-p">,</span> <span class="tok-mi">25137</span><span class="tok-p">)</span>
    <span class="tok-p">)</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-kt">Tuple</span><span class="tok-p">{</span><span class="tok-n">BraceKind</span><span class="tok-p">,</span><span class="tok-kt">Int</span><span class="tok-p">}}</span>

    <span class="tok-n">idx</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(((</span><span class="tok-n">brace_type</span><span class="tok-p">,</span> <span class="tok-n">_</span><span class="tok-p">),)</span> <span class="tok-o">-&gt;</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span> <span class="tok-n">brace_type</span><span class="tok-p">),</span> <span class="tok-n">scores</span><span class="tok-p">)</span>
    <span class="tok-n">_</span><span class="tok-p">,</span> <span class="tok-n">score</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-p">[</span><span class="tok-n">idx</span><span class="tok-p">]</span>
    <span class="tok-k">return</span> <span class="tok-n">score</span>
<span class="tok-k">end</span>

<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">score</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-n">r</span> <span class="tok-kp">in</span> <span class="tok-n">results</span> <span class="tok-k">if</span> <span class="tok-n">r</span> <span class="tok-kp">isa</span> <span class="tok-n">Corrupted</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">score</span><span class="tok-p">(</span><span class="tok-n">inco</span><span class="tok-o">::</span><span class="tok-n">Incomplete</span><span class="tok-p">)</span>
    <span class="tok-n">scores</span> <span class="tok-o">=</span> <span class="tok-p">(</span>
        <span class="tok-p">(</span><span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">angles</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
    <span class="tok-p">)</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-kt">Tuple</span><span class="tok-p">{</span><span class="tok-n">BraceKind</span><span class="tok-p">,</span><span class="tok-kt">Int</span><span class="tok-p">}}</span>

    <span class="tok-n">net_score</span> <span class="tok-o">=</span> <span class="tok-mi">0</span>
    <span class="tok-k">for</span> <span class="tok-n">t</span> <span class="tok-kp">in</span> <span class="tok-n">inco</span><span class="tok-o">.</span><span class="tok-n">tokens</span>
        <span class="tok-n">net_score</span> <span class="tok-o">*=</span> <span class="tok-mi">5</span>

        <span class="tok-n">idx</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(((</span><span class="tok-n">brace_type</span><span class="tok-p">,</span> <span class="tok-n">_</span><span class="tok-p">),)</span> <span class="tok-o">-&gt;</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span> <span class="tok-n">brace_type</span><span class="tok-p">),</span> <span class="tok-n">scores</span><span class="tok-p">)</span>
        <span class="tok-n">_</span><span class="tok-p">,</span> <span class="tok-n">score</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-p">[</span><span class="tok-n">idx</span><span class="tok-p">]</span>
        <span class="tok-n">net_score</span> <span class="tok-o">+=</span> <span class="tok-n">score</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">net_score</span>
<span class="tok-k">end</span>

<span class="tok-n">incomplete_scores</span> <span class="tok-o">=</span> <span class="tok-n">sort</span><span class="tok-p">(</span><span class="tok-n">score</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">filter</span><span class="tok-p">(</span><span class="tok-n">r</span> <span class="tok-o">-&gt;</span> <span class="tok-n">r</span> <span class="tok-kp">isa</span> <span class="tok-n">Incomplete</span><span class="tok-p">,</span> <span class="tok-n">results</span><span class="tok-p">)))</span>
<span class="tok-nd">@show</span> <span class="tok-n">incomplete_scores</span><span class="tok-p">[</span><span class="tok-n">div</span><span class="tok-p">(</span>
    <span class="tok-n">firstindex</span><span class="tok-p">(</span><span class="tok-n">incomplete_scores</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-n">lastindex</span><span class="tok-p">(</span><span class="tok-n">incomplete_scores</span><span class="tok-p">),</span> <span class="tok-mi">2</span>
<span class="tok-p">)]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>