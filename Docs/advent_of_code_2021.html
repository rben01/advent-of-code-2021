<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Advent of Code 2021</title>
<link rel="stylesheet" href="/Docs/aoc.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/Docs/syntax-theme.css">
<!-- <script defer src="https://use.fontawesome.com/releases/v5.0.4/js/all.js"></script> -->
<link
	rel="preload"
	href="/docs/iosevka-mono/iosevka-rltb-mono-regular.woff2"
	as="font"
	type="font/woff2"
	crossorigin
/>
<link
	rel="preload"
	href="/docs/iosevka-prop-sans/iosevka-rltb-proportional-sans-regular.woff2"
	as="font"
	type="font/woff2"
	crossorigin
/>
<link
	rel="preload"
	href="/docs/iosevka-prop-sans/iosevka-rltb-proportional-sans-bold.woff2"
	as="font"
	type="font/woff2"
	crossorigin
/>

<link
	rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"
	integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw"
	crossorigin="anonymous"
/>

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js"
	integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH"
	crossorigin="anonymous"
></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script
	defer
	src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js"
	integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v"
	crossorigin="anonymous"
	onload="renderMathInElement(document.body);"
></script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Advent of Code 2021</h1>
<div id="toc" class="toc2">
<div id="toctitle">Challenges</div>
<ul class="sectlevel1">
<li><a href="#_setup">Setup</a></li>
<li><a href="#_sonar_sweep">1. Sonar Sweep</a></li>
<li><a href="#_dive">2. Dive!</a></li>
<li><a href="#_binary_diagnostic">3. Binary Diagnostic</a></li>
<li><a href="#_giant_squid">4. Giant Squid</a></li>
<li><a href="#_hydrothermal_venture">5. Hydrothermal Venture</a></li>
<li><a href="#_lanternfish">6. Lanternfish</a></li>
<li><a href="#_the_treachery_of_whales">7. The Treachery of Whales</a></li>
<li><a href="#_seven_segment_search">8. Seven Segment Search</a></li>
<li><a href="#_smoke_basin">9. Smoke Basin</a></li>
<li><a href="#_syntax_scoring">10. Syntax Scoring</a></li>
<li><a href="#_dumbo_octopus">11. Dumbo Octopus</a></li>
<li><a href="#_passage_pathing">12. Passage Pathing</a></li>
<li><a href="#_transparent_origami">13. Transparent Origami</a></li>
<li><a href="#_extended_polymerization">14. Extended Polymerization</a></li>
<li><a href="#_chiton">15. Chiton</a></li>
<li><a href="#_packet_decoder">16. Packet Decoder</a></li>
<li><a href="#_trick_shot">17. Trick Shot</a></li>
<li><a href="#_snailfish">18. Snailfish</a></li>
<li><a href="#_beacon_scanner">19. Beacon Scanner</a></li>
<li><a href="#_trench_map">20. Trench Map</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p>This doc has my solutions for the <a href="https://adventofcode.com/2021" target="_blank" rel="noopener">2021 Advent of Code</a>.
It assumes some familiarity with <a href="https://www.rust-lang.org/" target="_blank" rel="noopener">the Rust language</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Advent of Code gives all participants the same problems, but gives different inputs to each participant.
Therefore, it makes little sense to give the actual numeric answers to problems here.
However, we do provide the input that was given to us in order to contextualize the input-parsing code.
The solutions below should work for any input/output pair provided by Advent of Code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This document has the solutions out in the open!
Don&#8217;t read it if you&#8217;re still working on Advent of Code.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup"><a class="anchor" href="#_setup"></a>Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Rust is a very strict language and makes you explicitly handle all errors that might arise (as opposed to, say,  exceptions implicitly being thrown on error, as Python does).
However, we can trust our inputs, taken straight from Advent of Code, to be correct and give unambiguous answers without errors.
For this reason, we tend to be pretty loosey-goosey about unwrapping the <code>Option</code>s and <code>Result</code>s that the Rust compiler correctly points out we could theoretically encounter.
(There wouldn&#8217;t be any point to handling those cases gracefully; we&#8217;re just trying to solve Advent of Code, not create general-purpose a submarine-squid-bingo-player that can function sensibly even when the squid gives us nonsensical input.
For our purposes, the residual variants of a <code>Try</code> object at the boundary of our program are <code>unreachable!()</code>.)</p>
</div>
<div class="paragraph">
<p>Commonly used code, in <code>src/lib.rs</code> and <code>src/utils.rs</code>, is below:</p>
</div>
<div class="openblock">
<div class="title"><a href="/src/lib.rs" target="_blank" rel="noopener"><code>lib.rs</code></a></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-cp">#![warn(clippy::pedantic)]</span><span class="tok-w"></span>
<span class="tok-cp">#![allow(</span>
<span class="tok-cp">	clippy::enum_glob_use,</span>
<span class="tok-cp">	clippy::missing_panics_doc,</span>
<span class="tok-cp">	clippy::must_use_candidate,</span>
<span class="tok-cp">	clippy::similar_names,</span>
<span class="tok-cp">	clippy::too_many_lines</span>
<span class="tok-cp">)]</span><span class="tok-w"></span>

<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-p">{</span><span class="tok-n">Debug</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Display</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">mod</span> <span class="tok-nn">utils</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, PartialEq, Eq)]</span><span class="tok-w"></span>
<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">struct</span> <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">day</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">pt1</span>: <span class="tok-nc">T1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">pt2</span>: <span class="tok-nc">T2</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span>: <span class="tok-nc">Debug</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span>: <span class="tok-nc">Debug</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Display</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">fmt</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">f</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-n">Formatter</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">std</span>::<span class="tok-n">fmt</span>::<span class="tok-nb">Result</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">day</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-fm">write!</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;Day: {:?} ; Part 1: {:?} ; Part 2: {:?}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">day</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nb">From</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-p">))</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">((</span><span class="tok-n">day</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">))</span>: <span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">T1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T2</span><span class="tok-p">)))</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">day</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title"><a href="/src/utils.rs" target="_blank" rel="noopener"><code>utils.rs</code></a></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">pub</span><span class="tok-p">(</span><span class="tok-k">crate</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">to_decimal</span><span class="tok-o">&lt;</span><span class="tok-n">V</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-kt">bool</span><span class="tok-p">]</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">binary_digits_msbf</span>: <span class="tok-nc">V</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">binary_digits_msbf</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">binary_digits_msbf</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">binary_digits_msbf</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">rev</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">pow2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">is_on</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-kt">u32</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-n">is_on</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-k">u32</span><span class="tok-p">.</span><span class="tok-n">pow</span><span class="tok-p">(</span><span class="tok-kt">u32</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">pow2</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">reduce</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">unwrap_or</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sonar_sweep"><a class="anchor" href="#_sonar_sweep"></a>1. Sonar Sweep</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/1" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 1 problem description</a> │ <a href="/src/day_01/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Part 1 asks to find when the current depth is greater than the previous depth.
Part 2 asks to find when the current running sum of depths is greater than the previous running sum, with a running sum of length 3.
These are both special cases of finding when the current length-\(n\) running sum of depths is greater than the previous length-\(n\) running sum, with Part 1 using a length of \(n=1\) and Part 2 using \(n=3\).</p>
</div>
<div class="paragraph">
<p>The solution uses a <a href="https://en.wikipedia.org/wiki/Circular_buffer/" target="_blank" rel="noopener">CircularBuffer</a> to keep the past \(n\) depths.
Since the “interior” components of the current and previous running sums are the same, we can compare the two running sums by merely checking the incoming number against the outgoing number, i.e., the new depth against the oldest depth still in the buffer.
If the current depth is greater, then so is the current running sum.</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">collections</span>::<span class="tok-n">VecDeque</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_n_increasing_running_sum_of_depths</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">depth_buf</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">VecDeque</span>::<span class="tok-n">with_capacity</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">depths</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">().</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">());</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">extend</span><span class="tok-p">(</span><span class="tok-n">depths</span><span class="tok-p">.</span><span class="tok-n">by_ref</span><span class="tok-p">().</span><span class="tok-n">take</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">n_increasing</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">new_depth</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">depths</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">old_depth</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">pop_front</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">depth_buf</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">new_depth</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">new_depth</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">old_depth</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">n_increasing</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">n_increasing</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Parts 1 and 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_n_increasing_running_sum_of_depths</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_n_increasing_running_sum_of_depths</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dive"><a class="anchor" href="#_dive"></a>2. Dive!</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/2" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 2 problem description</a> │ <a href="/src/day_02/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>There isn&#8217;t really anything too deep to go into here.
You just have to update the current state correctly.
Easy!</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">type</span> <span class="tok-nc">Num</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i32</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">type</span> <span class="tok-nc">Directions</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Direction</span><span class="tok-o">&gt;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">struct</span> <span class="tok-nc">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">h</span>: <span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">v</span>: <span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">get_ans</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">i32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">v</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">enum</span> <span class="tok-nc">Direction</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Forward</span><span class="tok-p">(</span><span class="tok-n">Num</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Up</span><span class="tok-p">(</span><span class="tok-n">Num</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Down</span><span class="tok-p">(</span><span class="tok-n">Num</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Directions</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Direction</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split_whitespace</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">tokens_iter</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">parse</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-s">&quot;forward&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Forward</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-s">&quot;up&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Up</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-s">&quot;down&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Down</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">directions</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">directions</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">directions</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">directions</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Directions</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Num</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Direction</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">directions</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Forward</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Up</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Down</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-p">}.</span><span class="tok-n">get_ans</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">directions</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Directions</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Num</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Direction</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">directions</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Forward</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">h</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Up</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Down</span><span class="tok-p">(</span><span class="tok-n">dist</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">aim</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">h</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-p">}.</span><span class="tok-n">get_ans</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_binary_diagnostic"><a class="anchor" href="#_binary_diagnostic"></a>3. Binary Diagnostic</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/3" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 3 problem description</a> │ <a href="/src/day_03/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This challenge mostly just requires filtering arrays and counting elements satisfying a condition.</p>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>The first thing we do is read the input file into a <code>ndarray::Array2&lt;bool&gt;</code> of size <code>(n_rows, n_cols)</code>, where a <code>true</code> value corresponds to a <code>1</code> character in the input, and a <code>false</code> to a <code>0</code>.
We also created a function that converts a binary vector, most significant digit first, to a (decimal) number (see the <a href="#_setup">Setup</a> section above).
For example, given <code>10011</code>, we compute <code>[1, 0, 0, 1, 1] .* [16, 8, 4, 2, 1] = [16, 0, 0, 2, 1]</code>, whose sum is 19.
(This is just how <a href="https://en.wikipedia.org/wiki/Positional_notation#Mathematics" target="_blank" rel="noopener">positional notation</a> works.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-p">{</span><span class="tok-n">utils</span>::<span class="tok-n">to_decimal</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">prelude</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">ndarray</span>::<span class="tok-n">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">bit_vec</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Vec</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">first_line</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">line_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">first_line</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">iter</span>::<span class="tok-n">once</span><span class="tok-p">(</span><span class="tok-n">first_line</span><span class="tok-p">).</span><span class="tok-n">chain</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">bytes</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">bit_vec</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-sc">b&#39;1&#39;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">bit_vec</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">line_length</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Array2</span>::<span class="tok-n">from_shape_vec</span><span class="tok-p">((</span><span class="tok-n">n_lines</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">line_length</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">bit_vec</span><span class="tok-p">).</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">mat</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">mat</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>We are asked to find two numbers, <code>gamma_rate</code> (\(\gamma\)) and <code>epsilon_rate</code> (\(\varepsilon\)).
\(\gamma\) is the value of the binary number whose \(k\)<sup>th</sup> digit is the most common digit in column \(k\) of the array of values.
\(\varepsilon\) is computed using the same idea, but with the least common digit instead.
(It is assumed that there will be no ties.)</p>
</div>
<div class="paragraph">
<p>Since there are only two digits to choose from, the most common digit and the least common digit in each column will be opposites, and so \(\gamma + \varepsilon = \text{all 1s} = 2^{\text{\texttt{line\textunderscore{}width}}}-1\).
In other words we don&#8217;t need to compute \(\varepsilon\) “the long way”; once we have \(\gamma\), we immediately have \(\varepsilon\).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">mat</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_ones</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">x</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-kt">usize</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">x</span><span class="tok-p">)).</span><span class="tok-n">sum_axis</span><span class="tok-p">(</span><span class="tok-n">Axis</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_zeros</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">n_ones</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">n</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">col_has_more_ones_than_zeros</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">Zip</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">n_ones</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">and</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">n_zeros</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map_collect</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">n_o</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_z</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">n_o</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">n_z</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">into_shape</span><span class="tok-p">((</span><span class="tok-n">n_cols</span><span class="tok-p">,))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">gamma_rate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-n">col_has_more_ones_than_zeros</span><span class="tok-p">.</span><span class="tok-n">to_vec</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">epsilon_rate</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-k">u32</span><span class="tok-p">.</span><span class="tok-n">pow</span><span class="tok-p">(</span><span class="tok-kt">u32</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">n_cols</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">gamma_rate</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">gamma_rate</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">epsilon_rate</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>We are asked to find two new numbers, the oxygen scrubber rating <code>oxy_rate</code> and the CO2 scrubber rating <code>co2_rate</code>.
The procedure to find the <code>oxy_rate</code> is as follows:<br></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize the list of candidate values to the full list of rows in <code>elems</code> as defined above.</p>
</li>
<li>
<p>With \(k\) ranging from the leftmost column index in <code>elems</code> to the rightmost column index (most significant digit to least):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Successively narrow down the list of candidates by keeping only those remaining candidates whose \(k\)<sup>th</sup> digit is the most common \(k\)<sup>th</sup> digit of the remaining candidates, with a tie between 0 and 1 going to 1.</p>
<div class="ulist">
<ul>
<li>
<p>For instance, when \(k=5\), then keep only the remaining candidates whose 5<sup>th</sup> digit is the most common 5<sup>th</sup> digit (0 or 1, ties going to 1) of all remaining candidates at that stage.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Stop when only one candidate remains.
(This is guaranteed to happen as long as the rows are all distinct.)</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The procedure for <code>co2_rate</code> is the same, except that the list of candidates is filtered down according to the <em>least</em> common digit in each position, with ties going to 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">value_of_line_chosen_by_criterion</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">mat</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">cmp_predicate</span>: <span class="tok-nc">impl</span><span class="tok-w"> </span><span class="tok-nb">Fn</span><span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Array1</span>::<span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;</span>::<span class="tok-n">from_shape_simple_fn</span><span class="tok-p">((</span><span class="tok-n">n_rows</span><span class="tok-p">,),</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_candidates_remaining</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">c</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-k">usize</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">}).</span><span class="tok-n">sum</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">n_candidates_remaining</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">break</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">column</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">index_axis</span><span class="tok-p">(</span><span class="tok-n">Axis</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">digit_sum</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">column</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">filter_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">x</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-p">[[</span><span class="tok-n">i</span><span class="tok-p">]]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-kt">usize</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">sum</span>::<span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">most_common_digit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">cmp_predicate</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">digit_sum</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_candidates_remaining</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">candidates</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">Zip</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">candidates</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">and</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">column</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">map_collect</span><span class="tok-p">(</span><span class="tok-o">|&amp;</span><span class="tok-n">candidate</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">digit</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">candidate</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">digit</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">most_common_digit</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">into_iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">find_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">index_axis</span><span class="tok-p">(</span><span class="tok-n">Axis</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">to_vec</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">mat</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Array2</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">oxy_rate</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">co2_rate</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">[</span><span class="tok-o">|</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">op</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">value_of_line_chosen_by_criterion</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">op</span><span class="tok-p">));</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">oxy_rate</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">co2_rate</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_giant_squid"><a class="anchor" href="#_giant_squid"></a>4. Giant Squid</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/4" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 4 problem description</a> │ <a href="/src/day_04/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>The game is represented as a list of boards and a list of drawn numbers.
Each board has:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A dictionary <code>grid</code> that maps undrawn numbers on the board to their Cartesian coordinates (a pair <code>(row, col)</code>) on the board.
When a number is drawn, its Cartesian coordinates are used to update <code>progress</code> (below), and then the number is removed from the dictionary.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The only reason drawn numbers are removed from a board&#8217;s dictionary is that Advent of Code asks for the sum of the board&#8217;s undrawn numbers to compute the answer, so we need to keep track of which numbers on a given board haven&#8217;t been drawn yet.
Otherwise, we&#8217;d have had no reason to mutate the dictionary at all.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>progress</code>, which stores for each row and column the count of numbers in that row/column have not yet been drawn.
If one of those counts hit zero, then every number in that row/column has been drawn, and so the board has a "Bingo" (i.e., has won).</p>
<div class="paragraph">
<p>The row and column indices have the same meaning as the Cartesian coordinates in the dictionary described above: if number 25 is drawn, and 25&#8217;s position on a particular board is <code>(2, 3)</code>, then <code>progress.rows[2]</code> and <code>progress.cols[3]</code> each get decremented.</p>
</div>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>Reading the input text into a game (numbers and boards) is in <code>read_input_into_game</code>, whose (not particularly interesting) implementation should serve as its docs.
<code>get_answer_from_final_game_state</code> is just used to prove to Advent of Code that we actually got the solution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-p">{</span><span class="tok-n">integer</span>::<span class="tok-n">div_mod_floor</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">collections</span>::<span class="tok-p">{</span><span class="tok-n">BTreeMap</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">BTreeSet</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Set</span><span class="tok-p">},</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kt">str</span>::<span class="tok-n">FromStr</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">BoardProgress</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">rows</span>: <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">cols</span>: <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">has_won</span>: <span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">BoardProgress</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">new</span><span class="tok-p">(</span><span class="tok-n">n_rows</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">rows</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[</span><span class="tok-n">n_cols</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">cols</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[</span><span class="tok-n">n_rows</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">rows</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">cols</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">has_won</span>: <span class="tok-nc">false</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">handle_entry</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">row</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">col</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">[</span><span class="tok-n">row</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">[</span><span class="tok-n">col</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">[</span><span class="tok-n">row</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">[</span><span class="tok-n">col</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">has_won</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Board</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">grid</span>: <span class="tok-nc">Map</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">progress</span>: <span class="tok-nc">BoardProgress</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Board</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">(</span><span class="tok-n">nums</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">T</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">n_cols</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">nums</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-fm">assert_eq!</span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">nums</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">());</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">nums</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">div_mod_floor</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">grid</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">progress</span>: <span class="tok-nc">BoardProgress</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">play_number</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n</span>: <span class="tok-nc">T</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">n</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">coords</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">coords</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">progress</span><span class="tok-p">.</span><span class="tok-n">handle_entry</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">has_won</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">bool</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">progress</span><span class="tok-p">.</span><span class="tok-n">has_won</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">get_ans</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">winning_num</span>: <span class="tok-nc">T</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">T</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">unmarked_sum</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">keys_iter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">keys</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">keys_iter</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">k</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">keys_iter</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">s</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">k</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">s</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">winning_num</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">unmarked_sum</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">struct</span> <span class="tok-nc">Game</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">boards</span>: <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Board</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">numbers</span>: <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">FromStr</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-n">Debug</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Game</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-bp">Self</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">().</span><span class="tok-n">chain</span><span class="tok-p">(</span><span class="tok-n">std</span>::<span class="tok-n">iter</span>::<span class="tok-n">once</span><span class="tok-p">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">nums</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-sc">&#39;,&#39;</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">s</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">boards</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">this_board</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">is_empty</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">!</span><span class="tok-n">this_board</span><span class="tok-p">.</span><span class="tok-n">is_empty</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">board</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Board</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-n">this_board</span><span class="tok-p">.</span><span class="tok-n">as_slice</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">boards</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">board</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">this_board</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">num</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split_whitespace</span><span class="tok-p">().</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">s</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">num</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">num</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">this_board</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">num</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-fm">matches!</span><span class="tok-p">(</span><span class="tok-n">n_cols</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">this_board</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">boards</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">numbers</span>: <span class="tok-nc">nums</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">game1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">game2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">_</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Game</span>::<span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-n">game1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-n">game2</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>We simply draw numbers until a board has won, then get the answer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">game</span>: <span class="tok-nc">Game</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">i32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">num</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">game</span><span class="tok-p">.</span><span class="tok-n">numbers</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">board</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">game</span><span class="tok-p">.</span><span class="tok-n">boards</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">board</span><span class="tok-p">.</span><span class="tok-n">play_number</span><span class="tok-p">(</span><span class="tok-n">num</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">board</span><span class="tok-p">.</span><span class="tok-n">has_won</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">board</span><span class="tok-p">.</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-n">num</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-fm">unreachable!</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>This time, we keep track of all of the boards that haven&#8217;t won yet.
When the last un-won boards wins, we use it to compute the answer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">game</span>: <span class="tok-nc">Game</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">i32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">ongoing_game_idxs</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">game</span><span class="tok-p">.</span><span class="tok-n">boards</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()).</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">num</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">game</span><span class="tok-p">.</span><span class="tok-n">numbers</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">board_idx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">board</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">game</span><span class="tok-p">.</span><span class="tok-n">boards</span><span class="tok-p">.</span><span class="tok-n">iter_mut</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">already_won</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">!</span><span class="tok-n">ongoing_game_idxs</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">board_idx</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">already_won</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-n">board</span><span class="tok-p">.</span><span class="tok-n">play_number</span><span class="tok-p">(</span><span class="tok-n">num</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">board</span><span class="tok-p">.</span><span class="tok-n">has_won</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">ongoing_game_idxs</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">board</span><span class="tok-p">.</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-n">num</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-n">ongoing_game_idxs</span><span class="tok-p">.</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">board_idx</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-fm">unreachable!</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hydrothermal_venture"><a class="anchor" href="#_hydrothermal_venture"></a>5. Hydrothermal Venture</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/5" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 5 problem description</a> │ <a href="/src/day_05/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This challenge requires iterating the integer points between two other points on the plane.</p>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>First, we read the input into a list of lines of the form \(((x_1, y_1), (x_2, y_2))\).
We also define the helpful <code>range_between(a, b)</code> function, which returns the (nonempty!) range of integers between <code>a</code> and <code>b</code>, inclusive.
The range is ascending if and only if <code>a &lt; b</code>.
(This is different from <code>a..=b</code>, which is empty if <code>a &gt; b</code>.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">Integer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">regex</span>::<span class="tok-n">Regex</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">collections</span>::<span class="tok-n">BTreeMap</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-kt">str</span>::<span class="tok-n">FromStr</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Hash, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">struct</span> <span class="tok-nc">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">type</span> <span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_lines</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">FromStr</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">line_re</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Regex</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-s">r&quot;(\d+),(\d+)\s*-&gt;\s*(\d+),(\d+)&quot;</span><span class="tok-p">).</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">input</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">caps</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line_re</span><span class="tok-p">.</span><span class="tok-n">captures</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">4</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">i</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">caps</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">().</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">EndpointPair</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-o">?</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x2</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-o">?</span><span class="tok-p">)))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">range_between</span><span class="tok-p">(</span><span class="tok-n">a</span>: <span class="tok-kt">i32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">b</span>: <span class="tok-kt">i32</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">num</span>::<span class="tok-n">iter</span>::<span class="tok-n">RangeStepInclusive</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">step</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">num</span>::<span class="tok-n">range_step_inclusive</span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">step</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_ans</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">counter</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">counter</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">values</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">count</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">count</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">sum</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">endpoints</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_lines</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">endpoints</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">endpoints</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 asks us to count how many times each point belongs to some horizontal or vertical line.
These are lines \(((x_1, y_1), (x_2, y_2))\) for which \(x_1 = x_2\) or \(y_1 = y_2\).
Such a line&#8217;s points are the Cartesian “product” of the ranges <code>range_between(x1, x2)</code> and <code>range_between(y1, y2)</code> (“product” in quotes because one of those ranges has length 1, so it&#8217;s not much of a product).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">get_hv_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">EndpointPair</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">endpoints</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">x1</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-o">*</span><span class="tok-n">counter</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">counter</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">get_hv_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 asks us to count how many times each point belongs to either a horizontal line, a vertical line, or a \(45^\circ\) diagonal line (whose slope must be \(\pm1\)).
We already found the points on horizontal and vertical lines in Part 1.
Diagonal lines are lines \(((x_1, y_1), (x_2, y_2))\) whose points \( (x_k,y_k)\) satisfy \(|x_k-x_1|=|y_k-y_1|\) with \(x_k\) between \(x_1\) and \(x_2\) and \(y_k\) between \(y_k\) and \(y_2\) (inclusive).
Since the \(k\)<sup>th</sup> element of <code>range_between(a, b)</code> is \(k\) away from \(a\), the points of the diagonal line in question are in fact simply the elements of <code>range_between(x1, x2).zip(range_between(y1, y2))</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">get_diag_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">PointCounter</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">EndpointPair</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">endpoints</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">).</span><span class="tok-n">abs</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">y1</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">).</span><span class="tok-n">abs</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">).</span><span class="tok-n">zip</span><span class="tok-p">(</span><span class="tok-n">range_between</span><span class="tok-p">(</span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">*</span><span class="tok-n">counter</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">counter</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">endpoints</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">EndpointPair</span><span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">hv_counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_hv_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">all_counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">diag_counter</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_diag_point_counts</span><span class="tok-p">(</span><span class="tok-n">endpoints</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">hv_counter</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">*</span><span class="tok-n">diag_counter</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">diag_counter</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">all_counter</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lanternfish"><a class="anchor" href="#_lanternfish"></a>6. Lanternfish</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/6" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 6 problem description</a> │ <a href="/src/day_06/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>At a high level, this problem requires modifying a map from ints to ints in a controlled fashion.
At a low level:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This map&#8217;s keys are actually the integers from 0 to 8 (inclusive), so it can just be stored in an array.</p>
</li>
<li>
<p>The “controlled fashion” is merely shifting most values over.
In one case we have to also add to said values.</p>
</li>
</ol>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-n">N_TIMERS</span>: <span class="tok-kt">usize</span> <span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">9</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">type</span> <span class="tok-nc">Timers</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-kt">usize</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">N_TIMERS</span><span class="tok-p">];</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Timers</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-n">N_TIMERS</span><span class="tok-p">];</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">nums</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-sc">&#39;,&#39;</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">s</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">parse</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">num</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">nums</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">timers</span><span class="tok-p">[</span><span class="tok-n">num</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">timers</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">tick_in_place</span><span class="tok-p">(</span><span class="tok-n">timers</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Timers</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">initial</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-p">(</span><span class="tok-n">N_TIMERS</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">timers</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">timers</span><span class="tok-p">[</span><span class="tok-mi">8</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">initial</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">timers</span><span class="tok-p">[</span><span class="tok-mi">6</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">initial</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-c1">// [usize; 9] implements Copy</span>
<span class="tok-k">fn</span> <span class="tok-nf">tick</span><span class="tok-p">(</span><span class="tok-n">n_times</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">timers</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Timers</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Timers</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">timers</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">n_times</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">tick_in_place</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">timers</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">6</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">timers</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">timers</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;sample_input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Parts 1 and 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">timers</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Timers</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-mi">80</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-p">).</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">sum</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">timers</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Timers</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-mi">256</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">timers</span><span class="tok-p">).</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">sum</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_treachery_of_whales"><a class="anchor" href="#_the_treachery_of_whales"></a>7. The Treachery of Whales</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/7" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 7 problem description</a> │ <a href="/src/day_07/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This problem asks us, in effect, to find the number that minimizes the sum of particular measures of error.
(Since the number of points is fixed, we will use “sum” and “mean” of the errors interchangeably, as they merely differ by a constant factor.)
A naive solution would iterate through all possibilities; the right way to do this is to use knowledge of statistics.
In both parts, we aim to minimize an <a href="https://en.wikipedia.org/wiki/Norm_(mathematics)#p-norm" target="_blank" rel="noopener">\(l_p\)-norm</a>.</p>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>Reading in the input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">using</span> <span class="tok-n">Statistics</span>

<span class="tok-n">positions</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">fn</span> <span class="tok-o">=</span> <span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">),</span>
        <span class="tok-n">content</span> <span class="tok-o">=</span> <span class="tok-n">read</span><span class="tok-p">(</span><span class="tok-n">fn</span><span class="tok-p">,</span> <span class="tok-n">String</span><span class="tok-p">),</span>
        <span class="tok-n">items</span> <span class="tok-o">=</span> <span class="tok-n">strip</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">content</span><span class="tok-p">,</span> <span class="tok-sc">&#39;,&#39;</span><span class="tok-p">))</span>

        <span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">items</span><span class="tok-p">)</span>
    <span class="tok-k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 asks us, in effect, to find the number \(x\) that minimizes the mean absolute deviation, or the \(l_1\)-norm of the error.
The number that does this is simply the median of the dataset.</p>
</div>
<div class="paragraph">
<p>Proof:
If you are not at the median and move towards it, you are moving toward at least as many data points as you are moving away from, which at best decreases the mean absolute deviation and at worst leaves it unchanged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">md</span> <span class="tok-o">=</span> <span class="tok-n">round</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">median</span><span class="tok-p">(</span><span class="tok-n">positions</span><span class="tok-p">))</span>
<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">abs</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">positions</span> <span class="tok-o">.-</span> <span class="tok-n">md</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>In Part 2, the cost associated with a distance of \(n\) is \(\sum_{k=1}^n k = \frac{n(n+1)}{2}\).
Since \(n\) is an integer, \(n^2\ge n\), and so \(n^2+n\) is “not relatively penalized more than” \(n^2\) would be, which means the mean of the \(\frac{n(n+1)}{2}\) will be minimized whenever the mean of \(n^2\) is minimized.
(It would be a problem if \(n\) exceeded \(n^2\), as then it might dominate in the sum and we&#8217;d no longer be looking to minimize the mean of the \(n^2\).)
This is the <a href="https://en.wikipedia.org/wiki/Mean_squared_error" target="_blank" rel="noopener">mean squared error</a> (MSE, or \(l_2\)-norm of the error), and it is a <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Markov_theorem" target="_blank" rel="noopener">well-known fact of statistics</a> that the MSE is minimized by the arithmetic mean of the data.</p>
</div>
<div class="paragraph">
<p>The only catch is that the arithmetic mean need not be an integer, but the solution to the problem must be.
Naturally we simply try the two integers on either side of the arithmetic mean (which will both be the arithmetic mean itself if it&#8217;s an integer) and pick whichever of the two leads to a smaller error.
This works because the error is concave up, i.e., a local minimum is the global minimum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">mn_lo</span><span class="tok-p">,</span> <span class="tok-n">mn_hi</span> <span class="tok-o">=</span> <span class="tok-n">round</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">mean</span><span class="tok-p">(</span><span class="tok-n">positions</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-nb">RoundDown</span><span class="tok-p">,</span> <span class="tok-nb">RoundUp</span><span class="tok-p">))</span>
<span class="tok-n">cost</span><span class="tok-p">(</span><span class="tok-n">diff</span><span class="tok-p">)</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">diff</span> <span class="tok-o">=</span> <span class="tok-n">abs</span><span class="tok-p">(</span><span class="tok-n">diff</span><span class="tok-p">)</span>
        <span class="tok-n">div</span><span class="tok-p">(</span><span class="tok-n">diff</span> <span class="tok-o">*</span> <span class="tok-p">(</span><span class="tok-n">diff</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-nd">@show</span> <span class="tok-n">minimum</span><span class="tok-p">(</span><span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">cost</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">positions</span> <span class="tok-o">.-</span> <span class="tok-p">[</span><span class="tok-n">mn_lo</span> <span class="tok-n">mn_hi</span><span class="tok-p">]);</span> <span class="tok-n">dims</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_seven_segment_search"><a class="anchor" href="#_seven_segment_search"></a>8. Seven Segment Search</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/8" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 8 problem description</a> │ <a href="/src/day_08/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>What an interesting problem!
We are asked to deduce the manner in which a computer has been incorrectly hooked up to a <a href="https://en.wikipedia.org/wiki/Seven-segment_display" target="_blank" rel="noopener">seven-segment display</a> (7SD):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Seven_segment_01_Pengo.jpg/485px-Seven_segment_01_Pengo.jpg" alt="A seven-segment display chip with pins showing" width="300">
</div>
</div>
<div class="paragraph">
<p>We will use the following display schematic, with the segments labeled A–G:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>  0:      1:      2:      3:      4:
 AAAA            AAAA    AAAA
B    C       C       C       C  B    C
B    C       C       C       C  B    C
                 DDDD    DDDD    DDDD
E    F       F  E            F       F
E    F       F  E            F       F
 GGGG            GGGG    GGGG

  5:      6:      7:      8:      9:
 AAAA    AAAA    AAAA    AAAA    AAAA
B       B            C  B    C  B    C
B       B            C  B    C  B    C
 DDDD    DDDD            DDDD    DDDD
     F  E    F       F  E    F       F
     F  E    F       F  E    F       F
 GGGG    GGGG            GGGG    GGGG</code></pre>
</div>
</div>
<div class="paragraph">
<p>The computer sends a stream of digits that we see as various patterns of lit segments on the 7SD.
The computer has the correct logic to display digits, but its wires to the 7SD got crossed during setup, so the digits it attempts to display end up looking like gibberish to us.
But because the computer&#8217;s underlying logic still holds, we can still deduce things from its output.
For instance, if it lights up only two segments, we know that it is trying to display a 1 (because 1 is the only digit made of exactly two segments), and so the two segments it lit up <em>should</em> be rewired to the two segments <code>CF</code> (although we still don&#8217;t know in which order).
If it lights up five segments, then it could be trying to display either a 2 (<code>ACDEG</code>), 3 (<code>ACDFG</code>), or 5 (<code>ABDFG</code>).
By observing the patterns it lights up, and using our knowledge of how the digits 0–9 should have been displayed, we can deduce the full wiring scheme and how the computer must be rewired to the display in order to function correctly.</p>
</div>
<div class="paragraph">
<p>The only other wrinkle is we don&#8217;t even get to tell the computer which digits to attempt to display; that is entirely up to it.
We simply receive a stream of <em>some</em> digits, and from that must deduce the wiring scheme.</p>
</div>
<div class="paragraph">
<div class="title">The Solution</div>
<p>The strategy is as follows: for each garbled digit we see, record its pattern and the list of candidate digits (those having the same number of segments turned on).
Then, by taking set differences and intersections between the patterns seen and their candidates, we can derive more specific information about the rewiring.
For instance:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Suppose the computer sends two digits and lights up <code>ABD</code> and <code>AB</code>.
<code>ABD</code> only has one candidate, 7 (<code>ACF</code>), because only 7 has three segments turned on.
<code>AB</code> only has one candidate, 1 (<code>CF</code>), because only 1 has two segments turned on.
Then we take the difference of the displayed segments — <code>ABD − AB = D</code> — and all pairwise differences between their corresponding candidates (just one in this case) — <code>ACF − CF = A</code> — to deduce that <code>D</code> must be rewired to <code>A</code>.
We continue this logic, subtracting (say) the map <code>D ➜ A</code> from other display-candidate pairs to narrow <em>them</em> down.
We are done when we know the one segment that each segment needs to be rewired to.</p>
</li>
<li>
<p>Suppose the computer sends <code>ABCDE</code>; its candidates would be 2 (<code>ACDEG</code>), 3 (<code>ACDFG</code>), and 5 (<code>ABDFG</code>).
If it then sends <code>DEF</code>, its candidates would be just 7 (<code>ACF</code>).
The intersection of the two sent digits is <code>DE</code>.
Taking the pairwise intersections between the candidates, and keeping only those with the same length as <code>DE</code>, we see that the candidates for <code>DE</code> are <code>AC</code> and <code>AF</code>.
Subtracting <code>D ➜ A</code> from this, we deduce that <code>E</code> must be mapped to either <code>C</code> or <code>F</code>.
Subtracting <code>D ➜ A</code> and <code>E ➜ C|F</code> from <code>DEF ➜ ACF</code>, we see that <code>F ➜ C|F</code> as well.</p>
</li>
<li>
<p>Continuing this way, we can eventually deduce all the mappings.</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>First, we model the notion of a digit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">N_SEGMENTS</span> <span class="tok-o">=</span> <span class="tok-mi">7</span>

<span class="tok-k">struct</span> <span class="tok-n">Digit</span>
    <span class="tok-n">segments</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-n">N_SEGMENTS</span><span class="tok-p">,</span><span class="tok-kt">Bool</span><span class="tok-p">}</span>
    <span class="tok-n">n_on</span><span class="tok-o">::</span><span class="tok-kt">UInt8</span>

    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-n">N_SEGMENTS</span><span class="tok-p">,</span><span class="tok-kt">Bool</span><span class="tok-p">})</span> <span class="tok-o">=</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-p">,</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-p">))</span>
<span class="tok-k">end</span>
<span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">b</span><span class="tok-o">::</span><span class="tok-kt">Bool</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">ntuple</span><span class="tok-p">(</span><span class="tok-n">Returns</span><span class="tok-p">(</span><span class="tok-n">b</span><span class="tok-p">),</span> <span class="tok-n">N_SEGMENTS</span><span class="tok-p">))</span>

<span class="tok-k">function</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-o">::</span><span class="tok-kt">AbstractString</span><span class="tok-p">)</span>
    <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-n">fill</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">,</span> <span class="tok-n">N_SEGMENTS</span><span class="tok-p">)</span>
    <span class="tok-k">for</span> <span class="tok-n">c</span> <span class="tok-kp">in</span> <span class="tok-n">segments</span>
        <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span> <span class="tok-o">+</span> <span class="tok-kt">Int</span><span class="tok-p">(</span><span class="tok-n">lowercase</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">))</span> <span class="tok-o">-</span> <span class="tok-kt">Int</span><span class="tok-p">(</span><span class="tok-sc">&#39;a&#39;</span><span class="tok-p">)</span>
        <span class="tok-n">v</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-kc">true</span>
    <span class="tok-k">end</span>
    <span class="tok-k">return</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">))</span>
<span class="tok-k">end</span>

<span class="tok-n">segments</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">d</span><span class="tok-o">.</span><span class="tok-n">segments</span>
<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">d</span><span class="tok-o">.</span><span class="tok-n">n_on</span>

<span class="tok-n">DIGITS</span> <span class="tok-o">=</span> <span class="tok-kt">Dict</span><span class="tok-p">(</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abcefg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;cf&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;acdeg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;acdfg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">3</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;bcdf&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">4</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abdfg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">5</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abdefg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">6</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;acf&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">7</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abcdefg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">8</span><span class="tok-p">,</span>
    <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-s">&quot;abcdfg&quot;</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">9</span><span class="tok-p">,</span>
<span class="tok-p">)</span>

<span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-n">op</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-o">...</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-n">op</span><span class="tok-p">(</span><span class="tok-n">segments</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">)</span><span class="tok-o">...</span><span class="tok-p">))</span>
<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-o">...</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-o">.|</span><span class="tok-p">,</span> <span class="tok-n">x</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">...</span><span class="tok-p">)</span>
<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-o">...</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-o">.&amp;</span><span class="tok-p">,</span> <span class="tok-n">x</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">...</span><span class="tok-p">)</span>
<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">~</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">binop</span><span class="tok-p">(</span><span class="tok-o">.~</span><span class="tok-p">,</span> <span class="tok-n">x</span><span class="tok-p">)</span>

<span class="tok-n">Base</span><span class="tok-o">.:</span><span class="tok-p">(</span><span class="tok-o">⊆</span><span class="tok-p">)(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">x</span> <span class="tok-o">&amp;</span> <span class="tok-n">y</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">x</span>
<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">isless</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">string</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">)</span> <span class="tok-o">&lt;</span> <span class="tok-n">string</span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-p">)</span>

<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-o">::</span><span class="tok-kt">IO</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-n">segments</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">),</span> <span class="tok-n">on_indices</span> <span class="tok-o">=</span> <span class="tok-n">findall</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">on_indices</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
            <span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-sc">&#39;∅&#39;</span><span class="tok-p">)</span>
        <span class="tok-k">else</span>
            <span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-s">&quot;ABCDEFG&quot;</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-k">for</span> <span class="tok-n">i</span> <span class="tok-kp">in</span> <span class="tok-n">on_indices</span><span class="tok-p">))</span>
        <span class="tok-k">end</span>
        <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(</span><span class="tok-o">==</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">),</span> <span class="tok-n">DIGITS</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">index</span> <span class="tok-o">!==</span> <span class="tok-nb">nothing</span>
            <span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-sc">&#39;=&#39;</span><span class="tok-p">,</span> <span class="tok-n">index</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>
<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">show</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-o">::</span><span class="tok-kt">IO</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-o">::</span><span class="tok-n">Digit</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">print</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">The Algorithm</div>
<p>We repeatedly take the intersection and set-differences between digits, getting a more and more refined mapping until finally we are left with a 1:1 mapping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">using</span> <span class="tok-n">Combinatorics</span>

<span class="tok-k">function</span> <span class="tok-n">mapping_from_garbled_digits</span><span class="tok-p">(</span><span class="tok-n">garbled_digits</span><span class="tok-o">::</span><span class="tok-kt">AbstractVector</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">})</span>
    <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-kt">Dict</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">,</span><span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}}()</span>
    <span class="tok-k">for</span> <span class="tok-n">gd</span> <span class="tok-kp">in</span> <span class="tok-n">garbled_digits</span>
        <span class="tok-n">mappings</span><span class="tok-p">[</span><span class="tok-n">gd</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">(</span><span class="tok-n">Iterators</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-p">(</span><span class="tok-n">d</span> <span class="tok-o">-&gt;</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">d</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">gd</span><span class="tok-p">),</span> <span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">DIGITS</span><span class="tok-p">)))</span>
    <span class="tok-k">end</span>

    <span class="tok-k">while</span> <span class="tok-kc">true</span>
        <span class="tok-n">new_mappings</span> <span class="tok-o">=</span> <span class="tok-n">typeof</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">)()</span>

        <span class="tok-n">garbled_keys</span> <span class="tok-o">=</span> <span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">))</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">garbled1</span><span class="tok-p">,</span> <span class="tok-n">garbled2</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">combinations</span><span class="tok-p">(</span><span class="tok-n">garbled_keys</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
            <span class="tok-n">choices1</span> <span class="tok-o">=</span> <span class="tok-n">mappings</span><span class="tok-p">[</span><span class="tok-n">garbled1</span><span class="tok-p">]</span>
            <span class="tok-n">choices2</span> <span class="tok-o">=</span> <span class="tok-n">mappings</span><span class="tok-p">[</span><span class="tok-n">garbled2</span><span class="tok-p">]</span>

            <span class="tok-n">ops</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">identity</span><span class="tok-p">,</span> <span class="tok-o">~</span><span class="tok-p">)</span>
            <span class="tok-k">for</span> <span class="tok-n">op1</span> <span class="tok-kp">in</span> <span class="tok-n">ops</span><span class="tok-p">,</span> <span class="tok-n">op2</span> <span class="tok-kp">in</span> <span class="tok-n">ops</span>
                <span class="tok-n">op1</span> <span class="tok-o">==</span> <span class="tok-n">op2</span> <span class="tok-o">==</span> <span class="tok-p">(</span><span class="tok-o">~</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">continue</span>

                <span class="tok-n">new_garbled</span> <span class="tok-o">=</span> <span class="tok-n">op1</span><span class="tok-p">(</span><span class="tok-n">garbled1</span><span class="tok-p">)</span> <span class="tok-o">&amp;</span> <span class="tok-n">op2</span><span class="tok-p">(</span><span class="tok-n">garbled2</span><span class="tok-p">)</span>
                <span class="tok-mi">0</span> <span class="tok-o">&lt;</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">new_garbled</span><span class="tok-p">)</span> <span class="tok-o">&lt;</span> <span class="tok-n">N_SEGMENTS</span> <span class="tok-o">||</span> <span class="tok-k">continue</span>

                <span class="tok-n">new_goods</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}()</span>

                <span class="tok-k">for</span> <span class="tok-n">good1</span> <span class="tok-kp">in</span> <span class="tok-n">choices1</span><span class="tok-p">,</span> <span class="tok-n">good2</span> <span class="tok-kp">in</span> <span class="tok-n">choices2</span>
                    <span class="tok-n">new_good</span> <span class="tok-o">=</span> <span class="tok-n">op1</span><span class="tok-p">(</span><span class="tok-n">good1</span><span class="tok-p">)</span> <span class="tok-o">&amp;</span> <span class="tok-n">op2</span><span class="tok-p">(</span><span class="tok-n">good2</span><span class="tok-p">)</span>
                    <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">new_good</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">new_garbled</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-k">continue</span>
                    <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">new_goods</span><span class="tok-p">,</span> <span class="tok-n">new_good</span><span class="tok-p">)</span>
                <span class="tok-k">end</span>

                <span class="tok-k">if</span> <span class="tok-n">new_garbled</span> <span class="tok-o">∉</span> <span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">)</span>
                    <span class="tok-n">new_mappings</span><span class="tok-p">[</span><span class="tok-n">new_garbled</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">new_goods</span>
                <span class="tok-k">else</span>
                    <span class="tok-n">intersect!</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">[</span><span class="tok-n">new_garbled</span><span class="tok-p">],</span> <span class="tok-n">new_goods</span><span class="tok-p">)</span>
                <span class="tok-k">end</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>

        <span class="tok-c"># Remove all keys that can be written as the disjoint-bitwise-or of two other keys,</span>
        <span class="tok-c"># as they&#39;re redundant. This means if e.g., A and BC are present, then remove ABC.</span>
        <span class="tok-c"># But if only AB and BC are present, then do *not* remove ABC (as AB and BC are not</span>
        <span class="tok-c"># disjoint)</span>
        <span class="tok-n">redundant_keys</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}()</span>
        <span class="tok-n">new_garbled_keys</span> <span class="tok-o">=</span> <span class="tok-n">keys</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">garbled1</span><span class="tok-p">,</span> <span class="tok-n">garbled2</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">combinations</span><span class="tok-p">(</span><span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">new_garbled_keys</span><span class="tok-p">),</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
            <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">garbled1</span> <span class="tok-o">&amp;</span> <span class="tok-n">garbled2</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-k">continue</span>

            <span class="tok-n">bwo</span> <span class="tok-o">=</span> <span class="tok-n">garbled1</span> <span class="tok-o">|</span> <span class="tok-n">garbled2</span>
            <span class="tok-k">if</span> <span class="tok-n">bwo</span> <span class="tok-o">∈</span> <span class="tok-n">new_garbled_keys</span>
                <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">redundant_keys</span><span class="tok-p">,</span> <span class="tok-n">bwo</span><span class="tok-p">)</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>

        <span class="tok-k">for</span> <span class="tok-n">k</span> <span class="tok-kp">in</span> <span class="tok-n">redundant_keys</span>
            <span class="tok-n">delete!</span><span class="tok-p">(</span><span class="tok-n">new_mappings</span><span class="tok-p">,</span> <span class="tok-n">k</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>

        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">N_SEGMENTS</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">all</span><span class="tok-p">(</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-k">for</span> <span class="tok-n">o</span> <span class="tok-kp">in</span> <span class="tok-n">values</span><span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">)))</span>
            <span class="tok-k">return</span> <span class="tok-kt">Dict</span><span class="tok-p">((</span><span class="tok-n">k</span> <span class="tok-o">=&gt;</span> <span class="tok-n">first</span><span class="tok-p">(</span><span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span> <span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">mappings</span><span class="tok-p">)</span><span class="tok-o">...</span><span class="tok-p">)</span>
        <span class="tok-k">elseif</span> <span class="tok-n">mappings</span> <span class="tok-o">==</span> <span class="tok-n">new_mappings</span>
            <span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-n">mappings</span><span class="tok-p">,</span> <span class="tok-s">&quot;could not narrow down to just one choice per segment&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>

        <span class="tok-n">mappings</span> <span class="tok-o">=</span> <span class="tok-n">new_mappings</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">apply_mapping_to_garbled_digit</span><span class="tok-p">(</span>
    <span class="tok-n">mapping</span><span class="tok-o">::</span><span class="tok-n">AbstractDict</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">,</span><span class="tok-n">Digit</span><span class="tok-p">},</span> <span class="tok-n">garbled_digit</span><span class="tok-o">::</span><span class="tok-n">Digit</span>
<span class="tok-p">)</span>
    <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">Digit</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">)</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span> <span class="tok-n">v</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">mapping</span>
        <span class="tok-k">if</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">garbled_digit</span> <span class="tok-o">&amp;</span> <span class="tok-n">k</span><span class="tok-p">)</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span>
            <span class="tok-n">result</span> <span class="tok-o">|=</span> <span class="tok-n">v</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>
    <span class="tok-k">return</span> <span class="tok-n">DIGITS</span><span class="tok-p">[</span><span class="tok-n">result</span><span class="tok-p">]</span>
<span class="tok-k">end</span>

<span class="tok-n">Line</span> <span class="tok-o">=</span> <span class="tok-n">NamedTuple</span><span class="tok-p">{(</span><span class="tok-o">:</span><span class="tok-kp">in</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-n">out</span><span class="tok-p">),</span><span class="tok-kt">Tuple</span><span class="tok-p">{</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">},</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">Digit</span><span class="tok-p">}}}</span>
<span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-k">let</span>
    <span class="tok-n">arr</span> <span class="tok-o">=</span> <span class="tok-n">Line</span><span class="tok-p">[]</span>
    <span class="tok-k">for</span> <span class="tok-n">line</span> <span class="tok-kp">in</span> <span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span>
        <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">strip</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span>
        <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">continue</span>

        <span class="tok-kp">in</span><span class="tok-p">,</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-n">strip</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">,</span> <span class="tok-sc">&#39;|&#39;</span><span class="tok-p">))</span>

        <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">arr</span><span class="tok-p">,</span> <span class="tok-p">(;</span> <span class="tok-kp">in</span><span class="tok-o">=</span><span class="tok-n">Digit</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-kp">in</span><span class="tok-p">)),</span> <span class="tok-n">out</span><span class="tok-o">=</span><span class="tok-n">Digit</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">out</span><span class="tok-p">))))</span>
    <span class="tok-k">end</span>
    <span class="tok-n">arr</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">translate_line_to_digits</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">::</span><span class="tok-n">Line</span><span class="tok-p">)</span>
    <span class="tok-n">mapping</span> <span class="tok-o">=</span> <span class="tok-n">mapping_from_garbled_digits</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-kp">in</span><span class="tok-p">)</span>
    <span class="tok-n">digits</span> <span class="tok-o">=</span> <span class="tok-n">apply_mapping_to_garbled_digit</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Ref</span><span class="tok-p">(</span><span class="tok-n">mapping</span><span class="tok-p">),</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-n">out</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-n">digits</span>
<span class="tok-k">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we prove to Advent of Code that we got the right answer.</p>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">all_output_digits</span> <span class="tok-o">=</span> <span class="tok-n">hcat</span><span class="tok-p">(</span><span class="tok-n">translate_line_to_digits</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">)</span><span class="tok-o">...</span><span class="tok-p">)</span>
<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">all_output_digits</span> <span class="tok-o">.∈</span> <span class="tok-kt">Ref</span><span class="tok-p">((</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-mi">7</span><span class="tok-p">,</span> <span class="tok-mi">8</span><span class="tok-p">)))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">translate_line_to_base10</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">::</span><span class="tok-n">Line</span><span class="tok-p">)</span>
    <span class="tok-n">digits</span> <span class="tok-o">=</span> <span class="tok-n">translate_line_to_digits</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)</span>
    <span class="tok-n">pow10s</span> <span class="tok-o">=</span> <span class="tok-mi">10</span> <span class="tok-o">.^</span> <span class="tok-p">((</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">digits</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-o">:-</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">0</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">digits</span> <span class="tok-o">.*</span> <span class="tok-n">pow10s</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">translate_line_to_base10</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_smoke_basin"><a class="anchor" href="#_smoke_basin"></a>9. Smoke Basin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/9" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 9 problem description</a> │ <a href="/src/day_09/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Nothing complicated here, especially because Julia makes working with arrays/matrices so easy.
We must do the following things with a 2D matrix whose entries are between 1 and 9 (inclusive).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Part 1 we have to find the local minima of the matrix.</p>
</li>
<li>
<p>In Part 2 we have to find the matrix&#8217;s maximal connected regions containing no 9s.
This is just a DFS through the matrix with a small amount of bookkeeping.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">heightmap</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">)),</span>
        <span class="tok-n">vecs</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">line</span> <span class="tok-o">-&gt;</span> <span class="tok-n">reshape</span><span class="tok-p">(</span><span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">)),</span> <span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-p">)),</span> <span class="tok-n">lines</span><span class="tok-p">),</span>
        <span class="tok-n">mat</span> <span class="tok-o">=</span> <span class="tok-n">vcat</span><span class="tok-p">(</span><span class="tok-n">vecs</span><span class="tok-o">...</span><span class="tok-p">)</span>

        <span class="tok-n">mat</span>
    <span class="tok-k">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-o">::</span><span class="tok-kt">CartesianIndex</span><span class="tok-p">,</span> <span class="tok-n">mat_axes</span><span class="tok-p">)</span>
    <span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span>
    <span class="tok-n">val</span> <span class="tok-o">=</span> <span class="tok-n">mat</span><span class="tok-p">[</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">]</span>

    <span class="tok-n">row_ax</span><span class="tok-p">,</span> <span class="tok-n">col_ax</span> <span class="tok-o">=</span> <span class="tok-n">mat_axes</span>

    <span class="tok-n">neighbor_indices</span> <span class="tok-o">=</span> <span class="tok-p">((</span><span class="tok-n">r</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">))</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span><span class="tok-p">)</span> <span class="tok-kp">in</span> <span class="tok-n">neighbor_indices</span>
        <span class="tok-k">if</span> <span class="tok-n">nghbr_r</span> <span class="tok-o">∈</span> <span class="tok-n">row_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">nghbr_c</span> <span class="tok-o">∈</span> <span class="tok-n">col_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">mat</span><span class="tok-p">[</span><span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span><span class="tok-p">]</span> <span class="tok-o">&lt;=</span> <span class="tok-n">val</span>
            <span class="tok-k">return</span> <span class="tok-kc">false</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-kc">true</span>
<span class="tok-k">end</span>

<span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span> <span class="tok-o">=</span>
    <span class="tok-k">let</span> <span class="tok-n">mat_axes</span> <span class="tok-o">=</span> <span class="tok-n">axes</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span>
        <span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">i</span> <span class="tok-o">-&gt;</span> <span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">mat_axes</span><span class="tok-p">),</span> <span class="tok-n">CartesianIndices</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">))</span>
    <span class="tok-k">end</span>

<span class="tok-n">risk_level</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">mat</span> <span class="tok-o">.+</span> <span class="tok-mi">1</span>

<span class="tok-n">low_point_risks</span> <span class="tok-o">=</span> <span class="tok-n">risk_level</span><span class="tok-p">(</span><span class="tok-n">heightmap</span><span class="tok-p">)</span> <span class="tok-o">.*</span> <span class="tok-n">is_lower_than_neighbors</span><span class="tok-p">(</span><span class="tok-n">heightmap</span><span class="tok-p">)</span>
<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">low_point_risks</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">get_basin_sizes</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-o">::</span><span class="tok-kt">AbstractMatrix</span><span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">})</span> <span class="tok-n">where</span> <span class="tok-p">{</span><span class="tok-n">T</span><span class="tok-p">}</span>
    <span class="tok-n">row_ax</span><span class="tok-p">,</span> <span class="tok-n">col_ax</span> <span class="tok-o">=</span> <span class="tok-n">axes</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)</span>
    <span class="tok-n">basin_sizes</span> <span class="tok-o">=</span> <span class="tok-kt">Int</span><span class="tok-p">[]</span>
    <span class="tok-n">not_yet_visited</span> <span class="tok-o">=</span> <span class="tok-n">mat</span> <span class="tok-o">.!=</span> <span class="tok-mi">9</span>

    <span class="tok-n">visited</span> <span class="tok-o">=</span> <span class="tok-kt">Set</span><span class="tok-p">{</span><span class="tok-n">keytype</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)}()</span>
    <span class="tok-n">coords_stack</span> <span class="tok-o">=</span> <span class="tok-n">keytype</span><span class="tok-p">(</span><span class="tok-n">mat</span><span class="tok-p">)[]</span>
    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">first_coords</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(</span><span class="tok-n">not_yet_visited</span><span class="tok-p">))</span> <span class="tok-o">!==</span> <span class="tok-nb">nothing</span>
        <span class="tok-n">empty!</span><span class="tok-p">(</span><span class="tok-n">visited</span><span class="tok-p">)</span>

        <span class="tok-n">empty!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">)</span>
        <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">,</span> <span class="tok-n">first_coords</span><span class="tok-p">)</span>

        <span class="tok-k">while</span> <span class="tok-o">!</span><span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">)</span>
            <span class="tok-n">coords</span> <span class="tok-o">=</span> <span class="tok-n">pop!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">)</span>
            <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">visited</span><span class="tok-p">,</span> <span class="tok-n">coords</span><span class="tok-p">)</span>
            <span class="tok-n">not_yet_visited</span><span class="tok-p">[</span><span class="tok-n">coords</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span>

            <span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">coords</span><span class="tok-p">)</span>
            <span class="tok-n">neighbor_indices</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span>
                <span class="tok-kt">CartesianIndex</span><span class="tok-p">,</span> <span class="tok-p">((</span><span class="tok-n">r</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">))</span>
            <span class="tok-p">)</span>

            <span class="tok-k">for</span> <span class="tok-n">nghbr_idx</span> <span class="tok-kp">in</span> <span class="tok-n">neighbor_indices</span>
                <span class="tok-n">nghbr_idx</span> <span class="tok-o">∈</span> <span class="tok-n">visited</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">continue</span>

                <span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">nghbr_idx</span><span class="tok-p">)</span>
                <span class="tok-k">if</span> <span class="tok-n">nghbr_r</span> <span class="tok-o">∈</span> <span class="tok-n">row_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">nghbr_c</span> <span class="tok-o">∈</span> <span class="tok-n">col_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">mat</span><span class="tok-p">[</span><span class="tok-n">nghbr_r</span><span class="tok-p">,</span> <span class="tok-n">nghbr_c</span><span class="tok-p">]</span> <span class="tok-o">!=</span> <span class="tok-mi">9</span>
                    <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">coords_stack</span><span class="tok-p">,</span> <span class="tok-n">nghbr_idx</span><span class="tok-p">)</span>
                <span class="tok-k">end</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>

        <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">basin_sizes</span><span class="tok-p">,</span> <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">visited</span><span class="tok-p">))</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">basin_sizes</span>
<span class="tok-k">end</span>

<span class="tok-n">basin_sizes</span> <span class="tok-o">=</span> <span class="tok-n">sort</span><span class="tok-p">(</span><span class="tok-n">get_basin_sizes</span><span class="tok-p">(</span><span class="tok-n">heightmap</span><span class="tok-p">);</span> <span class="tok-n">rev</span><span class="tok-o">=</span><span class="tok-kc">true</span><span class="tok-p">)</span>
<span class="tok-nd">@show</span> <span class="tok-n">reduce</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-p">,</span> <span class="tok-n">basin_sizes</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">3</span><span class="tok-p">])</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_syntax_scoring"><a class="anchor" href="#_syntax_scoring"></a>10. Syntax Scoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/10" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 10 problem description</a> │ <a href="/src/day_10/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Pretty basic.
The only way to make this interesting was to try and make the code as DRY as possible and to embed as much information in Julia&#8217;s limited type system as possible.</p>
</div>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">)))</span>

<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-s">```jldoctest</span>
<span class="tok-s">julia&gt; braces</span>
<span class="tok-s">4×2 Matrix{Char}:</span>
<span class="tok-s"> &#39;(&#39;  &#39;)&#39;</span>
<span class="tok-s"> &#39;[&#39;  &#39;]&#39;</span>
<span class="tok-s"> &#39;{&#39;  &#39;}&#39;</span>
<span class="tok-s"> &#39;&lt;&#39;  &#39;&gt;&#39;</span>
<span class="tok-s">```</span>
<span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-kd">const</span> <span class="tok-n">braces</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-sc">&#39;(&#39;</span> <span class="tok-sc">&#39;)&#39;</span><span class="tok-p">;</span> <span class="tok-sc">&#39;[&#39;</span> <span class="tok-sc">&#39;]&#39;</span><span class="tok-p">;</span> <span class="tok-sc">&#39;{&#39;</span> <span class="tok-sc">&#39;}&#39;</span><span class="tok-p">;</span> <span class="tok-sc">&#39;&lt;&#39;</span> <span class="tok-sc">&#39;&gt;&#39;</span><span class="tok-p">]</span>

<span class="tok-kd">const</span> <span class="tok-n">bracetype_axis</span><span class="tok-p">,</span> <span class="tok-n">orientation_axis</span> <span class="tok-o">=</span> <span class="tok-n">axes</span><span class="tok-p">(</span><span class="tok-n">braces</span><span class="tok-p">)</span>

<span class="tok-k">struct</span> <span class="tok-n">BraceId</span>
    <span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span>
    <span class="tok-k">function</span> <span class="tok-n">BraceId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span><span class="tok-p">)</span>
        <span class="tok-n">id</span> <span class="tok-kp">in</span> <span class="tok-n">bracetype_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid brace: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>
<span class="tok-k">struct</span> <span class="tok-n">OrientationId</span>
    <span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span>
    <span class="tok-k">function</span> <span class="tok-n">OrientationId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-kt">Int</span><span class="tok-p">)</span>
        <span class="tok-n">id</span> <span class="tok-kp">in</span> <span class="tok-n">orientation_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid brace: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-n">flip</span><span class="tok-p">(</span><span class="tok-n">o</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">OrientationId</span><span class="tok-p">(</span><span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">orientation_axis</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-n">o</span><span class="tok-o">.</span><span class="tok-n">id</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">)</span>

<span class="tok-n">BraceKind</span><span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">}</span> <span class="tok-o">=</span> <span class="tok-nd">@NamedTuple</span> <span class="tok-p">{</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-n">BraceId</span><span class="tok-p">,</span> <span class="tok-n">elems</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-kt">Char</span><span class="tok-p">}}</span>
<span class="tok-n">Orientation</span><span class="tok-p">{</span><span class="tok-n">N</span><span class="tok-p">}</span> <span class="tok-o">=</span> <span class="tok-nd">@NamedTuple</span> <span class="tok-p">{</span><span class="tok-n">id</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span><span class="tok-p">,</span> <span class="tok-n">elems</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-kt">Char</span><span class="tok-p">}}</span>

<span class="tok-kd">const</span> <span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-n">angles</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span>
    <span class="tok-n">i</span> <span class="tok-o">-&gt;</span> <span class="tok-p">(;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-n">BraceId</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">),</span> <span class="tok-n">elems</span><span class="tok-o">=</span><span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">braces</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-p">]))</span><span class="tok-o">::</span><span class="tok-n">BraceKind</span><span class="tok-p">,</span> <span class="tok-n">bracetype_axis</span>
<span class="tok-p">)</span>

<span class="tok-kd">const</span> <span class="tok-n">lefts</span><span class="tok-p">,</span> <span class="tok-n">rights</span> <span class="tok-o">=</span> <span class="tok-n">map</span><span class="tok-p">(</span>
    <span class="tok-n">i</span> <span class="tok-o">-&gt;</span> <span class="tok-p">(;</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-n">OrientationId</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">),</span> <span class="tok-n">elems</span><span class="tok-o">=</span><span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">braces</span><span class="tok-p">[</span><span class="tok-o">:</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-p">]))</span><span class="tok-o">::</span><span class="tok-n">Orientation</span><span class="tok-p">,</span> <span class="tok-n">orientation_axis</span>
<span class="tok-p">)</span>

<span class="tok-k">struct</span> <span class="tok-n">Token</span>
    <span class="tok-n">brace</span><span class="tok-o">::</span><span class="tok-n">BraceId</span>
    <span class="tok-n">orientation</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span>

    <span class="tok-k">function</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-o">::</span><span class="tok-n">BraceId</span><span class="tok-p">,</span> <span class="tok-n">orientation</span><span class="tok-o">::</span><span class="tok-n">OrientationId</span><span class="tok-p">)</span>
        <span class="tok-n">brace</span><span class="tok-o">.</span><span class="tok-n">id</span> <span class="tok-o">∈</span> <span class="tok-n">bracetype_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid brace: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-n">orientation</span><span class="tok-o">.</span><span class="tok-n">id</span> <span class="tok-o">∈</span> <span class="tok-n">orientation_axis</span> <span class="tok-o">||</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;Invalid orientation: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">orientation</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-p">,</span> <span class="tok-n">orientation</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">get_container</span><span class="tok-p">(</span><span class="tok-n">elem</span><span class="tok-p">,</span> <span class="tok-n">sets</span><span class="tok-p">)</span>
    <span class="tok-n">maybe_superset</span> <span class="tok-o">=</span> <span class="tok-n">Iterators</span><span class="tok-o">.</span><span class="tok-n">peel</span><span class="tok-p">(</span><span class="tok-n">a</span> <span class="tok-k">for</span> <span class="tok-n">a</span> <span class="tok-kp">in</span> <span class="tok-n">sets</span> <span class="tok-k">if</span> <span class="tok-n">elem</span> <span class="tok-o">∈</span> <span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-n">elems</span><span class="tok-p">)</span>
    <span class="tok-n">maybe_superset</span> <span class="tok-o">===</span> <span class="tok-nb">nothing</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">error</span><span class="tok-p">(</span><span class="tok-s">&quot;invalid: </span><span class="tok-si">$</span><span class="tok-p">(</span><span class="tok-n">elem</span><span class="tok-p">)</span><span class="tok-s">&quot;</span><span class="tok-p">)</span>
    <span class="tok-n">superset</span><span class="tok-p">,</span> <span class="tok-n">_rest</span> <span class="tok-o">=</span> <span class="tok-n">maybe_superset</span>
    <span class="tok-k">return</span> <span class="tok-n">superset</span>
<span class="tok-k">end</span>
<span class="tok-k">function</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-o">::</span><span class="tok-kt">Char</span><span class="tok-p">)</span>
    <span class="tok-n">brace</span> <span class="tok-o">=</span> <span class="tok-n">get_container</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-n">angles</span><span class="tok-p">))</span><span class="tok-o">.</span><span class="tok-n">id</span>
    <span class="tok-n">orientation</span> <span class="tok-o">=</span> <span class="tok-n">get_container</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-n">lefts</span><span class="tok-p">,</span> <span class="tok-n">rights</span><span class="tok-p">))</span><span class="tok-o">.</span><span class="tok-n">id</span>

    <span class="tok-k">return</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">brace</span><span class="tok-p">,</span> <span class="tok-n">orientation</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">show</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-o">::</span><span class="tok-kt">IO</span><span class="tok-p">,</span> <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Base</span><span class="tok-o">.</span><span class="tok-n">show</span><span class="tok-p">(</span><span class="tok-n">io</span><span class="tok-p">,</span> <span class="tok-n">braces</span><span class="tok-p">[</span><span class="tok-n">token</span><span class="tok-o">.</span><span class="tok-n">orientation</span><span class="tok-p">,</span> <span class="tok-n">token</span><span class="tok-o">.</span><span class="tok-n">brace</span><span class="tok-p">])</span>

<span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-n">brace</span>
<span class="tok-n">orientation</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">t</span><span class="tok-o">.</span><span class="tok-n">orientation</span>
<span class="tok-n">flip</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">),</span> <span class="tok-n">flip</span><span class="tok-p">(</span><span class="tok-n">orientation</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)))</span>

<span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-o">::</span><span class="tok-n">BraceKind</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-n">id</span>
<span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-o">::</span><span class="tok-n">Token</span><span class="tok-p">,</span> <span class="tok-n">o</span><span class="tok-o">::</span><span class="tok-n">Orientation</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">orientation</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">o</span><span class="tok-o">.</span><span class="tok-n">id</span>

<span class="tok-k">struct</span> <span class="tok-n">Ok</span> <span class="tok-k">end</span>
<span class="tok-k">struct</span> <span class="tok-n">Corrupted</span>
    <span class="tok-n">token</span><span class="tok-o">::</span><span class="tok-n">Token</span>
<span class="tok-k">end</span>
<span class="tok-k">struct</span> <span class="tok-n">Incomplete</span>
    <span class="tok-n">tokens</span><span class="tok-o">::</span><span class="tok-kt">Vector</span><span class="tok-p">{</span><span class="tok-n">Token</span><span class="tok-p">}</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">parse_line</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-o">::</span><span class="tok-kt">AbstractString</span><span class="tok-p">)</span><span class="tok-o">::</span><span class="tok-kt">Union</span><span class="tok-p">{</span><span class="tok-n">Ok</span><span class="tok-p">,</span><span class="tok-n">Incomplete</span><span class="tok-p">,</span><span class="tok-n">Corrupted</span><span class="tok-p">}</span>
    <span class="tok-n">token_stack</span> <span class="tok-o">=</span> <span class="tok-n">Token</span><span class="tok-p">[]</span>

    <span class="tok-k">for</span> <span class="tok-n">c</span> <span class="tok-kp">in</span> <span class="tok-n">line</span>
        <span class="tok-n">t</span> <span class="tok-o">=</span> <span class="tok-n">Token</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">)</span>

        <span class="tok-k">if</span> <span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">)</span>
            <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">,</span> <span class="tok-n">t</span><span class="tok-p">)</span>
            <span class="tok-k">continue</span>
        <span class="tok-k">end</span>

        <span class="tok-n">prev</span> <span class="tok-o">=</span> <span class="tok-n">token_stack</span><span class="tok-p">[</span><span class="tok-k">end</span><span class="tok-p">]</span>

        <span class="tok-k">if</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">prev</span><span class="tok-p">,</span> <span class="tok-n">lefts</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span> <span class="tok-n">rights</span><span class="tok-p">)</span>
            <span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">prev</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">brace_kind</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span> <span class="tok-o">||</span> <span class="tok-k">return</span> <span class="tok-n">Corrupted</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">)</span>
            <span class="tok-n">pop!</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">)</span>
        <span class="tok-k">else</span>
            <span class="tok-n">push!</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">,</span> <span class="tok-n">t</span><span class="tok-p">)</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">return</span> <span class="tok-n">Ok</span><span class="tok-p">()</span>

    <span class="tok-n">remaining_tokens</span> <span class="tok-o">=</span> <span class="tok-n">flip</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">reverse</span><span class="tok-p">(</span><span class="tok-n">token_stack</span><span class="tok-p">))</span>
    <span class="tok-k">return</span> <span class="tok-n">Incomplete</span><span class="tok-p">(</span><span class="tok-n">remaining_tokens</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-n">results</span> <span class="tok-o">=</span> <span class="tok-n">parse_line</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">score</span><span class="tok-p">(</span><span class="tok-n">corr</span><span class="tok-o">::</span><span class="tok-n">Corrupted</span><span class="tok-p">)</span>
    <span class="tok-n">t</span> <span class="tok-o">=</span> <span class="tok-n">corr</span><span class="tok-o">.</span><span class="tok-n">token</span>
    <span class="tok-n">scores</span> <span class="tok-o">=</span> <span class="tok-p">(</span>
        <span class="tok-p">(</span><span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-mi">57</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-mi">1197</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">angles</span><span class="tok-p">,</span> <span class="tok-mi">25137</span><span class="tok-p">)</span>
    <span class="tok-p">)</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-kt">Tuple</span><span class="tok-p">{</span><span class="tok-n">BraceKind</span><span class="tok-p">,</span><span class="tok-kt">Int</span><span class="tok-p">}}</span>

    <span class="tok-n">idx</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(((</span><span class="tok-n">brace_type</span><span class="tok-p">,</span> <span class="tok-n">_</span><span class="tok-p">),)</span> <span class="tok-o">-&gt;</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span> <span class="tok-n">brace_type</span><span class="tok-p">),</span> <span class="tok-n">scores</span><span class="tok-p">)</span>
    <span class="tok-n">_</span><span class="tok-p">,</span> <span class="tok-n">score</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-p">[</span><span class="tok-n">idx</span><span class="tok-p">]</span>
    <span class="tok-k">return</span> <span class="tok-n">score</span>
<span class="tok-k">end</span>

<span class="tok-nd">@show</span> <span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-n">score</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-n">r</span> <span class="tok-kp">in</span> <span class="tok-n">results</span> <span class="tok-k">if</span> <span class="tok-n">r</span> <span class="tok-kp">isa</span> <span class="tok-n">Corrupted</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">score</span><span class="tok-p">(</span><span class="tok-n">inco</span><span class="tok-o">::</span><span class="tok-n">Incomplete</span><span class="tok-p">)</span>
    <span class="tok-n">scores</span> <span class="tok-o">=</span> <span class="tok-p">(</span>
        <span class="tok-p">(</span><span class="tok-n">parens</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">squares</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">curlys</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-n">angles</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
    <span class="tok-p">)</span><span class="tok-o">::</span><span class="tok-kt">NTuple</span><span class="tok-p">{</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-kt">Tuple</span><span class="tok-p">{</span><span class="tok-n">BraceKind</span><span class="tok-p">,</span><span class="tok-kt">Int</span><span class="tok-p">}}</span>

    <span class="tok-n">net_score</span> <span class="tok-o">=</span> <span class="tok-mi">0</span>
    <span class="tok-k">for</span> <span class="tok-n">t</span> <span class="tok-kp">in</span> <span class="tok-n">inco</span><span class="tok-o">.</span><span class="tok-n">tokens</span>
        <span class="tok-n">net_score</span> <span class="tok-o">*=</span> <span class="tok-mi">5</span>

        <span class="tok-n">idx</span> <span class="tok-o">=</span> <span class="tok-n">findfirst</span><span class="tok-p">(((</span><span class="tok-n">brace_type</span><span class="tok-p">,</span> <span class="tok-n">_</span><span class="tok-p">),)</span> <span class="tok-o">-&gt;</span> <span class="tok-n">matches</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span> <span class="tok-n">brace_type</span><span class="tok-p">),</span> <span class="tok-n">scores</span><span class="tok-p">)</span>
        <span class="tok-n">_</span><span class="tok-p">,</span> <span class="tok-n">score</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-p">[</span><span class="tok-n">idx</span><span class="tok-p">]</span>
        <span class="tok-n">net_score</span> <span class="tok-o">+=</span> <span class="tok-n">score</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">net_score</span>
<span class="tok-k">end</span>

<span class="tok-n">incomplete_scores</span> <span class="tok-o">=</span> <span class="tok-n">sort</span><span class="tok-p">(</span><span class="tok-n">score</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-n">filter</span><span class="tok-p">(</span><span class="tok-n">r</span> <span class="tok-o">-&gt;</span> <span class="tok-n">r</span> <span class="tok-kp">isa</span> <span class="tok-n">Incomplete</span><span class="tok-p">,</span> <span class="tok-n">results</span><span class="tok-p">)))</span>
<span class="tok-nd">@show</span> <span class="tok-n">incomplete_scores</span><span class="tok-p">[</span><span class="tok-n">div</span><span class="tok-p">(</span>
    <span class="tok-n">firstindex</span><span class="tok-p">(</span><span class="tok-n">incomplete_scores</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-n">lastindex</span><span class="tok-p">(</span><span class="tok-n">incomplete_scores</span><span class="tok-p">),</span> <span class="tok-mi">2</span>
<span class="tok-p">)]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dumbo_octopus"><a class="anchor" href="#_dumbo_octopus"></a>11. Dumbo Octopus</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/11" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 11 problem description</a> │ <a href="/src/day_11/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>These problems where you just have to manage the state of an array and update it correctly, and potentially query the state of the array, aren&#8217;t that interesting to me anymore.
There is no algorithmic interestingness to them.</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-n">octopi</span> <span class="tok-o">=</span> <span class="tok-k">let</span>
    <span class="tok-n">lines</span> <span class="tok-o">=</span> <span class="tok-n">eachline</span><span class="tok-p">(</span><span class="tok-n">joinpath</span><span class="tok-p">(</span><span class="tok-nd">@__DIR__</span><span class="tok-p">,</span> <span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span>
    <span class="tok-n">parsed_lines</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">parse</span><span class="tok-o">.</span><span class="tok-p">(</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">reshape</span><span class="tok-p">(</span><span class="tok-n">collect</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">),</span> <span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">:</span><span class="tok-p">)))</span> <span class="tok-k">for</span> <span class="tok-n">line</span> <span class="tok-kp">in</span> <span class="tok-n">lines</span><span class="tok-p">)</span>
    <span class="tok-n">vcat</span><span class="tok-p">(</span><span class="tok-n">parsed_lines</span><span class="tok-o">...</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-k">function</span> <span class="tok-n">tick_in_place</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-o">::</span><span class="tok-kt">AbstractArray</span><span class="tok-p">)</span>
    <span class="tok-n">octopi</span> <span class="tok-o">.+=</span> <span class="tok-mi">1</span>

    <span class="tok-n">row_ax</span><span class="tok-p">,</span> <span class="tok-n">col_ax</span> <span class="tok-o">=</span> <span class="tok-n">axes</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-p">)</span>
    <span class="tok-n">n_flashes</span> <span class="tok-o">=</span> <span class="tok-mi">0</span>

    <span class="tok-c"># We use equality with FLASH_THRESH to mean &quot;will flash right now&quot;, whereas being</span>
    <span class="tok-c"># greater than FLASH_THRESH means &quot;has already flashed (and won&#39;t flash again)&quot;</span>

    <span class="tok-n">FLASH_THRESH</span> <span class="tok-o">=</span> <span class="tok-mi">10</span>
    <span class="tok-k">while</span> <span class="tok-kc">true</span>
        <span class="tok-n">flashing_octopi_idxs</span> <span class="tok-o">=</span> <span class="tok-n">findall</span><span class="tok-p">(</span><span class="tok-n">octopi</span> <span class="tok-o">.==</span> <span class="tok-n">FLASH_THRESH</span><span class="tok-p">)</span>
        <span class="tok-n">isempty</span><span class="tok-p">(</span><span class="tok-n">flashing_octopi_idxs</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-k">break</span>

        <span class="tok-n">n_flashes</span> <span class="tok-o">+=</span> <span class="tok-n">length</span><span class="tok-p">(</span><span class="tok-n">flashing_octopi_idxs</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-n">idx</span> <span class="tok-kp">in</span> <span class="tok-n">flashing_octopi_idxs</span>
            <span class="tok-n">octopi</span><span class="tok-p">[</span><span class="tok-n">idx</span><span class="tok-p">]</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span>

            <span class="tok-n">flash_r</span><span class="tok-p">,</span> <span class="tok-n">flash_c</span> <span class="tok-o">=</span> <span class="tok-kt">Tuple</span><span class="tok-p">(</span><span class="tok-n">idx</span><span class="tok-p">)</span>
            <span class="tok-k">for</span> <span class="tok-n">dr</span> <span class="tok-kp">in</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">dc</span> <span class="tok-kp">in</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-mi">1</span>
                <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">flash_r</span> <span class="tok-o">+</span> <span class="tok-n">dr</span>
                <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">flash_c</span> <span class="tok-o">+</span> <span class="tok-n">dc</span>
                <span class="tok-n">r</span> <span class="tok-o">∈</span> <span class="tok-n">row_ax</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">∈</span> <span class="tok-n">col_ax</span> <span class="tok-o">||</span> <span class="tok-k">continue</span>

                <span class="tok-k">if</span> <span class="tok-n">octopi</span><span class="tok-p">[</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">]</span> <span class="tok-o">&lt;</span> <span class="tok-n">FLASH_THRESH</span>
                    <span class="tok-n">octopi</span><span class="tok-p">[</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">]</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span>
                <span class="tok-k">end</span>
            <span class="tok-k">end</span>
        <span class="tok-k">end</span>
    <span class="tok-k">end</span>

    <span class="tok-n">octopi</span><span class="tok-p">[</span><span class="tok-n">octopi</span> <span class="tok-o">.&gt;=</span> <span class="tok-n">FLASH_THRESH</span><span class="tok-p">]</span> <span class="tok-o">.=</span> <span class="tok-mi">0</span>

    <span class="tok-k">return</span> <span class="tok-n">n_flashes</span>
<span class="tok-k">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-o">::</span><span class="tok-kt">Int</span><span class="tok-p">,</span> <span class="tok-n">octopi</span><span class="tok-p">)</span>
    <span class="tok-n">octopi</span> <span class="tok-o">=</span> <span class="tok-n">copy</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-p">)</span>
    <span class="tok-n">n_flashes</span> <span class="tok-o">=</span> <span class="tok-mi">0</span>
    <span class="tok-k">for</span> <span class="tok-n">_</span> <span class="tok-kp">in</span> <span class="tok-mi">1</span><span class="tok-o">:</span><span class="tok-n">n</span>
        <span class="tok-n">n_flashes</span> <span class="tok-o">+=</span> <span class="tok-n">tick_in_place</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-p">)</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-n">n_flashes</span><span class="tok-p">,</span> <span class="tok-n">octopi</span><span class="tok-p">)</span>
<span class="tok-k">end</span>

<span class="tok-nd">@show</span> <span class="tok-n">tick</span><span class="tok-p">(</span><span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-n">octopi</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="julia"><span></span><span class="tok-k">function</span> <span class="tok-n">find_simultaneous_flash_tick</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-p">)</span>
    <span class="tok-n">octopi</span> <span class="tok-o">=</span> <span class="tok-n">copy</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-p">)</span>

    <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span>
    <span class="tok-k">while</span> <span class="tok-n">any</span><span class="tok-p">(</span><span class="tok-n">octopi</span> <span class="tok-o">.!=</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
        <span class="tok-n">tick_in_place</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-p">)</span>
        <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span>
    <span class="tok-k">end</span>

    <span class="tok-k">return</span> <span class="tok-n">i</span>
<span class="tok-k">end</span>

<span class="tok-nd">@show</span> <span class="tok-n">find_simultaneous_flash_tick</span><span class="tok-p">(</span><span class="tok-n">octopi</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_passage_pathing"><a class="anchor" href="#_passage_pathing"></a>12. Passage Pathing</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/12" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 12 problem description</a> | <a href="/src/day_12/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Finally, a problem that isn&#8217;t just about array manipulation.
This problem asks us to count the number of paths from the origin node of an undirected graph to the destination node, with constraints on how many times we may visit certain nodes, but no constraints on how many times we may use an edge.
(Note that the problem has us exploring an underwater cave system, so the source code below refers to nodes as “caves”.)
Nodes are classified as either “big” or “small”, depending on the case of their name in the input.
A big node can be visited arbitrarily many times, whereas a small node can only be visited a limited number of times.
(If two big nodes were adjacent, then there would be infinitely many paths through the graph since because we could just bounce back and forth between them forever.)</p>
</div>
<div class="paragraph">
<p>First, we must build the graph.
We ingest the list of edges into a dictionary mapping each node to the set of nodes reachable from it.
After doing this we traverse the graph.
We maintain a stack representing the current path; we push onto the stack from the choices in the current node&#8217;s entry in the dictionary, and when we&#8217;ve exhausted all of the edges available from the current node, we pop the current node.
We don&#8217;t actually maintain a stack in the code; we merely use the call stack.</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">collections</span>::<span class="tok-n">BTreeMap</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">CaveKind</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Big</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Small</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Cave</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">name</span>: <span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span> <span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">kind</span>: <span class="tok-nc">CaveKind</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Cave</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">new</span><span class="tok-p">(</span><span class="tok-n">name</span>: <span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span> <span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">is_small</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">().</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">c</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">.</span><span class="tok-n">is_ascii_lowercase</span><span class="tok-p">()).</span><span class="tok-n">all</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">b</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">kind</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">is_small</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">CaveKind</span>::<span class="tok-n">Small</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">CaveKind</span>::<span class="tok-n">Big</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">kind</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">CaveSystem</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">edges</span>: <span class="tok-nc">Map</span><span class="tok-o">&lt;&amp;&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Cave</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">CaveSystem</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span> <span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-bp">Self</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">edges</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">split</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-sc">&#39;-&#39;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">left</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">split</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">right</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">split</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">orig</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">dest</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-p">[(</span><span class="tok-n">left</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">right</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">right</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">left</span><span class="tok-p">)]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">orig</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-s">&quot;end&quot;</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">dest</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-s">&quot;start&quot;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">edges</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">orig</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">.</span><span class="tok-n">or_insert_with</span><span class="tok-p">(</span><span class="tok-nb">Vec</span>::<span class="tok-n">new</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Cave</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">dest</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">edges</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">CaveSystem</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">traverse_helper</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-o">&amp;&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">curr_cave</span>: <span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span> <span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">n_finished</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">cave_visit_counts</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-o">&lt;&amp;&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-kt">str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">can_visit_one_small_cave_twice</span>: <span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">has_visited_a_small_cave_twice</span>: <span class="tok-kt">bool</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">next_cave</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">edges</span><span class="tok-p">[</span><span class="tok-n">curr_cave</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">next_cave</span><span class="tok-p">.</span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-s">&quot;end&quot;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-o">*</span><span class="tok-n">n_finished</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">this_dest_n_visits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">cave_visit_counts</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">next_cave</span><span class="tok-p">.</span><span class="tok-n">name</span><span class="tok-p">).</span><span class="tok-n">or_insert</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">is_small_cave</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">matches!</span><span class="tok-p">(</span><span class="tok-n">next_cave</span><span class="tok-p">.</span><span class="tok-n">kind</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">CaveKind</span>::<span class="tok-n">Small</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">is_small_cave</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">this_dest_n_visits</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">can_visit_one_small_cave_twice</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">has_visited_a_small_cave_twice</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-o">*</span><span class="tok-n">this_dest_n_visits</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_visits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">this_dest_n_visits</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">traverse_helper</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">next_cave</span><span class="tok-p">.</span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">n_finished</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">cave_visit_counts</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">can_visit_one_small_cave_twice</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">has_visited_a_small_cave_twice</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">is_small_cave</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">n_visits</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-n">cave_visit_counts</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">next_cave</span><span class="tok-p">.</span><span class="tok-n">name</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">.</span><span class="tok-n">and_modify</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">v</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">traverse</span><span class="tok-p">(</span><span class="tok-o">&amp;&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">can_visit_one_small_cave_twice</span>: <span class="tok-kt">bool</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">n_finished</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">cave_visit_counts</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">traverse_helper</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;start&quot;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">n_finished</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">cave_visit_counts</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">can_visit_one_small_cave_twice</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kc">false</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">n_finished</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_cave</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">CaveSystem</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">cave</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CaveSystem</span>::<span class="tok-n">from_input</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">cave</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">cave</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">get_cave</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">12</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">cave</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">cave</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>In Part 1, we may only visit each small node at most once.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">cave</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">CaveSystem</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">cave</span><span class="tok-p">.</span><span class="tok-n">traverse</span><span class="tok-p">(</span><span class="tok-kc">false</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 is slightly more relaxed; in addition to the paths visiting each small node at most once, valid paths now include those in which a single small node is visited a second time.
But this wrinkle was already handled in the Setup section; we switch the behavior with a single boolean argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">cave</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">CaveSystem</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">cave</span><span class="tok-p">.</span><span class="tok-n">traverse</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transparent_origami"><a class="anchor" href="#_transparent_origami"></a>13. Transparent Origami</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/13" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 13 problem description</a> │ <a href="/src/day_13/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This problem asks us track how dots on a transparent piece of paper migrate as that piece of paper is folded across vertical and horizontal lines.
Throughout, the upper left corner of the page remains fixed in place; folds move the bottom right corner either up or to the left.
It is a precondition that no dot will lie <em>on</em> a fold.</p>
</div>
<div class="paragraph">
<p>When the page is reflected over the vertical line \(x=a\), one of two things will happen to the dot \( (x,y)\):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If \( (x,y)\) is left of \(x=a\) (i.e., \(x&lt;a\)), it remains in place.</p>
</li>
<li>
<p>Otherwise, the dot will end up as far to the left of \(x=a\) as it was to the right of \(x=a\) before the fold; this distance is simply \(x-a\), and so it ends up with an \(x\)-coordinate of \(a-(x-a)\), and a final position of \( (a-(x-a), y)\).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For a fold over the horizontal line \(y=b\), simply exchange \(x\) with \(y\) and \(a\) with \(b\).</p>
</div>
<div class="paragraph">
<div class="title">Setup</div>
<p>The input comes in as a list of dots <code>x,y</code> followed by a list of folds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-p">{</span><span class="tok-n">CheckedAdd</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">collections</span>::<span class="tok-n">BTreeSet</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Set</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-n">Display</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-kt">str</span>::<span class="tok-n">FromStr</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Copy, Clone)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">X</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Y</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">FromStr</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_str</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-bp">Self</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">words</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">split_whitespace</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">words</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">words</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">fold_eqn</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">words</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">eqn_sides</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">fold_eqn</span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-sc">&#39;=&#39;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">var</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">eqn_sides</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">eqn_sides</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">var</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;x&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-bp">Self</span>::<span class="tok-n">X</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-s">&quot;y&quot;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-bp">Self</span>::<span class="tok-n">Y</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Copy, Clone, Debug, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">T</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">folded</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">across</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">across</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Fold</span>::<span class="tok-n">X</span><span class="tok-p">(</span><span class="tok-n">fold_x</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_x</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">fold_x</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">fold_x</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">fold_x</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">new_x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Fold</span>::<span class="tok-n">Y</span><span class="tok-p">(</span><span class="tok-n">fold_y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_y</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">fold_y</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">fold_y</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">fold_y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">new_y</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Clone, Debug)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">dots</span>: <span class="tok-nc">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_dots</span><span class="tok-o">&lt;</span><span class="tok-n">I</span>: <span class="tok-nb">IntoIterator</span><span class="tok-o">&lt;</span><span class="tok-n">Item</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Point</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">dots</span>: <span class="tok-nc">I</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">dots</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">dots</span><span class="tok-p">.</span><span class="tok-n">into_iter</span><span class="tok-p">().</span><span class="tok-n">collect</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">dots</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">folded_across</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fold</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">dots</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Set</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">dots</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">dots</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">folded</span><span class="tok-p">(</span><span class="tok-n">fold</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">Paper</span>::<span class="tok-n">from_dots</span><span class="tok-p">(</span><span class="tok-n">dots</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">do_folds</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">folds</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">paper</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">fold</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">folds</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">paper</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">paper</span><span class="tok-p">.</span><span class="tok-n">folded_across</span><span class="tok-p">(</span><span class="tok-n">fold</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">paper</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">FromStr</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-n">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">points</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">by_ref</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">take_while</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-o">!</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">().</span><span class="tok-n">is_empty</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">comps</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-sc">&#39;,&#39;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">comps</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">comps</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">parse</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">paper</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Paper</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span>::<span class="tok-n">from_dots</span><span class="tok-p">(</span><span class="tok-n">points</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">folds</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">Fold</span>::<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span>::<span class="tok-n">from_str</span><span class="tok-p">).</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;&gt;</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">((</span><span class="tok-n">paper</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">folds</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">paper</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">folds</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">read_input</span>::<span class="tok-o">&lt;</span><span class="tok-kt">i32</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">13</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">paper</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">folds</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">paper</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">folds</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">String</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 has us perform a single fold. (Just one? No fun!)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">paper</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fold</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">paper</span><span class="tok-p">.</span><span class="tok-n">folded_across</span><span class="tok-p">(</span><span class="tok-n">fold</span><span class="tok-p">).</span><span class="tok-n">dots</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 has us perform all of the folds, and then <em>read the resulting arrangement of dots as a password containing eight capital capital letters</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CheckedAdd</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Clone</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">Display</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">fmt</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">f</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-n">Formatter</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">std</span>::<span class="tok-n">fmt</span>::<span class="tok-nb">Result</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">max_x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">max_y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">max_x</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">zero</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">max_y</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">zero</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">dots</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">max_x</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">max_x</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">max_y</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">max_y</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">(</span><span class="tok-n">max_x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">max_y</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">range_step_inclusive</span><span class="tok-p">(</span><span class="tok-n">num</span>::<span class="tok-n">zero</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">max_y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">one</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">range_step_inclusive</span><span class="tok-p">(</span><span class="tok-n">num</span>::<span class="tok-n">zero</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">max_x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">num</span>::<span class="tok-n">one</span><span class="tok-p">())</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">f</span><span class="tok-p">.</span><span class="tok-n">write_str</span><span class="tok-p">(</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">dots</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-s">&quot;█&quot;</span><span class="tok-w"> </span><span class="tok-c1">// unicode &quot;full block&quot; 0x2588</span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-s">&quot; &quot;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">})</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">f</span><span class="tok-p">.</span><span class="tok-n">write_str</span><span class="tok-p">(</span><span class="tok-s">&quot;</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Ok</span><span class="tok-p">(())</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nc">Integer</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">CheckedAdd</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Clone</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">paper</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Paper</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">folds</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">Fold</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">String</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">paper</span><span class="tok-p">.</span><span class="tok-n">do_folds</span><span class="tok-p">(</span><span class="tok-n">folds</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-fm">println!</span><span class="tok-p">(</span><span class="tok-s">&quot;{}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans</span><span class="tok-p">.</span><span class="tok-n">to_string</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For once, the input is actually interesting!
It&#8217;s not enough to just “get the answer” (say, the positions of the dots at the end of the folding procedure); we have to print them out too so that we can read them.
Here was my output: <code>PGHZBFJC</code>.</p>
</div>
<div class="listingblock code-as-text">
<div class="content">
<pre class="pygments highlight"><code data-lang="text"><span></span>███   ██  █  █ ████ ███  ████   ██  ██
█  █ █  █ █  █    █ █  █ █       █ █  █
█  █ █    ████   █  ███  ███     █ █
███  █ ██ █  █  █   █  █ █       █ █
█    █  █ █  █ █    █  █ █    █  █ █  █
█     ███ █  █ ████ ███  █     ██   ██</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extended_polymerization"><a class="anchor" href="#_extended_polymerization"></a>14. Extended Polymerization</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/14" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 14 problem description</a> │ <a href="/src/day_14/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This problem asks us to perform a sequence of transformations to a starting string and then compute the counts of characters in the resulting string.
Specifically, we are given a map from pairs of characters to single characters.
Each generation, each pair of characters in the original string is to have its entry in this map (if it exists) inserted between the two characters.
This runs on a specified starting string for a specified number of generations, producing a final string.</p>
</div>
<div class="paragraph">
<p>My initial attempt involved actually building the string at each stage.
Unfortunately, because the string approximately doubles in length in each step, it&#8217;s computationally infeasible to generate the string the requested 40 generations out, nor would we be able to store it in memory (2<sup>40</sup> is around one trillion).</p>
</div>
<div class="paragraph">
<p>The right way to do this problem is to maintain a tally of counts of each pair <code>(c1, c2)</code> of characters in the string.
Each generation, we run through the pairs, and if the mapping contains a character <code>c3</code> to insert, then we remove key <code>(c1, c2)</code> and assign its tally to keys <code>(c1, c3)</code> and <code>(c3, c2)</code>.
This doesn&#8217;t tell us what the resulting string is, but thankfully the problem doesn&#8217;t ask us about the string per se; it only asks for character counts within the string.</p>
</div>
<div class="paragraph">
<p>To count the number of times a character <code>c</code> appears in the string, we simply note that it is counted twice, once for each pair it is the first character of and once for each pair it is the second character of.
So we just add up the number of times we see it in a pair and then divide by 2, right?
Wrong!
The first (respectively, last) character of the string is actually only counted once because it is only the first (respectively, second) character of <em>one</em> pair of characters, not two.
The way we model this is maintain a tally not just of character counts, but of the positions of those characters.
Our tally now assigns counts to triples <code>(c1, c2, pos0)</code> where <code>pos0</code> is one of “start”, “middle”, and “end”.
When we insert <code>c3</code> between <code>c1</code> and <code>c2</code>, we obtain <code>(c1, c3, pos1)</code> and <code>(c3, c2, pos2)</code>, where:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>pos1</code> is either “start” or “middle”; it is “start” if and only if <code>pos0</code> was “start”, and</p>
</li>
<li>
<p><code>pos2</code> is either “end” or “middle”; it is “end” if and only if <code>pos0</code> was “end”.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, only the characters occurring in the “middle” are double-counted, so the number of times a character appears in the final string is the number of times it occurred in a character pair in the “start” or “end” positions, plus half the number of times it occurred in a “middle” character pair.
To make the counting easier when working with integers and floored division, we double the “start” and “end” character counts, add them to the “middle” character counts, and then halve everything at the end.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>As you might have guessed, my first attempt at this problem did not keep track of pairs’ positions and so was plagued by an off-by-one error which only arose for specific inputs.
(I believe it had to do with whether the final string started and ended with the same character, but I didn&#8217;t bother generating test cases to check this.)
My first submission was too large, so I subtracted 1 from it and re-submitted and got it correct.
This was the first problem of this year&#8217;s Advent of Code that I thought it was feasible for someone to arrive at the right answer with buggy code and some guesswork.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">collections</span>::<span class="tok-n">BTreeMap</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Copy, Clone, Debug, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">Position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Start</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Middle</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">End</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Polymer</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">template</span>: <span class="tok-nb">String</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">mapping</span>: <span class="tok-nc">Map</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">char</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">char</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-kt">char</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Polymer</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_str</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-bp">Self</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">template</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">to_owned</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">mapping</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">splat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-s">&quot; -&gt; &quot;</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">outer_chars</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">splat</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">left</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">outer_chars</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">right</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">outer_chars</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">inner</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">splat</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">().</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">mapping</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">((</span><span class="tok-n">left</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">right</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">inner</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">Polymer</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">template</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">mapping</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">get_initial_char_pair_counts</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Map</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">char</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">char</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Position</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Position</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-c1">// Iterate over adjacent pairs of chars. The last index iterated is `n_pairs - 1`</span>
<span class="tok-w">		</span><span class="tok-c1">// with `n_pairs == self.template.len() - 1`</span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">c1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">template</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">zip</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">template</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">().</span><span class="tok-n">skip</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">Start</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">template</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">End</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">Middle</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-o">*</span><span class="tok-n">ans</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">((</span><span class="tok-n">c1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-p">)).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">ans</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">apply_n_times</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Map</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-kt">char</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">char</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Position</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Position</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">pair_counts</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">get_initial_char_pair_counts</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">pair_counts_vec</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">pair_counts</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">.</span><span class="tok-n">filter_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">k</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">v</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">((</span><span class="tok-n">k</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">pair_counts_vec</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">c1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">c</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">mapping</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-p">(</span><span class="tok-n">c1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c2</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">first_pos</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">Start</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Start</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Middle</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">second_pos</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">End</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">End</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Middle</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-o">*</span><span class="tok-n">pair_counts</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">((</span><span class="tok-n">c1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">first_pos</span><span class="tok-p">)).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-o">*</span><span class="tok-n">pair_counts</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">((</span><span class="tok-n">c</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">second_pos</span><span class="tok-p">)).</span><span class="tok-n">or_default</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-o">*</span><span class="tok-n">pair_counts</span><span class="tok-p">.</span><span class="tok-n">get_mut</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">key</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">pair_counts</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_ans</span><span class="tok-p">(</span><span class="tok-n">polymer</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Polymer</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Position</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">char_pair_counts</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">polymer</span><span class="tok-p">.</span><span class="tok-n">apply_n_times</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">char_counts</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">char_counts_2x</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Map</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">((</span><span class="tok-n">c1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">char_pair_counts</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">c1_multiplier</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">Start</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">c2_multiplier</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">End</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">mult</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-p">[(</span><span class="tok-n">c1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c1_multiplier</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">c2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c2_multiplier</span><span class="tok-p">)]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-o">*</span><span class="tok-n">char_counts_2x</span><span class="tok-p">.</span><span class="tok-n">entry</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">).</span><span class="tok-n">or_insert</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">mult</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">char_counts_2x</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">into_iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">max_count</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">min_count</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">usize</span>::<span class="tok-n">MAX</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">count</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">char_counts</span><span class="tok-p">.</span><span class="tok-n">values</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">min_count</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">min_count</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">max_count</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">max_count</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">count</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">max_count</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">min_count</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">polymer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Polymer</span>::<span class="tok-n">from_str</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">14</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">polymer</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">polymer</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">polymer</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Polymer</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-n">polymer</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">polymer</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Polymer</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">get_ans</span><span class="tok-p">(</span><span class="tok-n">polymer</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">40</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chiton"><a class="anchor" href="#_chiton"></a>15. Chiton</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/15" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 15 problem description</a> │ <a href="/src/day_15/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Given a grid of numbers, this problem asks us to find the path from the grid&#8217;s top left corner to its bottom right corner that minimizes the sum of all numbers used in the path, which we will call the path&#8217;s <em>cost</em>.
This is a classic CS problem which can be solved with the <a href="https://en.wikipedia.org/wiki/A*_search_algorithm" target="_blank" rel="noopener">A* Algorithm</a>.
My initial solution used a (max-) <a href="https://docs.rs/priority-queue/latest/priority_queue/" target="_blank" rel="noopener">priority queue</a> to choose the next node to examine, with priority equal to the (negative of the) total cost of the path up to that node.
While this solution worked, it took an inordinate amount of time on the larger input, which was 500×500.
(I suspect that this was due to the fact that the implementation of that priority queue uses a <a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html" target="_blank" rel="noopener"><code>HashMap</code></a> instead of a (perhaps) more optimal structure such as a <a href="https://doc.rust-lang.org/std/collections/struct.BTreeMap.html" target="_blank" rel="noopener"><code>BTreeMap</code></a>.
I also didn&#8217;t really feel like seeing if I could speed it up with a faster hasher.
And I definitely didn&#8217;t want to implement my own priority queue with a <code>BTreeMap</code> instead.)</p>
</div>
<div class="paragraph">
<p>Despite being theoretically suboptimal, my second solution performed much faster — fast enough that its output appeared to print instantaneously. (Profiling revealed it took around half a second.)
This new solution was simply to maintain a grid of tentative costs to reach each number on the grid.
This grid of tentative costs was initially set to <code>u32::MAX</code>, except for the top left corner which was set to <code>0</code>.
On each iteration, for each node \(P\) in the grid, we examine \(P\)’s four neighbors.
If the cost to reach a neighbor through \(P\) is cheaper than the neighbor&#8217;s current tentative cost, we replace the latter cost with the former cost.
We repeat this process until no modifications are made to any tentative cost, at which point the answer is simply the cost of reaching the bottom right corner.</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">prelude</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">type</span> <span class="tok-nc">Cost</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">type</span> <span class="tok-nc">Grid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Array2</span><span class="tok-o">&lt;</span><span class="tok-n">Cost</span><span class="tok-o">&gt;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">type</span> <span class="tok-nc">Coords</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Grid</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">first_line</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">first_line</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">.</span><span class="tok-n">to_digit</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Cost</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">.</span><span class="tok-n">to_digit</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-n">Cost</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-fm">assert_eq!</span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">());</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">Array2</span>::<span class="tok-n">from_shape_vec</span><span class="tok-p">((</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-p">).</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">enum</span> <span class="tok-nc">Direction</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">N</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">S</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">E</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">W</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Direction</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">stepping_from</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">grid</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Grid</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">from_row</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">from_col</span><span class="tok-p">)</span>: <span class="tok-nc">Coords</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Coords</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Direction</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">min_row</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">min_col</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">max_row</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">max_col</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_row</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">N</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">from_row</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">min_row</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">N</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">from_row</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">S</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">from_row</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">max_row</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">S</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">from_row</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">from_row</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_col</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">W</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">from_col</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">min_col</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">W</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">from_col</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">E</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">from_col</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">max_col</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">E</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">from_col</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">from_col</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">((</span><span class="tok-n">new_row</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">new_col</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">traversal_cost</span><span class="tok-p">(</span><span class="tok-n">entry_costs</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Grid</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Cost</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Direction</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">entry_costs</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">max_row</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">max_col</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">net_travel_costs</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Grid</span>::<span class="tok-n">from_shape_simple_fn</span><span class="tok-p">((</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">Cost</span>::<span class="tok-n">MAX</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">net_travel_costs</span><span class="tok-p">[(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">max_dist</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">max_row</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">max_col</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">loop</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">did_modify</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..=</span><span class="tok-n">max_dist</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">r_min</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">max_col</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">max_col</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">r_max</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-p">.</span><span class="tok-n">min</span><span class="tok-p">(</span><span class="tok-n">max_row</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">r_min</span><span class="tok-o">..=</span><span class="tok-n">r_max</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">dist</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">net_cost_to_travel_here</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">net_travel_costs</span><span class="tok-p">[(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">)];</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-c1">// One of the perks of moving diagonally, down and to the right, is that</span>
<span class="tok-w">				</span><span class="tok-c1">// this assertion holds (which means the following (necessary) loop isn&#39;t</span>
<span class="tok-w">				</span><span class="tok-c1">// pointless)</span>
<span class="tok-w">				</span><span class="tok-fm">assert_ne!</span><span class="tok-p">(</span><span class="tok-n">net_cost_to_travel_here</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Cost</span>::<span class="tok-n">MAX</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">N</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">S</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">E</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">W</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">nghbr_coords</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">dir</span><span class="tok-p">.</span><span class="tok-n">stepping_from</span><span class="tok-p">(</span><span class="tok-n">entry_costs</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">nghbr_coords</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">nghbr_coords</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">continue</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">net_cost_to_travel_to_nghbr_thru_here</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">net_cost_to_travel_here</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">entry_costs</span><span class="tok-p">[</span><span class="tok-n">nghbr_coords</span><span class="tok-p">];</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">net_cost_to_travel_to_nghbr_thru_here</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">net_travel_costs</span><span class="tok-p">[</span><span class="tok-n">nghbr_coords</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">net_travel_costs</span><span class="tok-p">[</span><span class="tok-n">nghbr_coords</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">net_cost_to_travel_to_nghbr_thru_here</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">did_modify</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">!</span><span class="tok-n">did_modify</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">net_travel_costs</span><span class="tok-p">[(</span><span class="tok-n">max_row</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">max_col</span><span class="tok-p">)];</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">Cost</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Cost</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">15</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">grid</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">grid</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-n">Cost</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Cost</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="title">Part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">grid</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Grid</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Cost</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">traversal_cost</span><span class="tok-p">(</span><span class="tok-n">grid</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 asked us not just to traverse the grid, but to construct a larger grid to use as our input, which was formed by concatenating modified copies of Part 1&#8217;s input.
This falls under “boring array manipulation”, so I won&#8217;t discuss it further.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">expand_grid</span><span class="tok-p">(</span><span class="tok-n">grid</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Grid</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">k</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Grid</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">new_grid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Array2</span>::<span class="tok-n">from_shape_simple_fn</span><span class="tok-p">((</span><span class="tok-n">k</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">k</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-c1">// Arrays are in row major order, so that&#39;s the order we iterate in (for cache-friendliness)</span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">outer_r</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">k</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">inner_r</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">outer_c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">k</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">inner_c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">old_cost</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-p">[(</span><span class="tok-n">inner_r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">inner_c</span><span class="tok-p">)];</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">d_cost</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Cost</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">outer_r</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">outer_c</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_cost</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">old_cost</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">d_cost</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-mi">9</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_grid_r</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">outer_r</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">inner_r</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_grid_c</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">outer_c</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">inner_c</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-n">new_grid</span><span class="tok-p">[(</span><span class="tok-n">new_grid_r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">new_grid_c</span><span class="tok-p">)]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">new_cost</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">new_grid</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">grid</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Grid</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Cost</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">grid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">expand_grid</span><span class="tok-p">(</span><span class="tok-n">grid</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">5</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">traversal_cost</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">grid</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_packet_decoder"><a class="anchor" href="#_packet_decoder"></a>16. Packet Decoder</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/16" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 16 problem description</a> │ <a href="/src/day_16/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Dear lord, this problem was brutal.
It consisted of roughly three parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Parse a hex string into a binary string by parsing each hex character into a quartet — trivial</p>
</li>
<li>
<p>(Part 1) Parse this binary string into a tree of packets according to rules set out in the problem statement — “easy” in the sense that I wrote up an <em>almost</em> correct solution in no time at all.
Very very hard in the sense that it required precise bookkeeping and it took forever for me to get it all exactly correct.
But from a theoretical standpoint it wasn&#8217;t really that hard.</p>
</li>
<li>
<p>(Part 2) Evaluate the packet tree as an expression tree (more or less like parsing S-expressions) — easy</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>The main function here is <code>Binary::as_packets</code>.
There&#8217;s a lot to unpack here, but roughly the algorithm is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Maintain a cursor into the original data</p>
</li>
<li>
<p>Maintain a stack of parse states, which consist of:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The depth in the parse tree</p>
</li>
<li>
<p>The length of remaining data for this packet.
Packets tell inform us how much data they expect; when there isn&#8217;t any left, we head back up a level in the tree.
So we have to track how much of their data we&#8217;ve consumed so far.
This “amount of data” quantity comes in two flavors:</p>
<div class="openblock">
<div class="content">
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Number of bits that the children comprise</p>
</li>
<li>
<p>Number of direct children (i.e., number of child packets)</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>One tricky bit is that packets share bits-remaining with their children.
In other words, if a child consumes some bits from the input, so have all of its ancestors that count their data in bits.
(Packets that are expecting a fixed number of child packets are unaffected when their descendants consume data.)
In either case, if this packet has no more data remaining — 0 bits or 0 child packets — continue on to the next parse state on the stack.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Looking at the data beginning at the cursor, parse the stream into a packet.</p>
</li>
<li>
<p>Advance the cursor the number of bits this packet consumed.</p>
</li>
<li>
<p>If this packet was an operator, increment the depth, as its children will follow.</p>
</li>
<li>
<p>Push a new parse state onto the stack, containing the incremented depth and the length of remaining data for this packet.</p>
</li>
</ol>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-p">{</span><span class="tok-n">utils</span>::<span class="tok-n">to_decimal</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-p">{</span><span class="tok-n">Display</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Write</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-k">type</span> <span class="tok-nc">Number</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i64</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">struct</span> <span class="tok-nc">Binary</span><span class="tok-p">(</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Binary</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_hex</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-bp">Self</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">binary</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Vec</span>::<span class="tok-n">with_capacity</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-mi">4</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">().</span><span class="tok-n">chars</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">.</span><span class="tok-n">to_digit</span><span class="tok-p">(</span><span class="tok-mi">16</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">digits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-k">usize</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">place</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">((</span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-n">place</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">binary</span><span class="tok-p">.</span><span class="tok-n">extend_from_slice</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">digits</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-bp">Self</span><span class="tok-p">(</span><span class="tok-n">binary</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Display</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Binary</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">fmt</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">f</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">mut</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-n">Formatter</span><span class="tok-o">&lt;&#39;</span><span class="tok-nb">_</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">std</span>::<span class="tok-n">fmt</span>::<span class="tok-nb">Result</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">digit</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">digit</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-sc">&#39;1&#39;</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-sc">&#39;0&#39;</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">f</span><span class="tok-p">.</span><span class="tok-n">write_char</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">Ok</span><span class="tok-p">(())</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Binary</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">as_packets</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Packet</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">enum</span> <span class="tok-nc">RemainingData</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NPackets</span><span class="tok-p">(</span><span class="tok-kt">usize</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">fn</span> <span class="tok-nf">is_empty</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">bool</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-fm">matches!</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NPackets</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">struct</span> <span class="tok-nc">ParseState</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">depth</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">remaining</span>: <span class="tok-nc">RemainingData</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">packets</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">orig_data</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">header_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">6</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">cursor</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">stack</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[</span><span class="tok-n">ParseState</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">depth</span>: <span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">remaining</span>: <span class="tok-nc">RemainingData</span>::<span class="tok-n">NPackets</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}];</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">while</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">parse_state</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">stack</span><span class="tok-p">.</span><span class="tok-n">pop</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ParseState</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">remaining</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parse_state</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">remaining</span><span class="tok-p">.</span><span class="tok-n">is_empty</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">packet_bits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">orig_data</span><span class="tok-p">[</span><span class="tok-n">cursor</span><span class="tok-o">..</span><span class="tok-p">];</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">version_number</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">packet_bits</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-p">]);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">kind_number</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">packet_bits</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-o">..</span><span class="tok-mi">6</span><span class="tok-p">]);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">data_bits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">packet_bits</span><span class="tok-p">[</span><span class="tok-n">header_length</span><span class="tok-o">..</span><span class="tok-p">];</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">parent_packet_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">remaining</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">RemainingData</span>::<span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">RemainingData</span>::<span class="tok-n">NPackets</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NPackets</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">ParseState</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">remaining</span>: <span class="tok-nc">parent_packet_length</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">});</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">packet</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_bits_consumed</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">kind_number</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-mi">4</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">chunk_size</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">5</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">bin_bits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">n_chunks</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">chunk</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">data_bits</span><span class="tok-p">.</span><span class="tok-n">chunks_exact</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-k">usize</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">n_chunks</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">bin_bits</span><span class="tok-p">.</span><span class="tok-n">extend_from_slice</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">chunk</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-p">]);</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">!</span><span class="tok-n">chunk</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-k">break</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i64</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-n">bin_bits</span><span class="tok-p">));</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-n">n_bits_consumed</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">header_length</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">n_chunks</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">chunk_size</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">packet</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Packet</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">version_number</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">kind</span>: <span class="tok-nc">PacketKind</span>::<span class="tok-n">Literal</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-p">},</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">op</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">op_data_length</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_bits_for_length</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">length_type</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">data_bits</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">length_type</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-c1">// length in packets</span>
<span class="tok-w">						</span><span class="tok-n">n_bits_for_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">12</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_packets</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">data_bits</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-n">n_bits_for_length</span><span class="tok-p">])</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">op_data_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NPackets</span><span class="tok-p">(</span><span class="tok-n">n_packets</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-c1">// length in bits</span>
<span class="tok-w">						</span><span class="tok-n">n_bits_for_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">16</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_bits</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">data_bits</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-o">..</span><span class="tok-n">n_bits_for_length</span><span class="tok-p">])</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">op_data_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-n">n_bits</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-n">n_bits_consumed</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">header_length</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">n_bits_for_length</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-c1">// A hack; we&#39;re going to subtract n_bits_consumed from this later</span>
<span class="tok-w">					</span><span class="tok-c1">// despite the fact that in theory we shouldn&#39;t (because the newly added</span>
<span class="tok-w">					</span><span class="tok-c1">// packet hasn&#39;t consumed any data yet), so we we pre-add n_bits_consumed</span>
<span class="tok-w">					</span><span class="tok-c1">// here so that when we subtract it later we end up with the right number</span>
<span class="tok-w">					</span><span class="tok-c1">// of bits</span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">op_data_length</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">op_data_length</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">RemainingData</span>::<span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">n_bits_consumed</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">rd</span><span class="tok-w"> </span><span class="tok-o">@</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NPackets</span><span class="tok-p">(</span><span class="tok-n">_</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">rd</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-n">packet</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Packet</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">version_number</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">kind</span>: <span class="tok-nc">PacketKind</span>::<span class="tok-n">Operator</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">op</span>: <span class="tok-nc">op</span><span class="tok-p">.</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">},</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-n">stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">ParseState</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">depth</span>: <span class="tok-nc">depth</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">remaining</span>: <span class="tok-nc">op_data_length</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">});</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-n">cursor</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">n_bits_consumed</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">ps</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">stack</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">RemainingData</span>::<span class="tok-n">NBits</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">ps</span><span class="tok-p">.</span><span class="tok-n">remaining</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-c1">// The hack above is to counteract this subtraction; if we just pushed</span>
<span class="tok-w">						</span><span class="tok-c1">// a RemainingData::NumBits, we won&#39;t actually have consumed any of</span>
<span class="tok-w">						</span><span class="tok-c1">// its input yet</span>
<span class="tok-w">						</span><span class="tok-c1">//</span>
<span class="tok-w">						</span><span class="tok-c1">// If our code has no bugs, and the input is trustworthy, this will</span>
<span class="tok-w">						</span><span class="tok-c1">// never underflow.</span>
<span class="tok-w">						</span><span class="tok-o">*</span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-n">n_bits_consumed</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-n">packets</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">packet</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">packets</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">PacketKind</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Literal</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">value</span>: <span class="tok-nc">Number</span><span class="tok-w"> </span><span class="tok-p">},</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Operator</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">op</span>: <span class="tok-nc">Operation</span><span class="tok-w"> </span><span class="tok-p">},</span><span class="tok-w"> </span><span class="tok-c1">// Defined in pt2</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Packet</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">version_number</span>: <span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">kind</span>: <span class="tok-nc">PacketKind</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">depth</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Packet</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Binary</span>::<span class="tok-n">from_hex</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">b</span><span class="tok-p">.</span><span class="tok-n">as_packets</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Number</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">16</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">p</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">p</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">())).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Number</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 just asks us to compute some summary data of all the packets in the parse tree.
As long as we have the right packets (regardless of their depths) we&#8217;ll get the right answer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">packets</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">Packet</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">packets</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">packet</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">packet</span><span class="tok-p">.</span><span class="tok-n">version_number</span><span class="tok-p">).</span><span class="tok-n">sum</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 asks us to actually evaluate the packet tree as a tree of an expressions, akin to S-expressions.
While this wasn&#8217;t hard, one challenge was to implement it without code duplication.
The way I achieved this was to split the operators into two families, <code>Reducer</code>s (<code>+</code>, <code>*</code>, <code>min</code>, and <code>max</code>) and <code>Operators</code>s (<code>≤</code>, <code>==</code>, <code>≥</code>) which essentially comprise their own interfaces that specify how they should be applied to values in the stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">Reducer</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Sum</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Product</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Min</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Max</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Reducer</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">identity</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Number</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Reducer</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Sum</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Product</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Min</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Number</span>::<span class="tok-n">MAX</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Max</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Number</span>::<span class="tok-n">MIN</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">combine</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x</span>: <span class="tok-nc">Number</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span>: <span class="tok-nc">Number</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Number</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Reducer</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Sum</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Product</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Min</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">.</span><span class="tok-n">min</span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Max</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">.</span><span class="tok-n">max</span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">Comparitor</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Gt</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Lt</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nb">Eq</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Comparitor</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">apply</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x</span>: <span class="tok-nc">Number</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span>: <span class="tok-nc">Number</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Number</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Comparitor</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kt">i64</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Gt</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Lt</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-nb">Eq</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">Operation</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Reduce</span><span class="tok-p">(</span><span class="tok-n">Reducer</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Compare</span><span class="tok-p">(</span><span class="tok-n">Comparitor</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-nb">From</span><span class="tok-o">&lt;</span><span class="tok-kt">u32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Operation</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">(</span><span class="tok-n">n</span>: <span class="tok-kt">u32</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Comparitor</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Operation</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Reducer</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Reduce</span><span class="tok-p">(</span><span class="tok-n">Sum</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Reduce</span><span class="tok-p">(</span><span class="tok-n">Product</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Reduce</span><span class="tok-p">(</span><span class="tok-n">Min</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Reduce</span><span class="tok-p">(</span><span class="tok-n">Max</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-mi">5</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Compare</span><span class="tok-p">(</span><span class="tok-n">Gt</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-mi">6</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Compare</span><span class="tok-p">(</span><span class="tok-n">Lt</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-mi">7</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Compare</span><span class="tok-p">(</span><span class="tok-nb">Eq</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-fm">unreachable!</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">packets</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">Packet</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Number</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">struct</span> <span class="tok-nc">Arg</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">depth</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">value</span>: <span class="tok-nc">Number</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">arg_stack</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Packet</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">kind</span>: <span class="tok-nc">packet_kind</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">depth</span>: <span class="tok-nc">packet_depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-o">..</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">packets</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">rev</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">packet_depth</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">packet_depth</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">packet_kind</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">&amp;</span><span class="tok-n">PacketKind</span>::<span class="tok-n">Literal</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">arg_stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Arg</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">depth</span>: <span class="tok-nc">packet_depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">value</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">PacketKind</span>::<span class="tok-n">Operator</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">op</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Operation</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">op</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">Reduce</span><span class="tok-p">(</span><span class="tok-n">reducer</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">result</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">reducer</span><span class="tok-p">.</span><span class="tok-n">identity</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-k">while</span><span class="tok-w"> </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">arg</span><span class="tok-w"> </span><span class="tok-o">@</span><span class="tok-w"> </span><span class="tok-n">Arg</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">arg_stack</span><span class="tok-p">.</span><span class="tok-n">pop</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">&lt;=</span><span class="tok-w"> </span><span class="tok-n">packet_depth</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-n">arg_stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">arg</span><span class="tok-p">);</span><span class="tok-w"> </span><span class="tok-c1">// oops, went too far</span>
<span class="tok-w">								</span><span class="tok-k">break</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">result</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">reducer</span><span class="tok-p">.</span><span class="tok-n">combine</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">result</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">Compare</span><span class="tok-p">(</span><span class="tok-n">comparitor</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">Arg</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">value</span>: <span class="tok-nc">first</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">..</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">arg_stack</span><span class="tok-p">.</span><span class="tok-n">pop</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">Arg</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">value</span>: <span class="tok-nc">second</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">..</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">arg_stack</span><span class="tok-p">.</span><span class="tok-n">pop</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">						</span><span class="tok-n">comparitor</span><span class="tok-p">.</span><span class="tok-n">apply</span><span class="tok-p">(</span><span class="tok-n">first</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">second</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-n">arg_stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Arg</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">depth</span>: <span class="tok-nc">packet_depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">value</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">});</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">arg_stack</span><span class="tok-p">.</span><span class="tok-n">first</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trick_shot"><a class="anchor" href="#_trick_shot"></a>17. Trick Shot</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/17" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 17 problem description</a> │ <a href="/src/day_17/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>Holy crap.
This problem was <em>hard</em>.
We are asked to find the initial \(x\)- and \(y\)-velocities that will land a projectile, fired from the origin, in a given rectangular region \(R=[x_\mathrm{min}, x_\mathrm{max}]\times[y_\mathrm{min}, y_\mathrm{max}]\).
In the \(x\)-direction, the projectile suffers from drag, so its \(x\)-velocity decreases by 1 each tick until it hits 0 (at which point it can&#8217;t slow down anymore).
In the \(y\)-direction, the projectile is affected by gravity, so its \(y\)-velocity decreases by each tick, forever.</p>
</div>
<div class="paragraph">
<p>All numbers — time, positions, and velocities — must be (not-necessarily-positive) integers.
(And, naturally, time must be positive.)
This is an important and helpful constraint on the values we can use.</p>
</div>
<div class="paragraph">
<p>The solution below does not use brute force; it does not, for instance, try all \(v_x\)s between 0 and \(R\)'s right edge, or all \(v_y\)s between \(-\mathrm{abs}(v_\mathrm{max})\) and \(\mathrm{abs}(v_\mathrm{max})\).
All potential times, positions, and speeds are derived mathematically.
It has no problem running on a target area of <code>x=1000000..1001000, y=-1000000..-1001000</code> (although this particular example requires being able to take the integer square root of large numbers, which I did not implement myself).</p>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">type</span> <span class="tok-nc">Time</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i64</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">type</span> <span class="tok-nc">Num</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i64</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Pos</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">x</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">y</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone, Copy, PartialEq, Eq)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Velo</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">vx</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">vy</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone, Copy)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Rect</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">x_min</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">x_max</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">y_min</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">y_max</span>: <span class="tok-nc">T</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone, Copy)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Trajectory</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">_t</span>: <span class="tok-nc">Time</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">_pos</span>: <span class="tok-nc">Pos</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">velo</span>: <span class="tok-nc">Velo</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Rect</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">re</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">regex</span>::<span class="tok-n">Regex</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-s">r&quot;target area:\s*x=([\d-]+)\.\.([\d-]+),\s*y=([\d-]+)\.\.([\d-]+)&quot;</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">ok</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">caps</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">re</span><span class="tok-p">.</span><span class="tok-n">captures</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">())</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-c1">// force line break :/</span>
<span class="tok-w">		</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">4</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">i</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">caps</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">).</span><span class="tok-n">and_then</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">m</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">m</span><span class="tok-p">.</span><span class="tok-n">as_str</span><span class="tok-p">().</span><span class="tok-n">parse</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">()));</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x1</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-o">?</span><span class="tok-p">];</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x_min</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x_max</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">x1</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">x1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">y_min</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y_max</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">y2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">x_min</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">x_max</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">y_min</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">y_max</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">sqrt</span><span class="tok-p">(</span><span class="tok-n">n</span>: <span class="tok-nc">Num</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">sqrt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Roots</span>::<span class="tok-n">sqrt</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">n</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">sqrt</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">sqrt</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">sqrt</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">The Math</div>
<p>Because \(x\) decreases by 1 each tick until it hits 0, and \(y\) decreases by 1 each tick forever, we have the following equations for the \(x\)- and \(y\)-coordinates at time \(t\) of a projectile fired with an initial velocity of \( (v_x, v_y)\).
(Derivations are left to the reader, but a helpful fact is that \(1+2+\ldots+n = \frac{1}{2}n(n+1)\).)</p>
</div>
\[
\begin{align*}
x(t, v_x) &=
\begin{cases}
v_x t - \frac{1}{2}t(t-1)&t \le v_x\\
\frac{1}{2}v_x(v_x+1)&t \ge v_x
\end{cases}\\
y(t, v_y)&=v_y t - \frac{1}{2}t(t-1)
\end{align*}
\]
<div class="paragraph">
<p>Note that even though the two definitions of \(x\) overlap at \(t=v_x\), they also coincide there, so it&#8217;s not a problem.</p>
</div>
<div class="paragraph">
<p>Now, we must find the values of \( (v_x,v_y)\) that land the projectile in \(R\).
To do this, we simply find the values of \( (v_x,v_y)\) that will land the projectile precisely at a point \( (x,y)\) in R, for each \( (x,y)\in R\).
And to do this, we find the \( (v_x,v_y)\) that will land the projectile at \( (x,y)\) precisely at time \(t\), for each positive \(t\).</p>
</div>
<div class="paragraph">
<p>To find the velocities that will land the projectile precisely at \( (t,x,y)\), we solve the above equations for \(v_x\) and \(v_y\).
Finding \(v_y\) is simple: \(v_y=\frac{2y+t(t-1)}{2t}\).
For \(v_x\), it&#8217;s a bit more complicated, as we have two options:
\[
v_x=\begin{cases}
\frac{2x+t(t-1)}{2t}&amp;t\le v_x\\
\frac{-1\pm\sqrt{1+8x}}{2}&amp;t\ge v_x
\end{cases}
\]</p>
</div>
<div class="paragraph">
<p>And as we said above, we need everything to be an integer, so we can either have no pairs of velocities that work, one pair, or two pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">find_velocities</span><span class="tok-p">(</span><span class="tok-n">t</span>: <span class="tok-nc">Time</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">position</span>: <span class="tok-nc">Pos</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-p">[</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Velo</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">Velo</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">vx</span>: <span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">vy</span>: <span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">}),</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">Pos</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">position</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vy_numer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vy_denom</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">vy_numer</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-n">vy_denom</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">vy_numer</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">vy_denom</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-nb">None</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx1</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx_numer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx_denom</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">vx_numer</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">vx_denom</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">vx_numer</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-n">vx_denom</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">vx</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx2</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">discriminant</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">8</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">sqrt</span><span class="tok-p">(</span><span class="tok-n">discriminant</span><span class="tok-p">).</span><span class="tok-n">and_then</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">sqrt_disc</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx_numer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">sqrt_disc</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx_denom</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">vx_numer</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">vx_denom</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">vx_numer</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-n">vx_denom</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-o">&lt;=</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">vx</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-p">[</span><span class="tok-n">vx1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">vx2</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">opt_vx</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">opt_vx</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">vx</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Velo</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">vx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-p">}))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Awesome.
We have the 0, 1, or 2 velocities that will land the projectile at \( (x, y)\) at time \(t\).
But how to find the \(t\)s for which the projectile can even land at \( (x,y)\)?
We cannot enumerate all \(t\)s, as there are infinitely many positive integers.
Could we perhaps keep firing it with a larger and larger \(v_y\) and hope that it would continue to land in \(R\) at some point in its trajectory?
The answer is no: there are only finitely many values of \(v_y\) for which there exists a time \(t\) such that the projectile has a vertical position of \(y\) at \(t\).
Let&#8217;s prove it, and let&#8217;s find them.</p>
</div>
<div class="paragraph">
<p>Solving the equation \(y=v_y t- \frac{1}{2}t(t-1)\) for \(t\), we find that:
\[t=\frac{1}{2}\left((2v_y+1)\pm\sqrt{(2v_y+1)^2-8y}\right)\]
First and foremost, for this to be an integer, \((2v_y+1)^2-8y\) must be a perfect square.
Letting \( m^2 =(2v_y+1) ^ 2\) and \(n^2 = m^2 - 8y\), we have \(m^2 - n^2 = 8y\), which factors into \((m-n)(m+n)=8y\).
Since everything must be an integer, we can use the factor pairs of \(8y\) to find \(m\) and \(n\).
If \(8y=(m-n)(m+n)=k_1k_2\), then \(m=\frac{1}{2}(k_1+k_2)\).
Hence, if \(2v_y+1=\frac{1}{2}(k_1+k_2)\), then \((2v_y+1)^2 - 8y\) will indeed be a perfect square.
Of course, we also need \(\frac{1}{2}(k_1+k_2)\) to be an odd integer so that \(v_y\) will be an integer.
Finally, we plug \(v_y\) into our equation for \(t\) and if we get an integer, we&#8217;ve got a match: if the projectile is fired with a \(y\)-velocity of \(v_y\), then it will hit the vertical position \(y\) precisely at \(t\).</p>
</div>
<div class="paragraph">
<p>The astute reader will note that there <em>every</em> projectile with \(v_y&gt;0\) hits \(y=0\) on the way down.
Therefore we exclude \(y=0\) from consideration altogether; a problem that included \(y=0\) in \(R\) would have infinitely many answers or be impossible to solve.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">find_ts_and_vys_for_y</span><span class="tok-p">(</span><span class="tok-n">y</span>: <span class="tok-nc">Num</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-n">Time</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Num</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-fm">assert_ne!</span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-c1">// Need to find all integer (t, vy) that satisfy y = vy * t - t*(t-1)/2 with t &gt; 0</span>
<span class="tok-w">	</span><span class="tok-c1">//</span>
<span class="tok-w">	</span><span class="tok-c1">// Step one: (2*vy + 1)^2 - 8*y = must be square</span>
<span class="tok-w">	</span><span class="tok-c1">//</span>
<span class="tok-w">	</span><span class="tok-c1">// In other words there must exist integral m and n such that m^2 - n^2 = 8y (with</span>
<span class="tok-w">	</span><span class="tok-c1">// 2*vy + 1 = m). m^2 - n^2 = (m-n)*(m+n), and so...</span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">eight_y</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">8</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">abs_eight_y</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">eight_y</span><span class="tok-p">.</span><span class="tok-n">abs</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">k1</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-o">..=</span><span class="tok-n">Roots</span>::<span class="tok-n">sqrt</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">abs_eight_y</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">abs_eight_y</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-n">k1</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">sign</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">k1</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">sign</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">k1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">k2</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">eight_y</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">k1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-c1">// k1 and k2 are now two signed integers that multiply to y</span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">two_m</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">k1</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">k2</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">two_m</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">m</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">two_m</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-c1">// Now, m was 2*vy + 1, and so...</span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">m</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">m</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">discriminant</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">m</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">m</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">eight_y</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">discriminant</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">sqrt_disc</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">sqrt</span><span class="tok-p">(</span><span class="tok-n">discriminant</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">pm</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">t_numer</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">pm</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">sqrt_disc</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">t_numer</span><span class="tok-w"> </span><span class="tok-o">&lt;=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">t_numer</span><span class="tok-w"> </span><span class="tok-o">%</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">t_numer</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">ans</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">((</span><span class="tok-n">t</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">ans</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are nearly there!
To find whether, and how, the projectile can reach the point \( (x,y)\), we find:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the set of pairs \((t, v_y)\) that give the projectile a vertical position of \(y\) at time \(t\), and</p>
</li>
<li>
<p>for each of these pairs, we check that the projectile can indeed reach \( (x,y)\) at time \(t\) (we know it can reach \(y\), but can it reach \(x\)?) and find the velocities \( (v_x,v_y)\) that will achieve that, if possible.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>And we simply do this for every \( (x,y)\in R\).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">get_x</span><span class="tok-p">(</span><span class="tok-n">t</span>: <span class="tok-nc">Time</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">vx</span>: <span class="tok-nc">Num</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Num</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">&lt;=</span><span class="tok-w"> </span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">vx</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">get_trajectories</span><span class="tok-p">(</span><span class="tok-n">rect</span>: <span class="tok-nc">Rect</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Trajectory</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">Rect</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">x_min</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">x_max</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">y_min</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">y_max</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">rect</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">trajectories</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">y_min</span><span class="tok-o">..=</span><span class="tok-n">y_max</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-c1">// If any vx works, then there will be infinitely many choices for vy because it</span>
<span class="tok-w">			</span><span class="tok-c1">// retraces its ascent on its descent. And if no vx works, then it&#39;s moot</span>
<span class="tok-w">			</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">ts_and_vys</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">find_ts_and_vys_for_y</span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">ts_and_vys</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">x_min</span><span class="tok-o">..=</span><span class="tok-n">x_max</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">velocities</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">find_velocities</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Pos</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-p">});</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">velo</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">velocities</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">velo</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">velo</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">v</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">continue</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">velo</span><span class="tok-p">.</span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">get_x</span><span class="tok-p">(</span><span class="tok-n">t</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">velo</span><span class="tok-p">.</span><span class="tok-n">vx</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">trajectories</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Trajectory</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">_t</span>: <span class="tok-nc">t</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">_pos</span>: <span class="tok-nc">Pos</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-p">},</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">velo</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">});</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">trajectories</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We that we can get all the trajectories, the actual answers we&#8217;re asked for are pretty simple.</p>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 asks us to find the maximum possible height that can be achieved by a projectile that reaches \(R\).
For a given projectile, the time at which it reaches its apex can be found by setting the derivative of \(y\) equal to 0.
Given \(y=v_y t-\frac{1}{2}t(t-1)\), we have \(\frac{\mathrm{d}y}{\mathrm{d}t}=\frac{1}{2}(2v_y-2t-1)=0\), which yields \(t=\frac{1}{2}(2v_y-1)\).
(Technically \(2v_y-1\) might not be even, but if not, then we&#8217;ll just end up rounding \(\frac{1}{2}(2v_y-1)\) down to the nearest integer.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">trajectories</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">Trajectory</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">Num</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">trajectories</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">traj</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">traj</span><span class="tok-p">.</span><span class="tok-n">velo</span><span class="tok-p">.</span><span class="tok-n">vy</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">vy</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">max</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 asks us to simply count distinct initial velocities that land the projectile in \(R\).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">trajectories</span>: <span class="tok-kp">&amp;</span><span class="tok-p">[</span><span class="tok-n">Trajectory</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">trajectories</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">Trajectory</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">velo</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">..</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">velo</span><span class="tok-p">.</span><span class="tok-n">vx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">velo</span><span class="tok-p">.</span><span class="tok-n">vy</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_snailfish"><a class="anchor" href="#_snailfish"></a>18. Snailfish</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/18" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 18 problem description</a> │ <a href="/src/day_18/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This problem asks us to parse a nested structure of pairs into a binary tree and then split or combine nodes according to a set of rules.
Rather than store the tree as an actual tree, which would be easy but would suffer from poor cache locality, we store the nodes in a <code>Vec</code> and record the depth of each node.
This makes traversing and manipulating the tree much easier than if they were stored in a “real” tree; the nodes to the left and right of index <code>i</code> are simply those at <code>i-1</code> and <code>i+1</code>, respectively (if they exist).
The operations are performed as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Exploding</dt>
<dd>
<p>A pair is exploded by finding the first flat pair of depth at least four and storing the two values; the first is added to the node to the left and the second is added to the node to the right.
The second element of the pair is then deleted.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-sd">/// Explodes the first explode-able pair in the list. \</span>
<span class="tok-sd">/// Returns the `Option` pair of `Option` indices of the elements to the left and right</span>
<span class="tok-sd">/// (the ones being modified), in that order. `None` means there was no pair to explode;</span>
<span class="tok-sd">/// `(None, Some(2))` means the exploded pair had no elements to the left of it (it</span>
<span class="tok-sd">/// was at index 0), and the element to its right was added to</span>
<span class="tok-k">fn</span> <span class="tok-nf">explode_first</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">elems</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">((</span><span class="tok-n">l_idx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">l_elem</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">r_idx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">r_elem</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">zip</span><span class="tok-p">(</span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">().</span><span class="tok-n">skip</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">find_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">((</span><span class="tok-n">i1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">e1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">i2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">e2</span><span class="tok-p">))</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">e1</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-mi">4</span><span class="tok-w"> </span><span class="tok-o">&amp;&amp;</span><span class="tok-w"> </span><span class="tok-n">e1</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">e2</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">Some</span><span class="tok-p">(((</span><span class="tok-n">i1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">i2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e2</span><span class="tok-p">)))</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">elems</span><span class="tok-p">[</span><span class="tok-n">l_idx</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">value</span>: <span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">depth</span>: <span class="tok-nc">l_elem</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">changed_l_idx</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">l_idx</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">idx</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">l_idx</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">elems</span><span class="tok-p">[</span><span class="tok-n">idx</span><span class="tok-p">].</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">l_elem</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">idx</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-n">elems</span><span class="tok-p">).</span><span class="tok-n">remove</span><span class="tok-p">(</span><span class="tok-n">r_idx</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">changed_r_idx</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">r_idx</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">elems</span><span class="tok-p">[</span><span class="tok-n">r_idx</span><span class="tok-p">].</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">r_elem</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">r_idx</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">((</span><span class="tok-n">changed_l_idx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">changed_r_idx</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Splitting</dt>
<dd>
<p>An element is split by simply dividing it by 2 twice, rounding down the first time and up the second time, and replacing the element with those two values.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-sd">/// Splits the first splittable pair in the list. \</span>
<span class="tok-sd">/// Returns the index at which the split occurred, which is now the first element of the</span>
<span class="tok-sd">/// resulting pair</span>
<span class="tok-k">fn</span> <span class="tok-nf">split_first</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">elems</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">split_idx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">().</span><span class="tok-n">find_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">elem</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">elem</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">10</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">Some</span><span class="tok-p">((</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">elem</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_l_value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_r_value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_elem</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">value</span>: <span class="tok-nc">new_l_value</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">depth</span>: <span class="tok-nc">depth</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">elems</span><span class="tok-p">[</span><span class="tok-n">split_idx</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">new_elem</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">split_idx</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">value</span>: <span class="tok-nc">new_r_value</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">depth</span>: <span class="tok-nc">new_elem</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">},</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">split_idx</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Adding</dt>
<dd>
<p>Two pairs are added by placing them in a containing pair.
This is manifested as simply concatenating the two vectors and then incrementing all the depths.
Notably, <em>addition is not associative</em>.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">add</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">other</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">SnailNumOwned</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">elems</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">chain</span><span class="tok-p">(</span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|&amp;</span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">value</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">depth</span>: <span class="tok-nc">depth</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">SnailNumOwned</span>::<span class="tok-n">owning</span><span class="tok-p">(</span><span class="tok-n">elems</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans</span><span class="tok-p">.</span><span class="tok-n">reduce</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Finding Pairs in the Vector</dt>
<dd>
<p>The only somewhat tricky part is determining the tree structure from the vector of depths.
A singleton is returned as an <code>Err</code> containing its value.
A “flat” pair (a pair whose elements are both atomic) appears as two consecutive elements of the same depth.
Non-flat pairs can be found by traversing the nodes from left to right, maintaining a stack of node depths, and, whenever the top two elements of the stack have the same depth \(d\), collapsing them into a single element with a depth of \(d-1\).
When a pair with elements of depth 1 is found, we have split the tree into its two top-level pairs.
If desired, we can then recurse on these to split the descendants into deeper pairs.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">as_pair</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Result</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-n">SnailNumBorrowed</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">SnailNumBorrowed</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-fm">assert_ne!</span><span class="tok-p">(</span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;{}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">()[</span><span class="tok-mi">0</span><span class="tok-p">].</span><span class="tok-n">value</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">depth_stack</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">..</span><span class="tok-w"> </span><span class="tok-p">})</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">depth_stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">depth</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">loop</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">depth_stack</span><span class="tok-p">.</span><span class="tok-n">pop</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-k">break</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">curr_depth</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">curr_depth</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">left</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">right</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-p">.</span><span class="tok-n">split_at</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">						</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">Ok</span><span class="tok-p">((</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">SnailNum</span>::<span class="tok-n">borrowing</span><span class="tok-p">(</span><span class="tok-n">left</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">curr_depth</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">SnailNum</span>::<span class="tok-n">borrowing</span><span class="tok-p">(</span><span class="tok-n">right</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">curr_depth</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">depth_stack</span><span class="tok-p">.</span><span class="tok-n">pop</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-nb">None</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">depth_stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">curr_depth</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-k">break</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">prev_depth</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">prev_depth</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">curr_depth</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-n">depth_stack</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">curr_depth</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-n">depth_stack</span><span class="tok-p">.</span><span class="tok-n">extend</span><span class="tok-p">([</span><span class="tok-n">prev_depth</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">curr_depth</span><span class="tok-p">]);</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-k">break</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-fm">unreachable!</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Magnitude of a Pair</dt>
<dd>
<p>Self explanatory:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">magnitude</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">as_pair</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">Ok</span><span class="tok-p">((</span><span class="tok-n">left</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">right</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">left</span><span class="tok-p">.</span><span class="tok-n">magnitude</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">right</span><span class="tok-p">.</span><span class="tok-n">magnitude</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-nb">Err</span><span class="tok-p">(</span><span class="tok-n">val</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">val</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<hr>
<div class="paragraph">
<div class="title">Setup</div>
<p>Functions listed above are omitted here.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-p">{</span><span class="tok-n">Debug</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Display</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone, Copy, Eq, PartialEq)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">value</span>: <span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">depth</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, PartialEq, Eq)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">SnailNum</span><span class="tok-o">&lt;</span><span class="tok-n">Elems</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-n">Elem</span><span class="tok-p">]</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">elems</span>: <span class="tok-nc">Elems</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">depth</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">type</span> <span class="tok-nc">SnailNumOwned</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">SnailNum</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Elem</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">type</span> <span class="tok-nc">SnailNumBorrowed</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">SnailNum</span><span class="tok-o">&lt;&amp;&#39;</span><span class="tok-na">a</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Elem</span><span class="tok-p">]</span><span class="tok-o">&gt;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">SnailNumOwned</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_line</span><span class="tok-p">(</span><span class="tok-n">line</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">addends</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Vec</span>::<span class="tok-o">&lt;</span><span class="tok-n">Elem</span><span class="tok-o">&gt;</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">prev_was_digit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">().</span><span class="tok-n">chars</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">c_is_digit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-sc">&#39;[&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-sc">&#39;]&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">depth</span><span class="tok-w"> </span><span class="tok-o">-=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-sc">&#39;0&#39;</span><span class="tok-o">..=</span><span class="tok-sc">&#39;9&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">digit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">.</span><span class="tok-n">to_digit</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">prev_was_digit</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">val</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">addends</span><span class="tok-p">.</span><span class="tok-n">last_mut</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">val</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">10</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">val</span><span class="tok-p">.</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">digit</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">addends</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Elem</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">value</span>: <span class="tok-nc">digit</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">});</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">c_is_digit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-sc">&#39;,&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-fm">panic!</span><span class="tok-p">(</span><span class="tok-s">&quot;Unexpected character {:?}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-n">prev_was_digit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">c_is_digit</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">SnailNum</span>::<span class="tok-n">owning</span><span class="tok-p">(</span><span class="tok-n">addends</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">by_adding_lines_in</span><span class="tok-o">&lt;</span><span class="tok-n">S</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-kt">str</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">I</span>: <span class="tok-nb">IntoIterator</span><span class="tok-o">&lt;</span><span class="tok-n">Item</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">S</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">lines</span>: <span class="tok-nc">I</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">into_iter</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">SnailNumOwned</span>::<span class="tok-n">from_line</span><span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">().</span><span class="tok-n">as_ref</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">ans</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-p">.</span><span class="tok-n">add</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">SnailNumOwned</span>::<span class="tok-n">from_line</span><span class="tok-p">(</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">()));</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">ans</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_str</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span>::<span class="tok-n">by_adding_lines_in</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">owning</span><span class="tok-p">(</span><span class="tok-n">elems</span>: <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Elem</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">elems</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">depth</span>: <span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">reduce_once</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">bool</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">explode_first</span><span class="tok-p">().</span><span class="tok-n">is_some</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">split_first</span><span class="tok-p">().</span><span class="tok-n">is_some</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">reduce</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">while</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">reduce_once</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-c1">// Contains explode_first and split_first, which only operate on owned snail nums</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">SnailNumBorrowed</span><span class="tok-o">&lt;&#39;</span><span class="tok-na">a</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">borrowing</span><span class="tok-p">(</span><span class="tok-n">elems</span>: <span class="tok-kp">&amp;</span><span class="tok-o">&#39;</span><span class="tok-na">a</span> <span class="tok-p">[</span><span class="tok-n">Elem</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">base_depth</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">elems</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">depth</span>: <span class="tok-nc">base_depth</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">E</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-n">Elem</span><span class="tok-p">]</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-n">SnailNum</span><span class="tok-o">&lt;</span><span class="tok-n">E</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-c1">// Contains add, as_pair, and magnitude</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">snail_num</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">SnailNumOwned</span>::<span class="tok-n">from_str</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">18</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">snail_num</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">u32</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 simply asks to perform addition on the input numbers.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-o">&lt;</span><span class="tok-n">E</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-n">Elem</span><span class="tok-p">]</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">snail_num</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">SnailNum</span><span class="tok-o">&lt;</span><span class="tok-n">E</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">snail_num</span><span class="tok-p">.</span><span class="tok-n">magnitude</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 asks to find the maximum pairwise sum of the input numbers.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">max_mag</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">u32</span>::<span class="tok-n">MIN</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">snail_nums</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">input</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">SnailNumOwned</span>::<span class="tok-n">from_line</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">sn1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">snail_nums</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">sn2</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">snail_nums</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">skip</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">mag1</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">sn1</span><span class="tok-p">.</span><span class="tok-n">add</span><span class="tok-p">(</span><span class="tok-n">sn2</span><span class="tok-p">).</span><span class="tok-n">magnitude</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">mag2</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">sn2</span><span class="tok-p">.</span><span class="tok-n">add</span><span class="tok-p">(</span><span class="tok-n">sn1</span><span class="tok-p">).</span><span class="tok-n">magnitude</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-n">max_mag</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">max_mag</span><span class="tok-p">.</span><span class="tok-n">max</span><span class="tok-p">(</span><span class="tok-n">mag1</span><span class="tok-p">).</span><span class="tok-n">max</span><span class="tok-p">(</span><span class="tok-n">mag2</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">max_mag</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beacon_scanner"><a class="anchor" href="#_beacon_scanner"></a>19. Beacon Scanner</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/19" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 19 problem description</a> │ <a href="/src/day_19/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This problem asks us to essentially solve a 3D jigsaw puzzle; we are given “pieces” (scanners) and need to find how they fit together by looking at their “edges” (beacons).
As in an ordinary puzzle, we might need to rotate pieces to get them to mesh.</p>
</div>
<div class="paragraph">
<p>To solve this, we simply try every solution: we start with Scanner #1 and try to adjoin each other scanner to it.
Once we find a scanner that works, we go back to step 1 and try to adjoin a new scanner to the two-scanner union, and when we&#8217;ve done that we try to adjoin a new scanner to the three-scanner union, etc.
If at any point we can&#8217;t fit a new scanner onto the existing scanners, we backtrack, removing scanners so that we can add them in a different way.
We&#8217;re done when all scanners have been adjoined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Technically there is a wrinkle that this solution ignores: it is not sufficient for scanners to merely fit together, i.e., to have overlapping beacons; additionally, each of the scanners in an adjoined pair must not have any beacons in the shared region that the other scanner in the pair does not have.
In other words, they must agree on <em>all</em>, not just <em>some</em>, of the beacons in the region where they intersect.
We ignore this wrinkle altogether; thankfully the authors were kind enough to give us input where this doesn&#8217;t matter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because this “puzzle” is three-dimensional, there are 24 ways to orient a piece with respect to another (six faces can be “up”, and then there are four ways to rotate about the up-axis).
In the code, one of these 24 orientations is referred to as a <code>Swivel</code>.
For each orientation, we find all translations that cause the pieces to fit together; these are <code>Translation</code>s.
(A <code>Swivel</code> and a <code>Translation</code> together form a <code>Transform</code>.)
Then we rinse and repeat with the next piece.</p>
</div>
<div class="paragraph">
<p>To actually do the math, we simply use matrix multiplication.
As always, the matrix \(T\) that performs a given transformation is <a href="https://en.wikipedia.org/wiki/Matrix_(mathematics)#Relationship_to_linear_maps" target="_blank" rel="noopener">the matrix whose columns are \(T(e_1), \ldots, T(e_n) \)</a> where \(e_1,\ldots,e_n\) are the basis vectors.</p>
</div>
<hr>
<div class="paragraph">
<p>The function that does the heavy lifting here is <code>Scanner::merge_all</code>, which simply starts with the first provided scanner and then repeatedly tries to form larger and larger unions by merging the other scanners with the existing union.
It stops when it first successfully merges all scanners together.</p>
</div>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-n">Answer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-p">{</span><span class="tok-n">borrow</span>::<span class="tok-n">Borrow</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">collections</span>::<span class="tok-n">BTreeSet</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">strum</span>::<span class="tok-n">IntoEnumIterator</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">strum_macros</span>::<span class="tok-n">EnumIter</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">type</span> <span class="tok-nc">Triple</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-kt">i32</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">];</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone, Copy)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Matrix3</span><span class="tok-p">([</span><span class="tok-kt">i32</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">9</span><span class="tok-p">]);</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_cols</span><span class="tok-p">(</span><span class="tok-n">x</span>: <span class="tok-nc">impl</span><span class="tok-w"> </span><span class="tok-nb">Into</span><span class="tok-o">&lt;</span><span class="tok-n">Triple</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span>: <span class="tok-nc">impl</span><span class="tok-w"> </span><span class="tok-nb">Into</span><span class="tok-o">&lt;</span><span class="tok-n">Triple</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span>: <span class="tok-nc">impl</span><span class="tok-w"> </span><span class="tok-nb">Into</span><span class="tok-o">&lt;</span><span class="tok-n">Triple</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">.</span><span class="tok-n">into</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">.</span><span class="tok-n">into</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">.</span><span class="tok-n">into</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-p">([</span><span class="tok-n">x</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">]])</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">row</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">i</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Triple</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">j</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">j</span><span class="tok-p">])</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">col</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">i</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Triple</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">j</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">j</span><span class="tok-p">])</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">mat_mul</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">other</span>: <span class="tok-nc">Self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">entries</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">9</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">self_row</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">row</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">other_col</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">col</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">entries</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-p">).</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">i</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">self_row</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">other_col</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]).</span><span class="tok-n">sum</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">i</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-p">(</span><span class="tok-n">entries</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">mul_vec</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">col</span>: <span class="tok-nc">Triple</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Triple</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">entries</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">elem</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">entries</span><span class="tok-p">.</span><span class="tok-n">iter_mut</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">self_row</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">row</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-o">*</span><span class="tok-n">elem</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-mi">3</span><span class="tok-p">).</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">i</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">self_row</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">col</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]).</span><span class="tok-n">sum</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">entries</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">ops</span>::<span class="tok-n">Index</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-kt">usize</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">]</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">type</span> <span class="tok-nc">Output</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i32</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">index</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">index</span>: <span class="tok-p">[</span><span class="tok-kt">usize</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">])</span><span class="tok-w"> </span>-&gt; <span class="tok-kp">&amp;</span><span class="tok-nc">Self</span>::<span class="tok-n">Output</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">row</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">col</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">row</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">col</span><span class="tok-p">]</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Clone, Copy, Debug, EnumIter, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">Axis</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">PosX</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">NegX</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">PosY</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">NegY</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">PosZ</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">NegZ</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-nb">From</span><span class="tok-o">&lt;</span><span class="tok-n">Axis</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Triple</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">(</span><span class="tok-n">axis</span>: <span class="tok-nc">Axis</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Axis</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">axis</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">PosX</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">],</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NegX</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">],</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">PosY</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">],</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NegY</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">],</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">PosZ</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">],</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NegZ</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">],</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Clone, Copy, Debug, EnumIter, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">enum</span> <span class="tok-nc">RotationCcw</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Zero</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Quarter</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">Half</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ThreeQuarters</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Clone, Copy, Debug, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Swivel</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">up_face</span>: <span class="tok-nc">Axis</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">rotation_about_up</span>: <span class="tok-nc">RotationCcw</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Swivel</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">new</span><span class="tok-p">(</span><span class="tok-n">up_face</span>: <span class="tok-nc">Axis</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">rotation_about_up</span>: <span class="tok-nc">RotationCcw</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">up_face</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">rotation_about_up</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">identity</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">Axis</span>::<span class="tok-n">PosZ</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">RotationCcw</span>::<span class="tok-n">Zero</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">apply</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">point</span>: <span class="tok-nc">Triple</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Triple</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">Axis</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">RotationCcw</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">mat_to_bring_face_to_up</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">up_face</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">PosX</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">PosZ</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">NegX</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NegX</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">NegZ</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosX</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">PosY</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">PosX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosZ</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">NegY</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NegY</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">PosX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">NegZ</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosY</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">PosZ</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">PosX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosZ</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">NegZ</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-c1">// We have a couple options; we pick the one that rotates about the y axis</span>
<span class="tok-w">				</span><span class="tok-c1">// because it&#39;s easier to actually rotate my hand that way</span>
<span class="tok-w">				</span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">NegX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">NegZ</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">mat_to_rotate_about_up</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">rotation_about_up</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Zero</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">PosX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosZ</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Quarter</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">PosY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">NegX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosZ</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Half</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">NegX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">NegY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosZ</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">ThreeQuarters</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Matrix3</span>::<span class="tok-n">from_cols</span><span class="tok-p">(</span><span class="tok-n">NegY</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosX</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">PosZ</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">mat_to_bring_face_to_up</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">mat_mul</span><span class="tok-p">(</span><span class="tok-n">mat_to_rotate_about_up</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">mul_vec</span><span class="tok-p">(</span><span class="tok-n">point</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Clone, Copy, Debug, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Translation</span><span class="tok-p">(</span><span class="tok-n">Triple</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Translation</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">identity</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-p">([</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">])</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">apply</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">point</span>: <span class="tok-nc">Triple</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Triple</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">point</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">tx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ty</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">tz</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">[</span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">tx</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ty</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">tz</span><span class="tok-p">]</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">manhattan_dist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kt">u32</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">.</span><span class="tok-n">abs</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">.</span><span class="tok-n">abs</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">.</span><span class="tok-n">abs</span><span class="tok-p">()).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Clone, Copy, Debug, PartialEq, Eq, PartialOrd, Ord)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Transform</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">swivel</span>: <span class="tok-nc">Swivel</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">translation</span>: <span class="tok-nc">Translation</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-nb">From</span><span class="tok-o">&lt;</span><span class="tok-n">Swivel</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Transform</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">(</span><span class="tok-n">swivel</span>: <span class="tok-nc">Swivel</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">swivel</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">translation</span>: <span class="tok-nc">Translation</span><span class="tok-p">([</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">]),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-nb">From</span><span class="tok-o">&lt;</span><span class="tok-n">Translation</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">Transform</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from</span><span class="tok-p">(</span><span class="tok-n">translation</span>: <span class="tok-nc">Translation</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">swivel</span>: <span class="tok-nc">Swivel</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">Axis</span>::<span class="tok-n">PosZ</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">RotationCcw</span>::<span class="tok-n">Zero</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">translation</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Transform</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">identity</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">swivel</span>: <span class="tok-nc">Swivel</span>::<span class="tok-n">identity</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">translation</span>: <span class="tok-nc">Translation</span>::<span class="tok-n">identity</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">apply</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">point</span>: <span class="tok-nc">Triple</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Triple</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">translation</span><span class="tok-p">.</span><span class="tok-n">apply</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">swivel</span><span class="tok-p">.</span><span class="tok-n">apply</span><span class="tok-p">(</span><span class="tok-n">point</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Scanner</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">beacons</span>: <span class="tok-nc">BTreeSet</span><span class="tok-o">&lt;</span><span class="tok-n">Triple</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Scanner</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">new</span><span class="tok-p">(</span><span class="tok-n">beacons</span>: <span class="tok-nc">BTreeSet</span><span class="tok-o">&lt;</span><span class="tok-n">Triple</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">beacons</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">merged_with</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">other</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">beacons</span>: <span class="tok-nc">self</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-p">.</span><span class="tok-k">union</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-p">).</span><span class="tok-n">copied</span><span class="tok-p">().</span><span class="tok-n">collect</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">applying</span><span class="tok-o">&lt;</span><span class="tok-n">T</span>: <span class="tok-nb">Into</span><span class="tok-o">&lt;</span><span class="tok-n">Transform</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-nb">Copy</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">transform</span>: <span class="tok-nc">T</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">transform</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">transform</span><span class="tok-p">.</span><span class="tok-n">into</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">Scanner</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|&amp;</span><span class="tok-n">p</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">transform</span><span class="tok-p">.</span><span class="tok-n">apply</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">)).</span><span class="tok-n">collect</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">candidates_for_merge</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">other</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Scanner</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-n">Transform</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Scanner</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">transforms</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">BTreeSet</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">candidates</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">up_face</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">Axis</span>::<span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">rotation</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">RotationCcw</span>::<span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">swivel</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Swivel</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">up_face</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">rotation</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">swiveled_other</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">other</span><span class="tok-p">.</span><span class="tok-n">applying</span><span class="tok-p">(</span><span class="tok-n">swivel</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">swiveled_other_beacon</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-n">swiveled_other</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">this_beacon</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-o">&amp;</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">translation</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Translation</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">i</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">this_beacon</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">swiveled_other_beacon</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]),</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">transformed_other</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">swiveled_other</span><span class="tok-p">.</span><span class="tok-n">applying</span><span class="tok-p">(</span><span class="tok-n">translation</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">						</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">.</span><span class="tok-n">intersection</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">transformed_other</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">.</span><span class="tok-n">count</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-mi">12</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">transform</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Transform</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-n">swivel</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-n">translation</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">wasnt_present</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">transforms</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">(</span><span class="tok-n">transform</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">wasnt_present</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-n">candidates</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">((</span><span class="tok-n">transform</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">transformed_other</span><span class="tok-p">));</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">candidates</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">merge_all</span><span class="tok-o">&lt;</span><span class="tok-n">S</span>: <span class="tok-nc">Borrow</span><span class="tok-o">&lt;</span><span class="tok-n">Scanner</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">V</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-n">S</span><span class="tok-p">]</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-n">scanners</span>: <span class="tok-nc">V</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-p">(</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Transform</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Scanner</span><span class="tok-p">)</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">struct</span> <span class="tok-nc">MergedScanner</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">index</span>: <span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">merged</span>: <span class="tok-nc">Scanner</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">transform</span>: <span class="tok-nc">Transform</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">scanners</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">scanners</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">first</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">rest</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">scanners</span><span class="tok-p">.</span><span class="tok-n">split_first</span><span class="tok-p">().</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">first</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Scanner</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">first</span><span class="tok-p">.</span><span class="tok-n">borrow</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">rest</span><span class="tok-p">.</span><span class="tok-n">is_empty</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">((</span><span class="tok-fm">vec!</span><span class="tok-p">[</span><span class="tok-n">Transform</span>::<span class="tok-n">identity</span><span class="tok-p">()],</span><span class="tok-w"> </span><span class="tok-n">first</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">()));</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-n">rest</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">flat_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">borrow</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">first</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">.</span><span class="tok-n">candidates_for_merge</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">transform</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">transformed_scanner</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">MergedScanner</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">index</span>: <span class="tok-nc">i</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">merged</span>: <span class="tok-nc">first</span><span class="tok-p">.</span><span class="tok-n">merged_with</span><span class="tok-p">(</span><span class="tok-n">transformed_scanner</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">transform</span>: <span class="tok-o">*</span><span class="tok-n">transform</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">find_map</span><span class="tok-p">(</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-o">|</span><span class="tok-n">MergedScanner</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				     </span><span class="tok-n">index</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				     </span><span class="tok-n">merged</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				     </span><span class="tok-n">transform</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				 </span><span class="tok-p">}</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_scanners</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">iter</span>::<span class="tok-n">once</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">merged</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">.</span><span class="tok-n">chain</span><span class="tok-p">(</span><span class="tok-n">rest</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">().</span><span class="tok-n">filter_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">j</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-n">j</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-nb">None</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">								</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">borrow</span><span class="tok-p">())</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">}))</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">					</span><span class="tok-n">Scanner</span>::<span class="tok-n">merge_all</span><span class="tok-p">(</span><span class="tok-n">new_scanners</span><span class="tok-p">).</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">transforms</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">(</span><span class="tok-n">std</span>::<span class="tok-n">iter</span>::<span class="tok-n">once</span><span class="tok-p">(</span><span class="tok-n">transform</span><span class="tok-p">).</span><span class="tok-n">chain</span><span class="tok-p">(</span><span class="tok-n">transforms</span><span class="tok-p">).</span><span class="tok-n">collect</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">ans</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">},</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">read_input</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Scanner</span><span class="tok-o">&gt;&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">scanners</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">this_scanner_beacons</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">BTreeSet</span>::<span class="tok-n">new</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">().</span><span class="tok-n">chain</span><span class="tok-p">(</span><span class="tok-n">std</span>::<span class="tok-n">iter</span>::<span class="tok-n">once</span><span class="tok-p">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">starts_with</span><span class="tok-p">(</span><span class="tok-s">&quot;---&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">continue</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">is_empty</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">scanners</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">Scanner</span>::<span class="tok-n">new</span><span class="tok-p">(</span><span class="tok-n">this_scanner_beacons</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">()));</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">this_scanner_beacons</span><span class="tok-p">.</span><span class="tok-n">clear</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">comps</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-sc">&#39;,&#39;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">_</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">comps</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">parse</span><span class="tok-p">().</span><span class="tok-n">ok</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-o">?</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-o">?</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">this_scanner_beacons</span><span class="tok-p">.</span><span class="tok-n">insert</span><span class="tok-p">([</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-p">]);</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">scanners</span><span class="tok-p">)</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">u32</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">scanners</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">read_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">)).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">transforms</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">scanner</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Scanner</span>::<span class="tok-n">merge_all</span><span class="tok-p">(</span><span class="tok-n">scanners</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">translations</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">transforms</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">t</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-n">t</span><span class="tok-p">.</span><span class="tok-n">translation</span><span class="tok-p">).</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">19</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">scanner</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">translations</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Part 1</div>
<p>Part 1 asks us to simply count the distinct beacons after the scanners have all been merged.
Below, <code>scanner</code> is obtained from <code>let (transforms, scanner) = Scanner::merge_all(scanners).unwrap();</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">scanner</span>: <span class="tok-kp">&amp;</span><span class="tok-nc">Scanner</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">scanner</span><span class="tok-p">.</span><span class="tok-n">beacons</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Part 2</div>
<p>Part 2 asks us to find the maximum <a href="https://en.wikipedia.org/wiki/Taxicab_geometry" target="_blank" rel="noopener">Manhattan distance</a> between scanners.
To do this, we have to track the transformation of each scanner in the successful merge; we then read the pairwise Manhattan distances from each scanner&#8217;s transformation&#8217;s translation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-o">&lt;</span><span class="tok-n">V</span>: <span class="tok-nb">AsRef</span><span class="tok-o">&lt;</span><span class="tok-p">[</span><span class="tok-n">Translation</span><span class="tok-p">]</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">(</span><span class="tok-n">translations</span>: <span class="tok-nc">V</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">u32</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">translations</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">translations</span><span class="tok-p">.</span><span class="tok-n">as_ref</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">max_manh_dist</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">u32</span>::<span class="tok-n">MIN</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">translation1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">translations</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">enumerate</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">translation1</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">translation2</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-n">translations</span><span class="tok-p">.</span><span class="tok-n">iter</span><span class="tok-p">().</span><span class="tok-n">skip</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">x2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">translation2</span><span class="tok-p">.</span><span class="tok-mi">0</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">diff</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Translation</span><span class="tok-p">([</span><span class="tok-n">x2</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">x1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y2</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">y1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">z2</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">z1</span><span class="tok-p">]);</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">max_manh_dist</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">max_manh_dist</span><span class="tok-p">.</span><span class="tok-n">max</span><span class="tok-p">(</span><span class="tok-n">diff</span><span class="tok-p">.</span><span class="tok-n">manhattan_dist</span><span class="tok-p">());</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-n">max_manh_dist</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trench_map"><a class="anchor" href="#_trench_map"></a>20. Trench Map</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://adventofcode.com/2021/day/20" target="^"><span class="icon"><i class="fa fa-star-half-o"></i></span> Day 20 problem description</a> │ <a href="/src/day_20/input.txt" target="^"><span class="icon"><i class="fa fa-file-text-o"></i></span> Problem input</a></p>
</div>
<div class="paragraph">
<p>This problem asks us to manipulate an infinitely large binary array, whose elements we&#8217;ll refer to as pixels.
Only a finite interior portion of the array has “actual” content, which we store in a 2D array.
The infinite surrounding (exterior) area is either all-on or all-off, which we store in a single variable separate from the interior portion of the array.
Transforming a pixel requires knowing the state of each of the eight pixels it is adjacent to.
The rules are the same for each pixel, but how they are applied in practice depends on whether the pixel is interior or exterior.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a given pixel is only adjacent to other interior pixels, we just look at look at those eight surrounding interior pixels.</p>
</li>
<li>
<p>If a pixel is adjacent to both interior and exterior pixels, then we look at both the array of interior pixels and the state of the exterior pixels.
The exterior pixels that are adjacent to interior pixels become interior themselves as part of this update, as they no longer necessarily share their state with the rest of the monolithic exterior.
Thus the interior portion grows each step.</p>
</li>
<li>
<p>All other pixels are exterior and are surrounded only by other exterior pixels; therefore they are all updated in the same manner, and so the exterior remains either all-on or all-off.</p>
</li>
</ol>
</div>
<hr>
<div class="openblock">
<div class="title">Setup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-k">crate</span>::<span class="tok-p">{</span><span class="tok-n">utils</span>::<span class="tok-n">to_decimal</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Answer</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">ndarray</span>::<span class="tok-n">prelude</span>::<span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">use</span><span class="tok-w"> </span><span class="tok-n">std</span>::<span class="tok-n">fmt</span>::<span class="tok-p">{</span><span class="tok-n">Display</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Write</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-k">type</span> <span class="tok-nc">Bit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">bool</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-cp">#[derive(Debug, Clone)]</span><span class="tok-w"></span>
<span class="tok-k">struct</span> <span class="tok-nc">Image</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">mat</span>: <span class="tok-nc">Array2</span><span class="tok-o">&lt;</span><span class="tok-n">Bit</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">surrounding</span>: <span class="tok-nc">Bit</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">algo</span>: <span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">Bit</span><span class="tok-o">&gt;</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">impl</span><span class="tok-w"> </span><span class="tok-n">Image</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">from_str</span><span class="tok-p">(</span><span class="tok-n">s</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-bp">Self</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">algo</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">next</span><span class="tok-p">()</span><span class="tok-o">?</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">chars</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">c</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-sc">&#39;#&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-sc">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-fm">unreachable!</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">collect</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">data</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">lines</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">flat_map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">line</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">line</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">().</span><span class="tok-n">chars</span><span class="tok-p">().</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">c</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-k">match</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-sc">&#39;#&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-sc">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-o">=&gt;</span><span class="tok-w"> </span><span class="tok-fm">unreachable!</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">.</span><span class="tok-n">collect</span>::<span class="tok-o">&lt;</span><span class="tok-nb">Vec</span><span class="tok-o">&lt;</span><span class="tok-n">_</span><span class="tok-o">&gt;&gt;</span><span class="tok-p">();</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">s</span><span class="tok-p">.</span><span class="tok-n">lines</span><span class="tok-p">().</span><span class="tok-n">nth_back</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">)</span><span class="tok-o">?</span><span class="tok-p">.</span><span class="tok-n">trim</span><span class="tok-p">().</span><span class="tok-n">len</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">data</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-fm">assert_eq!</span><span class="tok-p">(</span><span class="tok-n">n_rows</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">data</span><span class="tok-p">.</span><span class="tok-n">len</span><span class="tok-p">());</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-bp">Self</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">mat</span>: <span class="tok-nc">Array2</span>::<span class="tok-n">from_shape_vec</span><span class="tok-p">((</span><span class="tok-n">n_rows</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n_cols</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">data</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">surrounding</span>: <span class="tok-nc">false</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">algo</span><span class="tok-p">,</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">})</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">tick</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">new_surrounding</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">index</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">usize</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">to_decimal</span><span class="tok-p">([</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">surrounding</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-mi">9</span><span class="tok-p">])).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">algo</span><span class="tok-p">[</span><span class="tok-n">index</span><span class="tok-p">]</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">};</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">grown_mat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-n">Array2</span>::<span class="tok-n">from_shape_fn</span><span class="tok-p">((</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">nrows</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">ncols</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">)</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">nrows</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">ncols</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">surrounding</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-p">[[</span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">]]</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">});</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">new_mat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Array2</span>::<span class="tok-n">from_shape_simple_fn</span><span class="tok-p">(</span><span class="tok-n">grown_mat</span><span class="tok-p">.</span><span class="tok-n">dim</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">);</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">grown_mat</span><span class="tok-p">.</span><span class="tok-n">nrows</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">grown_mat</span><span class="tok-p">.</span><span class="tok-n">ncols</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">surrounding_pixels</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-fm">vec!</span><span class="tok-p">[];</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">dr</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">dc</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i32</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">dr</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-kt">i32</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">c</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">dc</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-w">						</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">bit</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">r</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-kt">i32</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">grown_mat</span><span class="tok-p">.</span><span class="tok-n">nrows</span><span class="tok-p">()).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-kt">i32</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">grown_mat</span><span class="tok-p">.</span><span class="tok-n">ncols</span><span class="tok-p">()).</span><span class="tok-n">unwrap</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">surrounding</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">							</span><span class="tok-n">grown_mat</span><span class="tok-p">[[</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">].</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|</span><span class="tok-n">m</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-kt">usize</span>::<span class="tok-n">try_from</span><span class="tok-p">(</span><span class="tok-n">m</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">())]</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-p">};</span><span class="tok-w"></span>
<span class="tok-w">						</span><span class="tok-n">surrounding_pixels</span><span class="tok-p">.</span><span class="tok-n">push</span><span class="tok-p">(</span><span class="tok-n">bit</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">					</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">				</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">replacement</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">algo</span><span class="tok-p">[</span><span class="tok-n">to_decimal</span><span class="tok-p">(</span><span class="tok-n">surrounding_pixels</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-p">];</span><span class="tok-w"></span>
<span class="tok-w">				</span><span class="tok-n">new_mat</span><span class="tok-p">[[</span><span class="tok-n">r</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">c</span><span class="tok-p">]]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">replacement</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">new_mat</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">surrounding</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">new_surrounding</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-w">	</span><span class="tok-k">fn</span> <span class="tok-nf">tick_n_times</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n</span>: <span class="tok-kt">usize</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-n">_</span><span class="tok-w"> </span><span class="tok-k">in</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-o">..</span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">			</span><span class="tok-bp">self</span><span class="tok-p">.</span><span class="tok-n">tick</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">		</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">fn</span> <span class="tok-nf">ans_for_input</span><span class="tok-p">(</span><span class="tok-n">input</span>: <span class="tok-kp">&amp;</span><span class="tok-kt">str</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">im1</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Image</span>::<span class="tok-n">from_str</span><span class="tok-p">(</span><span class="tok-n">input</span><span class="tok-p">).</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">im2</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">im1</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">20</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">pt1</span><span class="tok-p">(</span><span class="tok-n">im1</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">pt2</span><span class="tok-p">(</span><span class="tok-n">im2</span><span class="tok-p">))).</span><span class="tok-n">into</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">pub</span><span class="tok-w"> </span><span class="tok-k">fn</span> <span class="tok-nf">ans</span><span class="tok-p">()</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">Answer</span><span class="tok-o">&lt;</span><span class="tok-kt">usize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">usize</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">ans_for_input</span><span class="tok-p">(</span><span class="tok-fm">include_str!</span><span class="tok-p">(</span><span class="tok-s">&quot;input.txt&quot;</span><span class="tok-p">))</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Parts 1 and 2</div>
<p>Parts 1 and 2 are nearly identical; they both ask to count the number of “on” pixels in the image resulting after \(k\) updates, where Part 1 has \(k=2\) and Part 2 has \(k=50\).
(Notably, if the exterior switches state every update, then the number of “on” pixels will be infinite after every odd-numbered update.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">fn</span> <span class="tok-nf">pt1</span><span class="tok-p">(</span><span class="tok-n">im</span>: <span class="tok-nc">Image</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">im</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">im</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">im</span><span class="tok-p">.</span><span class="tok-n">tick_n_times</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">im</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|&amp;</span><span class="tok-n">bit</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-kt">usize</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-n">bit</span><span class="tok-p">)).</span><span class="tok-n">sum</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-k">fn</span> <span class="tok-nf">pt2</span><span class="tok-p">(</span><span class="tok-n">im</span>: <span class="tok-nc">Image</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-kt">usize</span> <span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-k">mut</span><span class="tok-w"> </span><span class="tok-n">im</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">im</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">im</span><span class="tok-p">.</span><span class="tok-n">tick_n_times</span><span class="tok-p">(</span><span class="tok-mi">50</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-n">im</span><span class="tok-p">.</span><span class="tok-n">mat</span><span class="tok-p">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-o">|&amp;</span><span class="tok-n">bit</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-kt">usize</span>::<span class="tok-n">from</span><span class="tok-p">(</span><span class="tok-n">bit</span><span class="tok-p">)).</span><span class="tok-n">sum</span><span class="tok-p">()</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>